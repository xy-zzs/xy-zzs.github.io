<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.37" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/redis/"><meta property="og:site_name" content="æ–‡æ¡£æ¼”ç¤º"><meta property="og:title" content="Rediså¯¼èˆªæ "><meta property="og:description" content="Rediså¯¼èˆªæ  æ•°æ®ç»“æ„ä¸RedisObject â‘ ç®€å•åŠ¨æ€å­—ç¬¦ä¸²SDS Redisçš„åº•å±‚æ˜¯ç”¨Cè¯­è¨€å®ç°çš„ï¼Œä½†Cè¯­è¨€å­—ç¬¦ä¸²å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼š è·å–å­—ç¬¦ä¸²é•¿åº¦çš„éœ€è¦é€šè¿‡è¿ç®— éå­—ç¬¦ä¸²å®‰å…¨ ä¸å¯ä¿®æ”¹ å› æ­¤Redisæ„å»ºäº†ä¸€ç§æ–°çš„å­—ç¬¦ä¸²ç»“æ„ï¼Œç§°ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼‰ç®€ç§°SDSã€‚ å…¶ä¸­SDSæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæºç å¦‚ä¸‹ï¼š exa..."><meta property="og:type" content="article"><meta property="og:image" content="http://images.xyzzs.top/image/image-20230122131601805.png_char"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-24T15:46:57.000Z"><meta property="article:author" content="Mr.Hope"><meta property="article:modified_time" content="2024-04-24T15:46:57.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Rediså¯¼èˆªæ ","image":["http://images.xyzzs.top/image/image-20230122131601805.png_char","http://images.xyzzs.top/image/image-20230122133014915.png_char","http://images.xyzzs.top/image/image-20230122135317734.png_char","http://images.xyzzs.top/image/image-20230122142031230.png_char","http://images.xyzzs.top/image/image-20230122143827719.png_char","http://images.xyzzs.top/image/image-20230122151743360.png_char","http://images.xyzzs.top/image/image-20230122165636300.png_char","http://images.xyzzs.top/image/1672572686250-43cefc51-74ef-4f95-bac1-b02267383d4c.png_char","http://images.xyzzs.top/image/image-20230122182941880.png_char","http://images.xyzzs.top/image/1672573411313-8b9048b4-f2a9-403d-ae93-acfdd2491764.png_char","http://images.xyzzs.top/image/1672573831777-b96f8724-444e-46ea-80e4-87486ced62c8.png_char","http://images.xyzzs.top/image/1672574517911-630ccdf9-60ce-4185-bdfc-026981d4e31e.png_char","http://images.xyzzs.top/image/image-20230122192805321.png_char","http://images.xyzzs.top/image/image-20230122193828142.png_char","http://images.xyzzs.top/image/image-20230122195421913.png_char","http://images.xyzzs.top/image/image-20230122200438739.png_char","http://images.xyzzs.top/image/image-20230122202833688.png_char","http://images.xyzzs.top/image/image-20230122204056965.png_char","http://images.xyzzs.top/image/image-20230123104322060.png_char","http://images.xyzzs.top/image/image-20230123104423346.png_char","http://images.xyzzs.top/image/image-20230123104535027.png_char","http://images.xyzzs.top/image/image-20230123105908327.png_char","http://images.xyzzs.top/image/image-20230123122029937.png_char","http://images.xyzzs.top/image/image-20230123125355831.png_char","http://images.xyzzs.top/image/image-20230123130324355.png_char_char","http://images.xyzzs.top/image/image-20230123135653225.png_char_char","http://images.xyzzs.top/image/image-20230123142800925.png_char","http://images.xyzzs.top/image/image-20230123142606904.png_char","http://images.xyzzs.top/image/image-20230123205540797.png_char","http://images.xyzzs.top/image/image-20230123213045653.png_char","http://images.xyzzs.top/image/image-20230125110532941.png_char","http://images.xyzzs.top/image/image-20230125111321967.png_char","http://images.xyzzs.top/image/image-20230127150342143.png_char","http://images.xyzzs.top/image/1665412912054-7642e6c0-e05a-4d59-bd17-647fddc2fe43.png_char","http://images.xyzzs.top/image/image-20230124140019432.png_char","http://images.xyzzs.top/image/image-20230124140112235.png_char","http://images.xyzzs.top/image/image-20230124141221433.png_char","http://images.xyzzs.top/image/image-20230124162755259.png_char","http://images.xyzzs.top/image/image-20230127172621033.png_char"],"dateModified":"2024-04-24T15:46:57.000Z","author":[{"@type":"Person","name":"Mr.Hope","url":"https://mister-hope.com"}]}</script><title>Rediså¯¼èˆªæ  | æ–‡æ¡£æ¼”ç¤º</title><meta name="description" content="Rediså¯¼èˆªæ  æ•°æ®ç»“æ„ä¸RedisObject â‘ ç®€å•åŠ¨æ€å­—ç¬¦ä¸²SDS Redisçš„åº•å±‚æ˜¯ç”¨Cè¯­è¨€å®ç°çš„ï¼Œä½†Cè¯­è¨€å­—ç¬¦ä¸²å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼š è·å–å­—ç¬¦ä¸²é•¿åº¦çš„éœ€è¦é€šè¿‡è¿ç®— éå­—ç¬¦ä¸²å®‰å…¨ ä¸å¯ä¿®æ”¹ å› æ­¤Redisæ„å»ºäº†ä¸€ç§æ–°çš„å­—ç¬¦ä¸²ç»“æ„ï¼Œç§°ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼‰ç®€ç§°SDSã€‚ å…¶ä¸­SDSæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæºç å¦‚ä¸‹ï¼š exa...">
    <link rel="preload" href="/assets/style-DPrIjLWf.css" as="style"><link rel="stylesheet" href="/assets/style-DPrIjLWf.css">
    <link rel="modulepreload" href="/assets/app-DmhNJ90i.js"><link rel="modulepreload" href="/assets/index.html-CuAKve0k.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-DiPk3ubY.js" as="script"><link rel="prefetch" href="/assets/computer-networks.html-C9UjKirJ.js" as="script"><link rel="prefetch" href="/assets/computer-organization.html-DSXcuyRf.js" as="script"><link rel="prefetch" href="/assets/data-strurture-and-arithmetic.html-DNdb5PMi.js" as="script"><link rel="prefetch" href="/assets/os.html-DbjpvWOW.js" as="script"><link rel="prefetch" href="/assets/index.html-BcaG-g8W.js" as="script"><link rel="prefetch" href="/assets/index.html-DfPkZxxs.js" as="script"><link rel="prefetch" href="/assets/disable.html-BSR-0y9E.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-Cy79nu5G.js" as="script"><link rel="prefetch" href="/assets/layout.html-COeB22md.js" as="script"><link rel="prefetch" href="/assets/markdown.html-DZP78Gmy.js" as="script"><link rel="prefetch" href="/assets/page.html-B-Fb-UJA.js" as="script"><link rel="prefetch" href="/assets/id.html-BwORX6qq.js" as="script"><link rel="prefetch" href="/assets/lock.html-RLvnsIGQ.js" as="script"><link rel="prefetch" href="/assets/index.html-a-PLKhzg.js" as="script"><link rel="prefetch" href="/assets/index.html-BT52iEKr.js" as="script"><link rel="prefetch" href="/assets/base.html-B1m-ecqu.js" as="script"><link rel="prefetch" href="/assets/collection.html-BBNeDB-j.js" as="script"><link rel="prefetch" href="/assets/io.html-Dw_Erg92.js" as="script"><link rel="prefetch" href="/assets/reflect.html-Dsc7OieZ.js" as="script"><link rel="prefetch" href="/assets/unsafe.html-sB0GYSVs.js" as="script"><link rel="prefetch" href="/assets/class-file-structure.html-3JJHVqOJ.js" as="script"><link rel="prefetch" href="/assets/memory-garbage-recycle.html-BFmxx8Yw.js" as="script"><link rel="prefetch" href="/assets/monitoring-and-troubleshooting-tools.html-D8EQ-8Xk.js" as="script"><link rel="prefetch" href="/assets/index.html-D2R0RGBu.js" as="script"><link rel="prefetch" href="/assets/kafka.html-cvMPVvwq.js" as="script"><link rel="prefetch" href="/assets/index.html-DDija_5g.js" as="script"><link rel="prefetch" href="/assets/Redis_bak.html-DtA2GCDy.js" as="script"><link rel="prefetch" href="/assets/spring-boot.html-B3X0F5Or.js" as="script"><link rel="prefetch" href="/assets/spring-cloud.html-BcnKp3F0.js" as="script"><link rel="prefetch" href="/assets/spring-framework.html-PFStnN9P.js" as="script"><link rel="prefetch" href="/assets/spring-mvc.html-BIc3SGni.js" as="script"><link rel="prefetch" href="/assets/design-mode.html-BjWFqnwS.js" as="script"><link rel="prefetch" href="/assets/distributed.html-m0BzAM3z.js" as="script"><link rel="prefetch" href="/assets/dubbo.html-5axkfnBG.js" as="script"><link rel="prefetch" href="/assets/netty.html-BI6st7eC.js" as="script"><link rel="prefetch" href="/assets/performance.html-DXWHlwHH.js" as="script"><link rel="prefetch" href="/assets/standard.html-C_VAayJr.js" as="script"><link rel="prefetch" href="/assets/index.html-IanvJ1s2.js" as="script"><link rel="prefetch" href="/assets/index.html-81HXtw2J.js" as="script"><link rel="prefetch" href="/assets/disable.html-C418PQXe.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-qdUPHlT0.js" as="script"><link rel="prefetch" href="/assets/layout.html-CGG3NXmo.js" as="script"><link rel="prefetch" href="/assets/markdown.html-DD6gRYhI.js" as="script"><link rel="prefetch" href="/assets/page.html-D4jInaCZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DElgFUYz.js" as="script"><link rel="prefetch" href="/assets/index.html-CA6H71yG.js" as="script"><link rel="prefetch" href="/assets/baz.html-DZuttFAY.js" as="script"><link rel="prefetch" href="/assets/index.html-DhdF3JMD.js" as="script"><link rel="prefetch" href="/assets/ray.html-BpCGYIHu.js" as="script"><link rel="prefetch" href="/assets/docker.html-D61bf73G.js" as="script"><link rel="prefetch" href="/assets/kubernetes.html-DOxdQLTi.js" as="script"><link rel="prefetch" href="/assets/linux.html-CWv9x826.js" as="script"><link rel="prefetch" href="/assets/shell.html-BiIeVpp5.js" as="script"><link rel="prefetch" href="/assets/index.html-D68-aeW2.js" as="script"><link rel="prefetch" href="/assets/disable.html-C01g9HbO.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-CVgF_USE.js" as="script"><link rel="prefetch" href="/assets/layout.html-Bl81Gkwh.js" as="script"><link rel="prefetch" href="/assets/markdown.html-AzL9uQQ6.js" as="script"><link rel="prefetch" href="/assets/page.html-DoYZpq2g.js" as="script"><link rel="prefetch" href="/assets/index.html-B3F9orB9.js" as="script"><link rel="prefetch" href="/assets/index.html-BLSCEdZl.js" as="script"><link rel="prefetch" href="/assets/baz.html-BPLTWY5I.js" as="script"><link rel="prefetch" href="/assets/index.html-C5puFiuf.js" as="script"><link rel="prefetch" href="/assets/ray.html-DRrehNP_.js" as="script"><link rel="prefetch" href="/assets/index.html-BXEBESPA.js" as="script"><link rel="prefetch" href="/assets/baz.html-sOWcfb4K.js" as="script"><link rel="prefetch" href="/assets/index.html-95SdEb82.js" as="script"><link rel="prefetch" href="/assets/ray.html-BQLq4Rrp.js" as="script"><link rel="prefetch" href="/assets/404.html-BgWdPnpR.js" as="script"><link rel="prefetch" href="/assets/index.html-DXGQp-YE.js" as="script"><link rel="prefetch" href="/assets/index.html-D5e9rhVj.js" as="script"><link rel="prefetch" href="/assets/index.html-Ck7WaMDc.js" as="script"><link rel="prefetch" href="/assets/index.html-CphWa8Qj.js" as="script"><link rel="prefetch" href="/assets/index.html-DauuKgyL.js" as="script"><link rel="prefetch" href="/assets/index.html-B9UdDR-u.js" as="script"><link rel="prefetch" href="/assets/index.html-DJRN-upr.js" as="script"><link rel="prefetch" href="/assets/giscus--_FS5kYt.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">æ–‡æ¡£æ¼”ç¤º</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="é¡¹ç›®ä¸»é¡µ"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>é¡¹ç›®ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/zh/demo/" aria-label="ä¸»è¦åŠŸèƒ½ä¸é…ç½®æ¼”ç¤º"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>ä¸»è¦åŠŸèƒ½ä¸é…ç½®æ¼”ç¤º<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="æŒ‡å—"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>æŒ‡å—</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Bar</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/zh/guide/bar/baz.html" aria-label="Baz"><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>Baz<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/zh/guide/bar/" aria-label="..."><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span>...<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Foo</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/zh/guide/foo/ray.html" aria-label="Ray"><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>Ray<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/zh/guide/foo/" aria-label="..."><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span>...<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a href="https://theme-hope.vuejs.press/zh/" rel="noopener noreferrer" target="_blank" aria-label="V2 æ–‡æ¡£" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>V2 æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><div class="vp-nav-item"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="é€‰æ‹©è¯­è¨€"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link active" href="/redis/" aria-label="ç®€ä½“ä¸­æ–‡"><!---->ç®€ä½“ä¸­æ–‡<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/en/" aria-label="English"><!---->English<!----></a></li></ul></button></div></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/" aria-label="é¡¹ç›®ä¸»é¡µ"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>é¡¹ç›®ä¸»é¡µ<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="route-link nav-link vp-sidebar-title" href="/demo/" aria-label="æ¡ˆä¾‹"><!---->æ¡ˆä¾‹<!----></a><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/markdown.html" aria-label="Markdown å±•ç¤º"><span class="font-icon icon fa-fw fa-sm fab fa-markdown" style=""></span>Markdown å±•ç¤º<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/layout.html" aria-label="å¸ƒå±€"><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span>å¸ƒå±€<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/page.html" aria-label="é¡µé¢é…ç½®"><span class="font-icon icon fa-fw fa-sm fas fa-file" style=""></span>é¡µé¢é…ç½®<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/disable.html" aria-label="å¸ƒå±€ä¸åŠŸèƒ½ç¦ç”¨"><span class="font-icon icon fa-fw fa-sm fas fa-gears" style=""></span>å¸ƒå±€ä¸åŠŸèƒ½ç¦ç”¨<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/encrypt.html" aria-label="å¯†ç åŠ å¯†çš„æ–‡ç« "><span class="font-icon icon fa-fw fa-sm fas fa-lock" style=""></span>å¯†ç åŠ å¯†çš„æ–‡ç« <!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">æ–‡æ¡£</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/guide/" aria-label="æŒ‡å—"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>æŒ‡å—<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">Bar åŠŸèƒ½</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">Foo åŠŸèƒ½</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><a href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" rel="noopener noreferrer" target="_blank" aria-label="å¹»ç¯ç‰‡" class="nav-link vp-sidebar-link vp-sidebar-page"><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span>å¹»ç¯ç‰‡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><span class="vp-sidebar-title">è®¡ç®—æœºåŸºç¡€2</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Java åŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">å¹¶å‘</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">JVM</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/redis/" aria-label="Rediså¯¼èˆªæ "><!---->Rediså¯¼èˆªæ <!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Message Queue</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ç³»ç»Ÿè®¾è®¡</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Rediså¯¼èˆªæ </h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">Mr.Hope</a></span><span property="author" content="Mr.Hope"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-04-24T15:46:57.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 51 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT51M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ•°æ®ç»“æ„ä¸redisobject">æ•°æ®ç»“æ„ä¸RedisObject</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1ç®€å•åŠ¨æ€å­—ç¬¦ä¸²sds">â‘ ç®€å•åŠ¨æ€å­—ç¬¦ä¸²SDS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2intsetâ€”æ•´æ•°æ•°ç»„">â‘¡IntSetâ€”æ•´æ•°æ•°ç»„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3dictâ€”å­—å…¸">â‘¢Dictâ€”å­—å…¸</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4ziplist">â‘£ZipList</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5quicklist">â‘¤QuickList</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6skiplist">â‘¥SkipList</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#redisobject">RedisObject</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹">äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº•å±‚å®ç°â€”â€”string">åº•å±‚å®ç°â€”â€”String</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº•å±‚å®ç°â€”â€”list">åº•å±‚å®ç°â€”â€”List</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº•å±‚å®ç°â€”â€”set">åº•å±‚å®ç°â€”â€”Set</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº•å±‚å®ç°â€”â€”zset">åº•å±‚å®ç°â€”â€”ZSet</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº•å±‚å®ç°â€”â€”hash">åº•å±‚å®ç°â€”â€”Hash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¸¸è§å‘½ä»¤æ“ä½œ">å¸¸è§å‘½ä»¤æ“ä½œ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æŒä¹…ç­–ç•¥">æŒä¹…ç­–ç•¥</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rdb">RDB</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aof">AOF</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ··åˆæŒä¹…åŒ–">æ··åˆæŒä¹…åŒ–</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¼“å­˜æ›´æ–°ç­–ç•¥">ç¼“å­˜æ›´æ–°ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å†…å­˜ç­–ç•¥">å†…å­˜ç­–ç•¥</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¿‡æœŸç­–ç•¥">è¿‡æœŸç­–ç•¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ·˜æ±°ç­–ç•¥">æ·˜æ±°ç­–ç•¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©">ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¼“å­˜ç©¿é€">ç¼“å­˜ç©¿é€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¼“å­˜å‡»ç©¿">ç¼“å­˜å‡»ç©¿</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¼“å­˜é›ªå´©">ç¼“å­˜é›ªå´©</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¼“å­˜-åˆ†å¸ƒå¼">ç¼“å­˜-åˆ†å¸ƒå¼</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸»ä»">ä¸»ä»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å“¨å…µ">å“¨å…µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ†ç‰‡å¼é›†ç¾¤">åˆ†ç‰‡å¼é›†ç¾¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#redisç½‘ç»œæ¨¡å‹">redisç½‘ç»œæ¨¡å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#redisé”®å€¼è®¾è®¡">Redisé”®å€¼è®¾è®¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ‰¹å¤„ç†">æ‰¹å¤„ç†</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="rediså¯¼èˆªæ " tabindex="-1"><a class="header-anchor" href="#rediså¯¼èˆªæ "><span>Rediså¯¼èˆªæ </span></a></h1><h2 id="æ•°æ®ç»“æ„ä¸redisobject" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„ä¸redisobject"><span>æ•°æ®ç»“æ„ä¸RedisObject</span></a></h2><h3 id="_1ç®€å•åŠ¨æ€å­—ç¬¦ä¸²sds" tabindex="-1"><a class="header-anchor" href="#_1ç®€å•åŠ¨æ€å­—ç¬¦ä¸²sds"><span>â‘ ç®€å•åŠ¨æ€å­—ç¬¦ä¸²SDS</span></a></h3><p>Redisçš„åº•å±‚æ˜¯ç”¨Cè¯­è¨€å®ç°çš„ï¼Œä½†Cè¯­è¨€å­—ç¬¦ä¸²å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼š</p><ul><li><p>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„éœ€è¦é€šè¿‡è¿ç®—</p></li><li><p>éå­—ç¬¦ä¸²å®‰å…¨</p></li><li><p>ä¸å¯ä¿®æ”¹</p></li></ul><p>å› æ­¤Redisæ„å»ºäº†ä¸€ç§æ–°çš„å­—ç¬¦ä¸²ç»“æ„ï¼Œç§°ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼‰ç®€ç§°SDSã€‚</p><p>å…¶ä¸­SDSæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæºç å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">sdshdr8</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint8_t</span> len<span class="token punctuation">;</span>	<span class="token comment">//bufä¸­å·²ä¿å­˜çš„å­—ç¬¦ä¸²å­—èŠ‚æ•°ï¼Œä¸åŒ…å«ç»“æŸæ ‡è¯†</span>
    <span class="token class-name">uint8_t</span> alloc<span class="token punctuation">;</span>	<span class="token comment">//bufç”³è¯·çš„æ€»å­—èŠ‚æ•°ï¼Œä¸åŒ…å«ç»“æŸæ ‡è¯†</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span>  <span class="token comment">//ä¸åŒçš„SDSçš„å¤´ç±»å‹ï¼Œç”¨æ¥æ§åˆ¶SDSçš„å¤´å¤§å°ï¼Œå¯¹åº”å…³ç³»å¦‚ä¸‹SDS_TYPEå®šä¹‰</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SDS_TYPE_5</span>  <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SDS_TYPE_8</span>  <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SDS_TYPE_16</span> <span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SDS_TYPE_32</span> <span class="token expression"><span class="token number">3</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SDS_TYPE_64</span> <span class="token expression"><span class="token number">4</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>exampleï¼šä¸€ä¸ª&quot;hello&quot;å­—ç¬¦ä¸²çš„SDSç»“æ„å¦‚ä¸‹</p><figure><img src="http://images.xyzzs.top/image/image-20230122131601805.png_char" alt="image-20230122131601805" tabindex="0" loading="lazy"><figcaption>image-20230122131601805</figcaption></figure><p><mark>å†…å­˜é¢„åˆ†é…</mark></p><p>SDSä¹‹æ‰€ä»¥å«åšåŠ¨æ€å­—ç¬¦ä¸²ï¼Œæ˜¯å› ä¸ºå®ƒå…·å¤‡åŠ¨æ€æ‰©å®¹çš„èƒ½åŠ›ï¼Œä¾‹å¦‚ä¸€ä¸ªå†…å®¹ä¸º&quot;hi&quot;çš„SDSï¼›</p><p>å‡å¦‚æˆ‘ä»¬è¦ç»™SDSè¿½åŠ ä¸€æ®µå­—ç¬¦ä¸²&quot;,zzs&quot;ï¼Œè¿™é‡Œé¦–å…ˆä¼šç”³è¯·æ–°å†…å­˜ç©ºé—´ï¼š</p><ul><li>å¦‚æœæ–°å­—ç¬¦ä¸²å°äº1Mï¼Œåˆ™æ–°ç©ºé—´ä¸ºæ‰©å±•åå­—ç¬¦ä¸²é•¿åº¦çš„ä¸¤å€+1ï¼›</li><li>å¦‚æœæ–°å­—ç¬¦ä¸²å¤§äº1Mï¼Œåˆ™æ–°ç©ºé—´ä¸ºæ‰©å±•åå­—ç¬¦ä¸²é•¿åº¦+1M+1ï¼Œç§°ä¸º<em><strong>å†…å­˜é¢„åˆ†é…</strong></em></li></ul><figure><img src="http://images.xyzzs.top/image/image-20230122133014915.png_char" alt="image-20230122133014915" tabindex="0" loading="lazy"><figcaption>image-20230122133014915</figcaption></figure><p><mark>ä¼˜ç‚¹</mark></p><ol><li>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)</li><li>æ”¯æŒåŠ¨æ€æ‰©å®¹</li><li>å‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°</li><li>äºŒè¿›åˆ¶å®‰å…¨</li></ol><h3 id="_2intsetâ€”æ•´æ•°æ•°ç»„" tabindex="-1"><a class="header-anchor" href="#_2intsetâ€”æ•´æ•°æ•°ç»„"><span>â‘¡IntSetâ€”æ•´æ•°æ•°ç»„</span></a></h3><p>IntSetæ˜¯Redisä¸­seté›†åˆçš„ä¸€ç§å®ç°æ–¹å¼ï¼ŒåŸºäºæ•´æ•°æ•°ç»„æ¥å®ç°ï¼Œå¹¶ä¸”å…·å¤‡é•¿åº¦å¯å˜ã€æœ‰åºç­‰ç‰¹å¾ã€‚</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">intset</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint32_t</span> encoding<span class="token punctuation">;</span>	<span class="token comment">//ç¼–ç æ–¹å¼ï¼Œæ”¯æŒå­˜æ”¾16ä½ã€32ä½ã€64ä½æ•´æ•°</span>
    <span class="token class-name">uint32_t</span> length<span class="token punctuation">;</span>	<span class="token comment">//å…ƒç´ ä¸ªæ•°</span>
    <span class="token class-name">int8_t</span> contents<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//æ•´æ•°é›†åˆï¼Œä¿å­˜é›†åˆæ•°æ®</span>
<span class="token punctuation">}</span> intset<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INTSET_ENC_INT16</span> <span class="token expression"><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">int16_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </span><span class="token comment">//2å­—èŠ‚ï¼ŒèŒƒå›´ç±»ä¼¼javaçš„short</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INTSET_ENC_INT32</span> <span class="token expression"><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </span><span class="token comment">//4å­—èŠ‚ï¼ŒèŒƒå›´ç±»ä¼¼javaçš„int</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INTSET_ENC_INT64</span> <span class="token expression"><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">int64_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </span><span class="token comment">//8å­—èŠ‚ï¼ŒèŒƒå›´ç±»ä¼¼javaçš„long</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾ï¼ŒRedisä¼šå°†intsetä¸­æ‰€æœ‰çš„æ•´æ•°æŒ‰ç…§å‡åºä¾æ¬¡ä¿å­˜å†contentsæ•°ç»„ä¸­ï¼Œç»“æ„å¦‚ä¸‹</p><figure><img src="http://images.xyzzs.top/image/image-20230122135317734.png_char" alt="image-20230122135317734" tabindex="0" loading="lazy"><figcaption>image-20230122135317734</figcaption></figure><p>ç°åœ¨ï¼Œæ•°ç»„ä¸­æ¯ä¸ªæ•°å­—éƒ½åœ¨int16_tèŒƒå›´å†…ï¼Œå› æ­¤é‡‡ç”¨çš„ç¼–ç æ–¹å¼æ˜¯INTSET_ENC_INT16ï¼Œå ç”¨çš„å­—èŠ‚å¤§å°ä¸ºï¼š</p><ul><li>encodingï¼š4 å­—èŠ‚</li><li>lengthï¼š4 å­—èŠ‚</li><li>contentsï¼š2 å­—èŠ‚ * 3 = 6 å­—èŠ‚</li></ul><p><mark>IntSetå‡çº§</mark></p><p>å‡è®¾æœ‰ä¸€ä¸ªintsetï¼Œå…ƒç´ ä¸º{7,18,24}ï¼Œå› æ­¤é‡‡ç”¨çš„ç¼–ç æ˜¯<!---->ï¼Œåˆ™æ¯ä¸ªæ•´æ•°å 2å­—èŠ‚</p><figure><img src="http://images.xyzzs.top/image/image-20230122142031230.png_char" alt="image-20230122142031230" tabindex="0" loading="lazy"><figcaption>image-20230122142031230</figcaption></figure><p>ç°åœ¨ï¼Œå‘è¯¥æ•°ç»„ä¸­æ·»åŠ ä¸€ä¸ªæ•°å­—ï¼š50000 ï¼Œè¿™ä¸ªæ•°å­—è¶…è¿‡äº†int16_tçš„èŒƒå›´ï¼Œintsetä¼šè‡ªåŠ¨å‡çº§ç¼–ç æ–¹å¼åˆ°åˆé€‚çš„å¤§å°ã€‚å‡çº§æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å‡çº§ç¼–ç ä¸ºINTSET_ENC_INT32ï¼Œæ¯ä¸ªæ•´æ•°å 4ä¸ªå­—èŠ‚ï¼Œå¹¶æŒ‰ç…§æ–°çš„ç¼–ç æ–¹å¼åŠå…ƒç´ ä¸ªæ•°æ‰©å®¹æ•°ç»„</li><li>å€’åºä¾æ¬¡å°†æ•°ç»„ä¸­çš„å…ƒç´ æ‹·è´åˆ°æ‰©å®¹çš„æ­£ç¡®ä½ç½®</li><li>å°†å¾…æ·»åŠ å…ƒç´ æ”¾å…¥æ•°ç»„æœ«å°¾</li><li>æœ€åï¼Œå°†intsetçš„encodingå±æ€§æ”¹ä¸ºINTSET_ENC_INT32ï¼Œå°†lengthå±æ€§æ”¹ä¸º4</li></ol><figure><img src="http://images.xyzzs.top/image/image-20230122143827719.png_char" alt="image-20230122143827719" tabindex="0" loading="lazy"><figcaption>image-20230122143827719</figcaption></figure><p><mark>ç‰¹ç‚¹</mark></p><p>intsetå¯ä»¥çœ‹åšæ˜¯ç‰¹æ®Šçš„æ•´æ•°æ•°ç»„ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>Redisä¼šç¡®ä¿IntSetä¸­çš„å…ƒç´ å”¯ä¸€ã€æœ‰åº</li><li>å…·å¤‡ç±»å‹å‡çº§æœºåˆ¶ï¼Œå¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´</li><li>åº•å±‚é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾æ–¹å¼æŸ¥è¯¢</li></ol><h3 id="_3dictâ€”å­—å…¸" tabindex="-1"><a class="header-anchor" href="#_3dictâ€”å­—å…¸"><span>â‘¢Dictâ€”å­—å…¸</span></a></h3><p>Redisæ˜¯ä¸€ä¸ªé”®å€¼å‹çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®é”®å®ç°å¿«é€Ÿçš„å¢åˆ æ”¹æŸ¥ï¼Œè¿™ç§å…³ç³»ä¸€èˆ¬é€šè¿‡Dictå®ç°ã€‚</p><p>Dictç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯å­—å…¸ï¼ˆDictï¼‰ã€å“ˆå¸Œè¡¨ï¼ˆDictHashTableï¼‰ï¼Œå“ˆå¸ŒèŠ‚ç‚¹ï¼ˆDictEntryï¼‰ã€‚</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">dict</span> <span class="token punctuation">{</span><span class="token comment">//å­—å…¸</span>
    dictType <span class="token operator">*</span>type<span class="token punctuation">;</span>		<span class="token comment">//dictç±»å‹ï¼Œå†…ç½®ä¸åŒçš„hashå‡½æ•°</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>privdata<span class="token punctuation">;</span>		<span class="token comment">//ç§æœ‰æ•°æ®ï¼Œåœ¨åšç‰¹æ®Šhashè¿ç®—æ—¶ç”¨</span>
    dictht ht<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">//ä¸€ä¸ªDictåŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å½“å‰æ•°æ®ï¼Œå¦ä¸€ä¸ªä¸€èˆ¬æ˜¯ç©ºï¼Œrehashæ—¶ä½¿ç”¨</span>
    <span class="token keyword">long</span> rehashidx<span class="token punctuation">;</span>		<span class="token comment">/*rehashidxrehashçš„è¿›åº¦ï¼Œ-1è¡¨ç¤ºæœªè¿›è¡Œ */</span>
    <span class="token class-name">int16_t</span> pauserehash<span class="token punctuation">;</span><span class="token comment">//rehashæ˜¯å¦æš‚åœï¼Œ1åˆ™æš‚åœï¼Œ0ç»§ç»­</span>
<span class="token punctuation">}</span> dict<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">dictht</span> <span class="token punctuation">{</span><span class="token comment">//å“ˆå¸Œè¡¨</span>
    dictEntry <span class="token operator">*</span><span class="token operator">*</span>table<span class="token punctuation">;</span>		<span class="token comment">//entryæ•°ç»„ï¼Œä¿å­˜çš„æ˜¯æŒ‡å‘entryçš„æŒ‡é’ˆ</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> size<span class="token punctuation">;</span>		<span class="token comment">//å“ˆå¸Œè¡¨çš„å¤§å°</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> sizemask<span class="token punctuation">;</span>	<span class="token comment">//å“ˆå¸Œè¡¨çš„å¤§å°çš„æ©ç ï¼Œæ€»ç­‰äºsize-1ï¼Œç”¨äºå“ˆå¸Œè¿ç®—ï¼ŒæŒ‰ä½ä¸&amp; æ•ˆç‡é«˜</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> used<span class="token punctuation">;</span>		<span class="token comment">//entryä¸ªæ•°ï¼Œå› ä¸ºèŠ‚ç‚¹å¯ä»¥å½¢æˆé“¾è¡¨ï¼Œæ‰€ä»¥usedå¯èƒ½ä¼šå¤§äºsize</span>
<span class="token punctuation">}</span> dictht<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">dictEntry</span> <span class="token punctuation">{</span><span class="token comment">//å“ˆå¸ŒèŠ‚ç‚¹</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">;</span>	<span class="token comment">//é”®</span>
    <span class="token keyword">union</span> <span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token operator">*</span>val<span class="token punctuation">;</span>
        <span class="token class-name">uint64_t</span> u64<span class="token punctuation">;</span>
        <span class="token class-name">int64_t</span> s64<span class="token punctuation">;</span>
        <span class="token keyword">double</span> d<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> v<span class="token punctuation">;</span>	<span class="token comment">//å€¼</span>
    <span class="token keyword">struct</span> <span class="token class-name">dictEntry</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
<span class="token punctuation">}</span> dictEntry<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><mark>Dictçš„ç»“æ„</mark></p><ul><li>ç±»ä¼¼ Java çš„ HashTable , åº•å±‚æ˜¯æ•°ç»„åŠ é“¾è¡¨æ¥è§£å†³å“ˆå¸Œå†²çª</li><li>Dict åŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œht[0]å¹³å¸¸ç”¨ï¼Œht[1]ç”¨æ¥rehash</li></ul><figure><img src="http://images.xyzzs.top/image/image-20230122151743360.png_char" alt="image-20230122151743360" tabindex="0" loading="lazy"><figcaption>image-20230122151743360</figcaption></figure><p><mark>Dictçš„æ‰©å®¹</mark></p><p>Dictçš„HashTableå°±æ˜¯æ•°ç»„ç»“åˆå•å‘é“¾è¡¨çš„å®ç°ï¼Œå½“é›†åˆä¸­å…ƒç´ è¾ƒå¤šæ—¶ï¼Œå¿…ç„¶å¯¼è‡´å“ˆå¸Œå†²çªå¢å¤šï¼Œé“¾è¡¨è¿‡é•¿ï¼Œåˆ™æŸ¥è¯¢æ•ˆç‡ä¼šå¤§å¤§é™ä½ã€‚</p><p>Dictåœ¨æ¯æ¬¡æ–°å¢é”®å€¼å¯¹æ—¶éƒ½ä¼šæ£€æŸ¥è´Ÿè½½å› å­ï¼ˆLoadFactory = used / sizeï¼‰,æ»¡è¶³ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šè§¦å‘<em><strong>å“ˆå¸Œè¡¨æ‰©å®¹</strong></em></p><ul><li>å“ˆå¸Œè¡¨çš„LoadFactory &gt;= 1,å¹¶ä¸”æœåŠ¡å™¨æ²¡æœ‰æ‰§è¡Œ<code>BGSAVE</code> æˆ–è€…<code>BGREWRITEAOF</code>ç­‰åå°è¿›ç¨‹â€”â€”å› ä¸ºç±»ä¼¼å‘½ä»¤å¯¹åå°CPUä½¿ç”¨æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œå½±å“æ€§èƒ½</li><li>å“ˆå¸Œè¡¨LoadFactory &gt; 5â€”â€”æ­¤æ—¶é“¾è¡¨åº”è¯¥æ˜¯æ¯”è¾ƒé•¿ï¼Œä¹Ÿæ¯”è¾ƒå½±å“æ€§èƒ½</li></ul><p><mark>Dictçš„æ”¶ç¼©</mark></p><p>Dicté™¤äº†æ‰©å®¹å¤–ï¼Œæ¯æ¬¡åˆ é™¤å…ƒç´ æ—¶ï¼Œä¹Ÿä¼šå¯¹è´Ÿè½½å› å­åšæ£€æŸ¥ï¼Œæ¡£loadFactory &lt; 0.1 æ—¶ï¼Œä¼šåšå“ˆå¸Œè¡¨æ”¶ç¼©ï¼›</p><p><em><strong>Dictä¼¸ç¼©å°ç»“</strong></em></p><ul><li>å½“ LoadFactory å¤§äº 5æˆ–è€… LoadFactory å¤§äº1 å¹¶ä¸”æ²¡æœ‰å­è¿›ç¨‹ä»»åŠ¡æ—¶ï¼ŒDictæ‰©å®¹ï¼›</li><li>å½“LoadFactory å°äº 0.1 æ—¶ï¼ŒDict æ”¶ç¼©ï¼›</li><li>æ‰©å®¹å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºused + 1 çš„ 2^nï¼›</li><li>æ”¶ç¼©å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºused çš„ 2^nï¼›</li><li>Dicté‡‡ç”¨æ¸è¿›å¼rehashï¼Œæ¯æ¬¡è®¿é—®Dictæ—¶æ‰§è¡Œä¸€æ¬¡rehashï¼›</li><li>rehashæ—¶ht[0]åªå‡ä¸å¢ï¼Œæ–°å¢æ“ä½œåªåœ¨ht[1]æ‰§è¡Œï¼Œå…¶ä»–æ“ä½œåœ¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼›</li></ul><p><mark><!----></mark></p><!-- èƒŒè¿™å…­å¤§æ­¥éª¤ --><p>ä¸ç®¡æ‰©å®¹è¿˜æ˜¯ç¼©å®¹ï¼Œå“ˆå¸Œè¡¨çš„å¤§å°sizeå¿…å®šä¼šå˜ï¼Œå¯¼è‡´sizemarkå˜åŒ–ï¼Œè€Œkeyçš„æŸ¥è¯¢ä¸sizemarkï¼ˆå‚ä¸å“ˆå¸Œè¿ç®—ï¼‰æœ‰å…³ï¼Œå› æ­¤å¿…é¡»å¯¹å“ˆå¸Œè¡¨çš„æ¯ä¸€ä¸ªkeyé‡æ–°è®¡ç®—ç´¢å¼•ï¼Œæ’å…¥æ–°çš„å“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆä¸º<em><strong>rehash</strong></em>ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>è®¡ç®—hashçš„realSizeï¼Œå–å†³äºå½“å‰è¦åšçš„æ‰©å®¹è¿˜æ˜¯æ”¶ç¼©ï¼š <ul><li>å¦‚æœæ˜¯æ‰©å®¹ï¼Œåˆ™æ–°sizeä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºdict.ht[0].used+1çš„<code>2^n</code>-</li><li>å¦‚æœæ˜¯æ”¶ç¼©ï¼Œåˆ™æ–°sizeä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºdict.ht[0].usedçš„<code>2^n</code> ï¼ˆä¸å¾—å°äº4ï¼‰</li></ul></li><li>æŒ‰ç…§æ–°çš„realsizeç”³è¯·å†…å­˜ç©ºé—´ï¼Œåˆ›å»ºdicthtï¼Œå¹¶èµ‹å€¼ç»™dict[1]</li><li>è®¾ç½®dict.rehashidx = 0 ,è¡¨ç¤ºå¼€å§‹rehash</li><li><!---->åœ¨rehashè¿‡ç¨‹ä¸­ï¼Œæ–°å¢æ“ä½œï¼Œåˆ™ç›´æ¥å†™å…¥ht[1]ï¼ŒæŸ¥è¯¢ã€ä¿®æ”¹å’Œåˆ é™¤åˆ™ä¼šåœ¨dict[0]å’Œdict[1]ä¾æ¬¡æŸ¥æ‰¾å¹¶æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ht[0]çš„æ•°æ®åªå‡ä¸å¢ï¼Œéšç€rehashæœ€ç»ˆä¸ºç©º</li><li>å°†dict.ht[1]èµ‹å€¼ç»™dict.ht[0]ï¼Œç»™dict.ht[1]åˆå§‹åŒ–ä¸ºç©ºå“ˆå¸Œè¡¨ï¼Œé‡Šæ”¾åŸæ¥çš„dict.ht[0]çš„å†…å­˜</li><li>å°†rehashidxèµ‹å€¼ä¸º-1ï¼Œä»£è¡¨rehashç»“æŸ</li></ol><h3 id="_4ziplist" tabindex="-1"><a class="header-anchor" href="#_4ziplist"><span>â‘£ZipList</span></a></h3><p><mark>ZipListçš„ç»“æ„</mark></p><figure><img src="http://images.xyzzs.top/image/image-20230122165636300.png_char" alt="image-20230122165636300" tabindex="0" loading="lazy"><figcaption>image-20230122165636300</figcaption></figure><figure><img src="http://images.xyzzs.top/image/1672572686250-43cefc51-74ef-4f95-bac1-b02267383d4c.png_char" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ZipListæ˜¯ä¸€ç§ç‰¹æ®Šçš„<code>åŒç«¯é“¾è¡¨</code>ï¼Œç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å—ç»„æˆï¼Œå¯ä»¥åœ¨ä»»æ„ä¸€ç«¯è¿›è¡Œå‹å…¥ã€å¼¹å‡ºæ“ä½œï¼Œå¹¶ä¸”è¯¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚</p><table><tr><td bgcolor="red">å±æ€§</td><td bgcolor="red">ç±»å‹</td><td bgcolor="red">é•¿åº¦</td><td bgcolor="red">ç”¨é€”</td></tr><tr><td>zlbytes</td><td>uint32_t</td><td>4å­—èŠ‚</td><td>è®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°</td></tr><tr><td>zltail</td><td>uint32_t</td><td>4å­—èŠ‚</td><td>è®°å½•å‹ç¼©åˆ—è¡¨è¡¨å°¾èŠ‚ç‚¹è·ç¦»å‹ç¼©åˆ—è¡¨çš„èµ·å§‹åœ°å€æœ‰å¤šå°‘å­—èŠ‚ï¼Œé€šè¿‡è¿™ä¸ªåç§»é‡ï¼Œå¯ä»¥ç¡®å®šè¡¨å°¾èŠ‚ç‚¹çš„åœ°å€ã€‚</td></tr><tr><td>zllen</td><td>uint16_t</td><td>2å­—èŠ‚</td><td>è®°å½•äº†å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ã€‚æœ€å¤§å€¼ä¸ºuint16_maxï¼ˆ65534ï¼‰ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªå€¼ï¼Œæ­¤å¤„ä¼šè®°å½•65535ï¼Œä½†èŠ‚ç‚¹çš„çœŸå®æ•°é‡éœ€è¦éå†æ•´ä¸ªå‹ç¼©åˆ—è¡¨æ‰èƒ½è®¡ç®—å¾—å‡ºã€‚å› æ­¤ziplistä¸ä»‹æ„å­˜è¿‡å¤šæ•°æ®</td></tr><tr><td>entry</td><td>åˆ—è¡¨èŠ‚ç‚¹</td><td>ä¸å®š</td><td>å‹ç¼©åˆ—è¡¨åŒ…å«çš„å„ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„é•¿åº¦ç”±èŠ‚ç‚¹ä¿å­˜çš„å†…å®¹å†³å®š</td></tr><tr><td>zlend</td><td>uint8_t</td><td>1</td><td> ç‰¹æ®Šå€¼0xFFï¼ˆåè¿›åˆ¶255ï¼‰ï¼Œç”¨äºæ ‡è®°å‹ç¼©åˆ—è¡¨çš„æœ«ç«¯</td></tr></table><p><mark>ZipListEntry</mark></p><p>ZipListä¸­çš„Entryå¹¶ä¸åƒæ™®é€šé“¾è¡¨é‚£æ ·è®°å½•å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå› ä¸ºè®°å½•ä¸¤ä¸ªæŒ‡é’ˆè¦å ç”¨16ä¸ªå­—èŠ‚ï¼Œæµªè´¹å†…å­˜ï¼›è€Œæ˜¯é‡‡ç”¨å¦‚ä¸‹ç»“æ„ï¼š</p><figure><img src="http://images.xyzzs.top/image/image-20230122182941880.png_char" alt="image-20230122182941880" tabindex="0" loading="lazy"><figcaption>image-20230122182941880</figcaption></figure><ul><li>previous_entry_length: å‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦ï¼Œå 1ä¸ªæˆ–5ä¸ªå­—èŠ‚ï¼›<!----><ul><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å°äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨1ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼</li><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å¤§äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨5ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º0xFEï¼Œåå››ä¸ªå­—èŠ‚æ‰æ˜¯çœŸå®é•¿åº¦æ•°æ®</li></ul></li><li>encodingï¼šç¼–ç å±æ€§ï¼Œè®°å½•contentçš„æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦ä¸²è¿˜æ˜¯æ•´æ•°ï¼‰ä»¥åŠé•¿åº¦ï¼Œå ç”¨1ä¸ªã€2ä¸ªæˆ–5ä¸ªå­—ï¼›<!----></li><li>contentsï¼šè´Ÿè´£ä¿å­˜èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ•´æ•°</li></ul><figure><img src="http://images.xyzzs.top/image/1672573411313-8b9048b4-f2a9-403d-ae93-acfdd2491764.png_char" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="http://images.xyzzs.top/image/1672573831777-b96f8724-444e-46ea-80e4-87486ced62c8.png_char" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><mark>Encodingç¼–ç å±æ€§</mark></p><p>ZipListEntryä¸­çš„encodingç¼–ç åˆ†ä¸ºå­—ç¬¦ä¸²å’Œæ•´æ•°ä¸¤ç§ï¼š</p><ul><li><p>å­—ç¬¦ä¸²ï¼šå¦‚æœencodingæ˜¯ä»¥00ã€01ã€10å¼€å¤´ï¼Œåˆ™è¯æ˜contentæ˜¯å­—ç¬¦ä¸²</p><table><thead><tr><th>ç¼–ç </th><th>ç¼–ç é•¿åº¦</th><th>å­—ç¬¦ä¸²å¤§å°</th></tr></thead><tbody><tr><td>|00<!----></td><td>1 bytes</td><td>&lt;= 63 bytesï¼Œ6ä¸ªæ¯”ç‰¹ä½è®°å½•é•¿åº¦</td></tr><tr><td>|01<!----></td><td>2 bytes</td><td>&lt;= 16383 bytesï¼Œ14ä¸ªæ¯”ç‰¹ä½è®°å½•é•¿åº¦</td></tr><tr><td>|10000000<!----></td><td>5 bytes</td><td>&lt;= 4294967295 bytesï¼Œ32ä¸ªæ¯”ç‰¹ä½è®°å½•é•¿åº¦</td></tr></tbody></table></li><li><p>æ•´æ•°ï¼šå¦‚æœencodingæ˜¯ä»¥11å¼€å¤´ï¼Œåˆ™è¯´æ˜contentæ˜¯æ•´æ•°ï¼Œä¸”encodingå›ºå®šåªå ç”¨ä¸€ä¸ªå­—èŠ‚</p><table><thead><tr><th>ç¼–ç </th><th>ç¼–ç é•¿åº¦</th><th>æ•´æ•°ç±»å‹</th></tr></thead><tbody><tr><td>11000000</td><td>1 bytes</td><td>int16_t(2 bytes)</td></tr><tr><td>11010000</td><td>1 bytes</td><td>int32_t(4 bytes)</td></tr><tr><td>11100000</td><td>1 bytes</td><td>int64_t(8 bytes)</td></tr><tr><td>11110000</td><td>1 bytes</td><td>24ä½æœ‰ç¬¦å·æ•´æ•°(3 bytes)</td></tr><tr><td>11111110</td><td>1 bytes</td><td>8ä½æœ‰ç¬¦å·æ•´æ•°(1 bytes)</td></tr><tr><td>1111xxxx</td><td>1 bytes</td><td>ç›´æ¥åœ¨xxxxä½ç½®ä¿å­˜æ•°å€¼ï¼ŒèŒƒå›´ä»0001~1101ï¼Œå‡1åç»“æœä¸ºå®é™…å€¼ï¼›<br> ä¸å†éœ€è¦content</td></tr></tbody></table></li></ul><figure><img src="http://images.xyzzs.top/image/1672574517911-630ccdf9-60ce-4185-bdfc-026981d4e31e.png_char" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p><mark>ZipListçš„è¿é”æ›´æ–°é—®é¢˜</mark></p><p>ZipListçš„æ¯ä¸ªEntryéƒ½åŒ…å«previous_entry_lengthæ¥è®°å½•ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°ï¼Œé•¿åº¦æ˜¯1æˆ–5ä¸ªå­—èŠ‚</p><ul><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å°äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨1ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼</li><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨5ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º0xfeï¼Œåå››ä¸ªå­—èŠ‚æ‰æ˜¯çœŸå®é•¿åº¦æ•°æ®ã€‚</li></ul><p>å‡è®¾æˆ‘ä»¬æœ‰Nä¸ª<!---->çš„entryï¼Œå› æ­¤entryçš„previous_entry_lengthå±æ€§ç”¨1ä¸ªå­—èŠ‚å³å¯è¡¨ç¤ºã€‚ç°åœ¨å¤´èŠ‚ç‚¹æ’å…¥ä¸€ä¸ªæ•°æ®å¤§äº254å­—èŠ‚ï¼Œå¯¼è‡´ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„previous_entry_lengthä»1ä¸ªå­—èŠ‚å‡åˆ°5ä¸ªå­—èŠ‚ï¼Œç¬¬äºŒä¸ªå¯¼è‡´ç¬¬ä¸‰ä¸ªï¼Œä¾æ¬¡ç±»æ¨ï¼›ZipListè¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹äº§ç”Ÿçš„è¿ç»­å¤šæ¬¡ç©ºé—´æ‰©å±•æ“ä½œç§°ä¸º<strong>è¿é”æ›´æ–°</strong>ï¼Œæ–°å¢ã€åˆ é™¤éƒ½å¯èƒ½å¯¼è‡´è¿é”æ›´æ–°çš„å‘ç”Ÿã€‚</p><p><mark>ZipListç‰¹æ€§</mark></p><ol><li>å‹ç¼©åˆ—è¡¨å¯ä»¥çœ‹åšä¸€ç§è¿ç»­å†…å­˜ç©ºé—´çš„&quot;åŒå‘é“¾è¡¨&quot;</li><li>åˆ—è¡¨çš„èŠ‚ç‚¹ä¹‹é—´ä¸æ˜¯é€šè¿‡æŒ‡é’ˆè¿æ¥ï¼Œè€Œæ˜¯è®°å½•ä¸Šä¸€èŠ‚ç‚¹å’Œæœ¬èŠ‚ç‚¹é•¿åº¦æ¥å¯»å€ï¼Œå†…å­˜å ç”¨è¾ƒä½</li><li>å¦‚æœåˆ—è¡¨æ•°æ®è¿‡å¤šï¼Œå¯¼è‡´é“¾è¡¨è¿‡é•¿ï¼Œå¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½</li><li>å¢æˆ–åˆ è¾ƒå¤§æ•°æ®æ—¶æœ‰å¯èƒ½å‘ç”Ÿè¿ç»­æ›´æ–°é—®é¢˜</li></ol><h3 id="_5quicklist" tabindex="-1"><a class="header-anchor" href="#_5quicklist"><span>â‘¤QuickList</span></a></h3><p>é—®é¢˜1ï¼š ZipList è™½ç„¶èŠ‚çœå†…å­˜ï¼Œä½†ç”³è¯·å†…å­˜å¿…é¡»æ˜¯è¿ç»­ç©ºé—´ï¼Œå¦‚æœå†…å­˜å ç”¨è¾ƒå¤šï¼Œç”³è¯·æ•ˆç‡å¾ˆä½ï¼Œæ€æœ¨åŠï¼Ÿ</p><p>ä¸ºäº†ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»é™åˆ¶ ZipList çš„é•¿åº¦å’Œentryå¤§å°</p><p>é—®é¢˜2ï¼šä½†æ˜¯æˆ‘ä»¬å°±æ˜¯è¦å­˜å‚¨å¤§é‡æ•°æ®ï¼Œè¶…å‡ºäº† ZipList æœ€ä½³ä¸Šé™è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ª ZipList æ¥åˆ†ç‰‡å­˜å‚¨æ•°æ®ã€‚</p><p>é—®é¢˜3ï¼šæ•°æ®æ‹†åˆ†åæ¯”ä»·åˆ†æ•£ï¼Œæ¯”æ–¹ä¾¿ç®¡ç†å’ŒæŸ¥æ‰¾ï¼Œè¿™å¤šä¸ª ZipList å¦‚ä½•å»ºç«‹è”ç³»ï¼Ÿ</p><p>Redis åœ¨3.2ç‰ˆæœ¬å¼•ç”¨äº†æ–°çš„æ•°æ®ç»“æ„ QuickListï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒç«¯é“¾è¡¨ï¼Œåªä¸è¿‡é“¾è¡¨ä¸­çš„æ¯ä¸ª èŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªZipListã€‚</p><p><mark>QuickListæ€»ä½“ç»“æ„</mark></p><figure><img src="http://images.xyzzs.top/image/image-20230122192805321.png_char" alt="image-20230122192805321" tabindex="0" loading="lazy"><figcaption>image-20230122192805321</figcaption></figure><p><mark>é¿å…QuickListè¿‡å¤§</mark></p><ol><li><!----><p>ä¸ºäº†é¿å…QuickListä¸­çš„æ¯ä¸ªZipListçš„entryè¿‡å¤šï¼ŒRedisæä¾›äº†ä¸€ä¸ªé…ç½®é¡¹ï¼šlist-max-ziplist-sizeæ¥é™åˆ¶ã€‚</p><ul><li><p>å¦‚æœå€¼ä¸ºæ­£ï¼Œåˆ™ä»£è¡¨ZipListçš„å…è®¸çš„entryä¸ªæ•°çš„æœ€å¤§å€¼ï¼›</p></li><li><p>å¦‚æœå€¼ä¸ºè´Ÿï¼Œåˆ™ä»£è¡¨ZipListçš„æœ€å¤§å†…å­˜å¤§å°ï¼Œåˆ†5ç§æƒ…å†µï¼š</p><ol><li>-1ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡4kb</li><li>-2ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡8kbï¼ˆé»˜è®¤å€¼ï¼‰</li><li>-3ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡16kb</li><li>-4ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡32kb</li><li>-5ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡64kb</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>config get list-max-ziplist-size
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="http://images.xyzzs.top/image/image-20230122193828142.png_char" alt="image-20230122193828142" tabindex="0" loading="lazy"><figcaption>image-20230122193828142</figcaption></figure></li></ul></li><li><!----></li></ol><p>â€‹ é™¤äº†æ§åˆ¶ZipListçš„å¤§å°ï¼ŒQuickListè¿˜å¯ä»¥å¯¹èŠ‚ç‚¹çš„ZipListåšå‹ç¼©ã€‚é€šè¿‡é…ç½®é¡¹list-compress-depthæ¥æ§åˆ¶ã€‚å› ä¸ºé“¾è¡¨ä¸€èˆ¬éƒ½æ˜¯ä»é¦–å°¾è®¿é—®è¾ƒå¤šï¼Œæ‰€ä»¥é¦–å°¾æ˜¯ä¸å‹ç¼©çš„ã€‚è¿™ä¸ªå‚æ•°æ˜¯æ§åˆ¶é¦–å°¾ä¸å‹ç¼©çš„èŠ‚ç‚¹ä¸ªæ•°ï¼š</p><ul><li>0ï¼šç‰¹æ®Šå€¼ï¼Œä»£è¡¨ä¸å‹ç¼©ï¼ˆé»˜è®¤ï¼‰</li><li>1ï¼šè¡¨ç¤ºQuickListçš„çš„é¦–å°¾å„æœ‰1ä¸ªèŠ‚ç‚¹ä¸å‹ç¼©ï¼Œä¸­é—´èŠ‚ç‚¹å‹ç¼©</li><li>2ï¼šè¡¨ç¤ºQuickListçš„çš„é¦–å°¾å„æœ‰2ä¸ªèŠ‚ç‚¹ä¸å‹ç¼©ï¼Œä¸­é—´èŠ‚ç‚¹å‹ç¼©</li><li>ä»¥æ­¤ç±»æ¨</li></ul><figure><img src="http://images.xyzzs.top/image/image-20230122195421913.png_char" alt="image-20230122195421913" tabindex="0" loading="lazy"><figcaption>image-20230122195421913</figcaption></figure><p><mark>ç»“æ„åŠæºç </mark></p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklist</span> <span class="token punctuation">{</span>
    quicklistNode <span class="token operator">*</span>head<span class="token punctuation">;</span>
    quicklistNode <span class="token operator">*</span>tail<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> count<span class="token punctuation">;</span>        <span class="token comment">/* total count of all entries in all ziplists */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">;</span>          <span class="token comment">/* number of quicklistNodes */</span>
    <span class="token keyword">int</span> fill <span class="token operator">:</span> QL_FILL_BITS<span class="token punctuation">;</span>              <span class="token comment">/* fill factor for individual nodes */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> compress <span class="token operator">:</span> QL_COMP_BITS<span class="token punctuation">;</span> <span class="token comment">/* depth of end nodes not to compress;0=off */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> bookmark_count<span class="token operator">:</span> QL_BM_BITS<span class="token punctuation">;</span>
    quicklistBookmark bookmarks<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> quicklist<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>zl<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> sz<span class="token punctuation">;</span>             <span class="token comment">/* ziplist size in bytes */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> count <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span>     <span class="token comment">/* count of items in ziplist */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> encoding <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">/* RAW==1 or LZF==2 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> container <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">/* NONE==1 or ZIPLIST==2 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> recompress <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* was this node previous compressed? */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> attempted_compress <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* node can&#39;t compress; too small */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> extra <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">/* more bits to steal for future usage */</span>
<span class="token punctuation">}</span> quicklistNode<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://images.xyzzs.top/image/image-20230122200438739.png_char" alt="image-20230122200438739" tabindex="0" loading="lazy"><figcaption>image-20230122200438739</figcaption></figure><p><mark>ç‰¹ç‚¹</mark></p><ul><li>æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸ºZipListçš„åŒç«¯é“¾è¡¨</li><li>èŠ‚ç‚¹é‡‡ç”¨ZipListï¼Œè§£å†³äº†ä¼ ç»Ÿé“¾è¡¨çš„å†…å­˜å ç”¨é—®é¢˜</li><li>æ§åˆ¶äº†ZipListå¤§å°ï¼Œè§£å†³è¿ç»­å†…å­˜ç©ºé—´ç”³è¯·æ•ˆç‡é—®é¢˜</li><li>ä¸­é—´èŠ‚ç‚¹å¯ä»¥å‹ç¼©ï¼Œè¿›ä¸€æ­¥èŠ‚çœäº†å†…å­˜</li></ul><h3 id="_6skiplist" tabindex="-1"><a class="header-anchor" href="#_6skiplist"><span>â‘¥SkipList</span></a></h3><p>SkipListé¦–å…ˆæ˜¯é“¾è¡¨ï¼Œä½†ä¸ä¼ ç»Ÿé“¾è¡¨ç›¸æ¯”æœ‰å‡ ç‚¹å·®å¼‚ï¼š</p><ul><li>å…ƒç´ æŒ‰ç…§å‡çº§æ’åˆ—å­˜å‚¨</li><li>èŠ‚ç‚¹å¯èƒ½åŒ…å«å¤šä¸ªæŒ‡é’ˆï¼ˆæœ€å¤šæœ‰32çº§ï¼‰ï¼ŒæŒ‡é’ˆè·¨åº¦ä¸åŒ</li></ul><figure><img src="http://images.xyzzs.top/image/image-20230122202833688.png_char" alt="image-20230122202833688" tabindex="0" loading="lazy"><figcaption>image-20230122202833688</figcaption></figure><p><mark>ç‰¹ç‚¹</mark></p><ul><li>è·³è·ƒè¡¨æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«scoreå’Œeleå€¼</li><li>èŠ‚ç‚¹æŒ‰ç…§scoreå€¼æ’åºï¼Œscoreå€¼ä¸€æ ·åˆ™æŒ‰ç…§eleå­—å…¸æ’åº</li><li>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥åŒ…å«å¤šå±‚æŒ‡é’ˆï¼Œå±‚æ•°æ˜¯1åˆ°32ä¹‹é—´çš„éšæœºæ•°ï¼ˆæ ¹æ®ç®—æ³•å»æ¨æµ‹ï¼‰</li><li>ä¸åŒå±‚æŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„è·¨åº¦ä¸åŒï¼Œå±‚çº§è¶Šé«˜ï¼Œè·¨åº¦è¶Šå¤§</li><li>å¢åˆ æ”¹æŸ¥æ•ˆç‡ä¸çº¢é»‘æ ‘åŸºæœ¬ä¸€ç›´ï¼Œå®ç°å´æ›´ç®€å•</li></ul><h3 id="redisobject" tabindex="-1"><a class="header-anchor" href="#redisobject"><span>RedisObject</span></a></h3><p>Redisä¸­çš„ä»»æ„æ•°æ®ç±»å‹çš„é”®å’Œå€¼éƒ½ä¼šè¢«å°è£…ä¸ºä¸€ä¸ªRedisObjectï¼Œä¹Ÿå«åšRediså¯¹è±¡</p><figure><img src="http://images.xyzzs.top/image/image-20230122204056965.png_char" alt="image-20230122204056965" tabindex="0" loading="lazy"><figcaption>image-20230122204056965</figcaption></figure><p>Redisä¸­ä¼šæ ¹æ®å­˜å‚¨çš„æ•°æ®ç±»å‹ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„ç¼–ç æ–¹å¼ï¼Œå…±åŒ…å«11ç§ä¸åŒç±»å‹ï¼š</p><table><thead><tr><th>ç¼–å·</th><th>ç¼–ç æ–¹å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>0</td><td>OBJ_ENCODING_RAW</td><td>rawç¼–ç åŠ¨æ€å­—ç¬¦ä¸²</td></tr><tr><td>1</td><td>OBJ_ENCODING_INT</td><td>longç±»å‹çš„æ•´æ•°çš„å­—ç¬¦ä¸²</td></tr><tr><td>2</td><td>OBJ_ENCODING_HT</td><td>hashè¡¨ï¼ˆå­—å…¸dictï¼‰</td></tr><tr><td>3</td><td>OBJ_ENCODING_ZIPMAP</td><td>å·²åºŸå¼ƒ</td></tr><tr><td>4</td><td>OBJ_ENCODING_LINKEDLIST</td><td>åŒç«¯é“¾è¡¨</td></tr><tr><td>5</td><td>OBJ_ENCODING_ZIPLIST</td><td>å‹ç¼©åˆ—è¡¨å•Š</td></tr><tr><td>6</td><td>OBJ_ENCODING_INTSET</td><td>æ•´æ•°é›†åˆ</td></tr><tr><td>7</td><td>OBJ_ENCODING_SKIPLIST</td><td>è·³è¡¨</td></tr><tr><td>8</td><td>OBJ_ENCODING_EMBSTR</td><td>embstrçš„åŠ¨æ€å­—ç¬¦ä¸²</td></tr><tr><td>9</td><td>OBJ_ENCODING_QUICKLIST</td><td>å¿«é€Ÿåˆ—è¡¨</td></tr><tr><td>10</td><td>OBJ_ENCODING_STREAM</td><td>Streamæµ</td></tr></tbody></table><p>Redisä¸­ä¼šæ ¹æ®å­˜å‚¨çš„æ•°æ®ç±»å‹ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„ç¼–ç æ–¹å¼ã€‚æ¯ç§æ•°æ®ç±»å‹ä½¿ç”¨çš„ç¼–ç æ–¹å¼ å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>ç¼–ç æ–¹å¼</th></tr></thead><tbody><tr><td>OBJ_STRING</td><td>intã€embstrã€raw</td></tr><tr><td>OBJ_LIST</td><td>LinkedListå’ŒZipListï¼ˆ3.2ä¹‹å‰ï¼‰ã€QuickListï¼ˆ3.2ä»¥åï¼‰</td></tr><tr><td>OBJ_SET</td><td>intsetã€HT</td></tr><tr><td>OBJ_ZSET</td><td>ZipListã€HTã€SkipList</td></tr><tr><td>OBJ_HASH</td><td>ZipListã€HT</td></tr></tbody></table><h2 id="äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹" tabindex="-1"><a class="header-anchor" href="#äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹"><span>äº”ç§å¸¸ç”¨æ•°æ®ç±»å‹</span></a></h2><h3 id="åº•å±‚å®ç°â€”â€”string" tabindex="-1"><a class="header-anchor" href="#åº•å±‚å®ç°â€”â€”string"><span>åº•å±‚å®ç°â€”â€”String</span></a></h3><p>Stringæ˜¯Redisä¸­æœ€å¸¸è§çš„æ•°æ®å­˜å‚¨ç±»å‹ï¼š</p><ol><li><p>å…¶åŸºæœ¬ç¼–ç æ–¹å¼æ˜¯<mark> RAWÂ </mark>ï¼ŒåŸºäºç®€å•åŠ¨æ€å­—ç¬¦ä¸² SDS å®ç°ï¼Œ<!---->ã€‚</p><figure><img src="http://images.xyzzs.top/image/image-20230123104322060.png_char" alt="image-20230123104322060" tabindex="0" loading="lazy"><figcaption>image-20230123104322060</figcaption></figure></li><li><p>å¦‚æœå­˜å‚¨çš„<!---->ï¼Œåˆ™é‡‡ç”¨<mark>EMBSTRç¼–ç </mark>ï¼Œæ­¤æ—¶ objecthead å’Œ SDS æ˜¯ä¸€æ®µè¿ç»­ç©ºé—´ã€‚ç”³è¯·å†…å­˜åªéœ€è¦è°ƒç”¨ä¸€æ¬¡å†…å­˜åˆ†é…å‡½æ•°ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p><figure><img src="http://images.xyzzs.top/image/image-20230123104423346.png_char" alt="image-20230123104423346" tabindex="0" loading="lazy"><figcaption>image-20230123104423346</figcaption></figure></li><li><p>å¦‚æœ<!---->ï¼Œå¹¶ä¸”å¤§å°åœ¨LONG_MAXèŒƒå›´å†…ï¼Œåˆ™ä¼šé‡‡ç”¨<mark>INTç¼–ç </mark>ï¼šç›´æ¥å°†æ•°æ®ä¿å­˜å†RedisObjectçš„ptræŒ‡é’ˆä½ç½®ï¼ˆåˆšå¥½8å­—èŠ‚ï¼‰ï¼Œä¸å†éœ€è¦SDSã€‚</p><figure><img src="http://images.xyzzs.top/image/image-20230123104535027.png_char" alt="image-20230123104535027" tabindex="0" loading="lazy"><figcaption>image-20230123104535027</figcaption></figure></li></ol><p>å®¢æˆ·ç«¯éªŒè¯</p><figure><img src="http://images.xyzzs.top/image/image-20230123105908327.png_char" alt="image-20230123105908327" tabindex="0" loading="lazy"><figcaption>image-20230123105908327</figcaption></figure><h3 id="åº•å±‚å®ç°â€”â€”list" tabindex="-1"><a class="header-anchor" href="#åº•å±‚å®ç°â€”â€”list"><span>åº•å±‚å®ç°â€”â€”List</span></a></h3><p>Listç±»å‹å¯ä»¥ä»é˜Ÿé¦–ã€é˜Ÿå°¾æ“ä½œåˆ—è¡¨ä¸­çš„å…ƒç´ </p><img src="http://images.xyzzs.top/image/image-20230123113427574.png_char" alt="image-20230123113427574" style="zoom:45%;"><p>åˆ†æï¼šå“ªç§æ•°æ®æ›´èƒ½æ»¡è¶³ä»¥ä¸Šç‰¹å¾ï¼Ÿ</p><ul><li>LinkedListï¼šæ™®é€šé“¾è¡¨ï¼Œå¯ä»¥ä»åŒç«¯è®¿é—®ï¼Œå†…å­˜å ç”¨è¾ƒé«˜ï¼Œå†…å­˜ç¢ç‰‡è¾ƒå¤š</li><li>ZipListï¼šå‹ç¼©åˆ—è¡¨ï¼Œå¯ä»¥ä»åŒç«¯è®¿é—®ï¼Œå†…å­˜å ç”¨è¾ƒä½ï¼Œå­˜å‚¨ä¸Šé™ä½</li><li>QuickListï¼šå¯ä»¥ä»åŒç«¯è®¿é—®ï¼Œå†…å­˜å ç”¨è¾ƒä½ï¼ŒåŒ…å«å¤šä¸ªZipListï¼Œå­˜å‚¨ä¸Šé™é«˜</li></ul><p><mark>Liståº•å±‚å®ç°</mark></p><ul><li>åœ¨3.2ç‰ˆæœ¬ä¹‹å‰ï¼ŒRedisé‡‡ç”¨ZipListå’ŒLinkedListæ¥å®ç°Listï¼Œå½“å…ƒç´ æ•°é‡å°äº512å¹¶ä¸”å…ƒç´ å¤§å°å°äº64å­—èŠ‚æ—¶é‡‡ç”¨ZipListç¼–ç ï¼Œè¶…è¿‡åˆ™é‡‡ç”¨LinkedListç¼–ç </li><li>åœ¨3.2ç‰ˆæœ¬åï¼ŒRedisç»Ÿä¸€é‡‡ç”¨<!---->æ¥å®ç°List</li></ul><figure><img src="http://images.xyzzs.top/image/image-20230123122029937.png_char" alt="image-20230123122029937" tabindex="0" loading="lazy"><figcaption>image-20230123122029937</figcaption></figure><h3 id="åº•å±‚å®ç°â€”â€”set" tabindex="-1"><a class="header-anchor" href="#åº•å±‚å®ç°â€”â€”set"><span>åº•å±‚å®ç°â€”â€”Set</span></a></h3><p>Setæ˜¯Redisçš„ä¸­å•åˆ—é›†åˆï¼Œæ»¡è¶³ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>ä¸ä¿è¯æœ‰åºæ€§</li><li>ä¿è¯å…ƒç´ å”¯ä¸€ï¼ˆå¯ä»¥åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼‰</li><li>æ±‚äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼ŒæŸ¥è¯¢æ•ˆç‡è¦æ±‚é«˜</li></ul><img src="http://images.xyzzs.top/image/image-20230123123941680.png_char" alt="image-20230123123941680" style="zoom:50%;"><p><mark>Setåº•å±‚å®ç°</mark></p><ol><li><p>ä¸ºäº†ä¿è¯æŸ¥è¯¢æ•ˆç‡å’Œå”¯ä¸€æ€§ï¼ŒSeté‡‡ç”¨<!---->ã€‚Dictä¸­çš„keyç”¨æ¥å­˜å‚¨å…ƒç´ ï¼Œvalueç»Ÿä¸€ä¸º<code>null</code></p></li><li><p>å½“å­˜å‚¨çš„<!---->ï¼Œå¹¶ä¸”å…ƒç´ æ•°é‡ä¸è¶…è¿‡<!---->æ—¶ï¼ˆé»˜è®¤512ï¼‰ï¼ŒSetä¼šé‡‡ç”¨<!---->ï¼ŒèŠ‚çœå†…å­˜ï¼›å¦‚æœæ’å…¥ä¸€ä¸ªéæ•´æ•°ï¼Œå‡çº§åˆ°dictç±»å‹</p></li></ol><figure><img src="http://images.xyzzs.top/image/image-20230123125355831.png_char" alt="image-20230123125355831" tabindex="0" loading="lazy"><figcaption>image-20230123125355831</figcaption></figure><h3 id="åº•å±‚å®ç°â€”â€”zset" tabindex="-1"><a class="header-anchor" href="#åº•å±‚å®ç°â€”â€”zset"><span>åº•å±‚å®ç°â€”â€”ZSet</span></a></h3><p>ZSetä¹Ÿå°±æ˜¯SortedSetï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªscoreå€¼å’Œmemberå€¼ï¼Œä¸”æ»¡è¶³ä»¥ä¸‹ç‰¹å¾ï¼š</p><ul><li><p>å¯ä»¥æ ¹æ®scoreå€¼æ’åºï¼ˆæœ‰åºï¼‰</p></li><li><p>memberå¿…é¡»å”¯ä¸€ï¼ˆé”®å”¯ä¸€ï¼‰</p></li><li><p>å¯ä»¥æ ¹æ®memberæŸ¥è¯¢åˆ†æ•°ï¼ˆé”®å€¼å­˜å‚¨ï¼Œæ•ˆç‡ï¼‰</p><figure><img src="http://images.xyzzs.top/image/image-20230123130324355.png_char_char" alt="image-20230123130324355" tabindex="0" loading="lazy"><figcaption>image-20230123130324355</figcaption></figure></li></ul><p>å›é¡¾ï¼š</p><ul><li>SkipListï¼šå¯æ’åºï¼Œå¹¶ä¸”å¯ä»¥é”®å€¼å­˜å‚¨scoreå’Œeleå€¼ï¼Œä½†<!----></li><li>HTï¼ˆDictï¼‰ï¼šå¯ä»¥é”®å€¼å­˜å‚¨ï¼Œæ»¡è¶³é”®éœ€å”¯ä¸€ï¼Œä¸”æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œä½†<!----></li></ul><p>å°å­©å­æ‰åšé€‰æ‹©ï¼Œæˆ‘ä»¬å…¨éƒ½è¦ï¼š</p><ol><li><!----><ul><li><p>Dict æ¥å®ç°é”®å€¼å­˜å‚¨ï¼Œé”®çš„å”¯ä¸€</p></li><li><p>SkipList å®ç°å¯æ’åº</p><img src="http://images.xyzzs.top/image/image-20230123132144199.png_char_char" alt="image-20230123132144199" style="zoom:50%;"></li></ul></li><li><p>å½“<!---->ï¼Œé‡‡ç”¨ HT å’Œ SkipList çš„ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ï¼Œè€Œä¸”<strong>æ›´è€—å†…å­˜</strong>ã€‚å› æ­¤zsetè¿˜ä¼š<!---->å­˜å‚¨æ¥èŠ‚çœå†…å­˜ï¼Œä¸è¿‡éœ€è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>å…ƒç´ æ•°é‡å°äºzset-max-ziplist-entriesï¼Œé»˜è®¤å€¼128</li><li>æ¯ä¸ªå…ƒç´ éƒ½å°äºzset-max-ziplist-valueå­—èŠ‚ï¼Œé»˜è®¤å€¼64</li></ul><p>ZipListæœ¬èº«æ²¡æœ‰æ’åºåŠŸèƒ½ï¼Œè€Œä¸”æ²¡æœ‰é”®å€¼å¯¹çš„æ¦‚å¿µï¼Œå› æ­¤éœ€è¦æœ‰ç”± zset é€šè¿‡ç¼–ç å®ç°ï¼š</p><p>ğŸ”·ZipListæ˜¯è”ç³»å†…å­˜ï¼Œå› æ­¤scoreå’Œelementæ˜¯ç´§æŒ¨åœ¨ä¸€èµ·çš„ä¸¤ä¸ªentryï¼Œelementåœ¨å‰ï¼Œscoreåœ¨å;</p><p>ğŸ”·scoreè¶Šå°è¶Šæ¥è¿‘é˜Ÿé¦–ï¼Œscoreè¶Šå¤§è¶Šæ¥è¿‘é˜Ÿå°¾ï¼ŒæŒ‰ç…§scoreå€¼å‡åºæ’åˆ—</p><figure><img src="http://images.xyzzs.top/image/image-20230123135653225.png_char_char" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ol><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zset</span> <span class="token punctuation">{</span>
    <span class="token comment">// DictæŒ‡é’ˆ</span>
    dict <span class="token operator">*</span>dict<span class="token punctuation">;</span>
    <span class="token comment">// SkipListæŒ‡é’ˆ</span>
    zskiplist <span class="token operator">*</span>zsl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åº•å±‚å®ç°â€”â€”hash" tabindex="-1"><a class="header-anchor" href="#åº•å±‚å®ç°â€”â€”hash"><span>åº•å±‚å®ç°â€”â€”Hash</span></a></h3><p>Hashç»“æ„ä¸ZSetæ¯”ä»·ç±»ä¼¼ï¼š</p><ul><li>éƒ½æ˜¯é”®å€¼å­˜å‚¨</li><li>éƒ½éœ€è¦æ ¹æ®é”®è·å–å€¼</li><li>é”®å¿…é¡»å”¯ä¸€</li></ul><p>ä½†ä¹Ÿæœ‰åŒºåˆ«ï¼š</p><p>ZSet çš„é”®æ˜¯memberï¼Œå€¼æ˜¯scoreï¼Œå¿…é¡»ä¸ºæ•°å­—ï¼Œä»¥æ­¤æ¥æ’åºï¼Œæœ‰åºï¼›</p><p>hashçš„é”®å’Œå€¼éƒ½æ˜¯ä»»æ„å€¼ï¼Œæ— åº</p><p>å› æ­¤ï¼ŒHashåº•å±‚é‡‡ç”¨çš„ç¼–ç ä¸Zsetä¹ŸåŸºæœ¬ä¸€ç›´ï¼Œåªéœ€æŠŠæ’åºæœ‰å…³çš„SkipListå»æ‰å³å¯</p><ul><li><p>Hashç»“æ„é»˜è®¤é‡‡ç”¨ZipListç¼–ç ï¼Œç”¨ä»¥èŠ‚çœå†…å­˜ï¼Œç›¸é‚»çš„ä¸¤ä¸ªentryåˆ†åˆ«ä¿å­˜fieldå’Œvalue</p></li><li><p>å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼ŒHashç»“æ„ä¼šè½¬ä¸ºHTç¼–ç ï¼Œä¹Ÿå°±æ˜¯Dictï¼Œè§¦å‘æ¡ä»¶æœ‰ä¸¤</p><ol><li><p>Ziplistä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡äº†<!---->ï¼ˆé»˜è®¤512ï¼‰</p></li><li><p>Ziplistä¸­çš„ä»»æ„entryå¤§å°è¶…è¿‡äº†<!---->ï¼ˆé»˜è®¤64è‡ªå·±ï¼‰</p><figure><img src="http://images.xyzzs.top/image/image-20230123142800925.png_char" alt="image-20230123142800925" tabindex="0" loading="lazy"><figcaption>image-20230123142800925</figcaption></figure></li></ol></li></ul><figure><img src="http://images.xyzzs.top/image/image-20230123142606904.png_char" alt="image-20230123142606904" tabindex="0" loading="lazy"><figcaption>image-20230123142606904</figcaption></figure><h3 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><ol><li><p>string</p><ul><li>å¸¸è§„key-valueç¼“å­˜åº”ç”¨ã€‚</li><li>å¸¸è§„è®¡æ•°åŠŸèƒ½ï¼Œå¦‚ç²‰ä¸æ•°ï¼›ç‚¹èµ</li><li>åˆ†å¸ƒå¼é”ã€‚</li></ul></li><li><p>hash</p><ul><li>å­˜æ”¾ç»“æ„åŒ–æ•°æ®ï¼Œå¦‚ç”¨æˆ·ä¿¡æ¯ï¼ˆæ˜µç§°ã€å¹´é¾„ã€æ€§åˆ«ã€ç§¯åˆ†ç­‰ï¼‰ï¼Œå¯¹åº”Javaä¸­çš„ Map&lt;String,map&lt;Object,Object&gt;&gt;</li><li>è´­ç‰©è½¦ï¼ˆé™å°ä¸­å‚ï¼‰</li></ul></li><li><p>list</p><ul><li>çƒ­é—¨åšå®¢åˆ—è¡¨ã€æ–‡ç« è®¢é˜…</li><li>æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€‚ä½¿ç”¨listå¯ä»¥æ„å»ºé˜Ÿåˆ—ç³»ç»Ÿï¼Œæ¯”å¦‚ï¼šå°†Redisç”¨ä½œæ—¥å¿—æ”¶é›†å™¨ï¼Œå¤šä¸ªç«¯ç‚¹å°†æ—¥å¿—ä¿¡æ¯å†™å…¥Redisï¼Œç„¶åä¸€ä¸ªworkerç»Ÿä¸€å°†æ‰€æœ‰æ—¥å¿—å†™åˆ°ç£ç›˜ã€‚</li><li>ç§’æ€æŠ¢è´­åœºæ™¯</li></ul></li><li><p>set</p><ul><li>å¥½å‹å…³ç³»ï¼Œå¾®åšç²‰ä¸çš„å…±åŒå…³æ³¨ã€å…±åŒå–œå¥½ã€å…±åŒå¥½å‹ç­‰</li><li>åˆ©ç”¨å”¯ä¸€æ€§ï¼Œç»Ÿè®¡è®¿é—®ç½‘ç«™çš„æ‰€æœ‰ç‹¬ç«‹ip</li><li>å°ç¨‹åºæŠ½å¥–</li><li>å¾®ä¿¡æœ‹å‹åœˆç‚¹èµ</li><li>å¾®åšå†…å¥½å‹å…³æ³¨ç¤¾äº¤å…³ç³»</li><li>æ¨é€å¯èƒ½è®¤è¯†çš„äºº</li></ul></li><li><p>zsetï¼š</p><ul><li>æ’è¡Œæ¦œï¼šçƒ­æœæ¦œç­‰</li><li>ä¼˜å…ˆçº§é˜Ÿåˆ—</li><li>å¯¹å•†å“è¿›è¡Œæ’åºæ˜¾ç¤º</li></ul></li></ol><h3 id="å¸¸è§å‘½ä»¤æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å¸¸è§å‘½ä»¤æ“ä½œ"><span>å¸¸è§å‘½ä»¤æ“ä½œ</span></a></h3><!----><a href="http://redis.cn/commands.html#" target="_blank" rel="noopener noreferrer">è¯·æŸ¥é˜…<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><hr><ol><li><p>String</p><ul><li><p>SETï¼šæ·»åŠ æˆ–ä¿®æ”¹æ„è§å­˜åœ¨çš„ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹</p></li><li><p>GETï¼šæ ¹æ®keyè·å–Stringç±»å‹çš„value</p></li><li><p>MSETï¼šæ‰¹é‡æ·»åŠ å¤šä¸ªStringç±»å‹çš„é”®å€¼å¯¹</p></li><li><p>MGETï¼šæ ¹æ®å¤šä¸ªkeyè·å–å¤šä¸ªStringç±»å‹çš„value</p></li><li><p>INCRï¼šè®©ä¸€ä¸ªæ•´å‹çš„keyè‡ªå¢1</p></li><li><p>INCRBYï¼šè®©ä¸€ä¸ªæ•´å‹çš„keyè‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</p></li><li><p>INCRBYFLOATï¼šè®©ä¸€ä¸ªæµ®ç‚¹ç±»å‹çš„æ•°å­—è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</p></li><li><p>SETNXï¼šæ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå‰ææ˜¯è¿™ä¸ªkeyä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</p></li><li><p>SETEXï¼šæ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå¹¶ä¸”æŒ‡å®šæœ‰æ•ˆæœŸ</p></li><li><p>APPENDï¼šè¿½åŠ ä¸€ä¸ªå€¼åˆ°keyä¸Š</p></li><li><p>STRLENï¼šè·å–æŒ‡å®š keyçš„é•¿åº¦</p></li><li><p>KEYSå’ŒSCANï¼š<code>KEYS</code>æŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œç›´åˆ°æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚<code>SCAN</code>é‡‡ç”¨æ¸è¿›å¼éå†çš„æ–¹å¼æ¥è§£å†³<code>KEYS</code>å‘½ä»¤å¯èƒ½å¸¦æ¥çš„é˜»å¡é—®é¢˜ï¼Œæ¯æ¬¡<code>SCAN</code>å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œä½†æ˜¯è¦çœŸæ­£å®ç°<code>KEYS</code>çš„åŠŸèƒ½ï¼Œéœ€è¦æ‰§è¡Œå¤šæ¬¡<code>SCAN</code>ã€‚</p><p>scançš„ç¼ºç‚¹ï¼šåœ¨<code>SCAN</code>çš„è¿‡ç¨‹ä¸­å¦‚æœæœ‰é”®çš„å˜åŒ–ï¼ˆå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰ï¼Œéå†è¿‡ç¨‹å¯èƒ½ä¼šæœ‰ä»¥ä¸‹é—®é¢˜ï¼šæ–°å¢çš„é”®å¯èƒ½æ²¡æœ‰éå†åˆ°ï¼Œéå†å‡ºäº†é‡å¤çš„é”®ç­‰æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´scanå¹¶ä¸èƒ½ä¿è¯å®Œæ•´çš„éå†å‡ºæ¥æ‰€æœ‰çš„é”®ã€‚</p><p><strong>è­¦å‘Š</strong>: <code>KEYS</code> çš„é€Ÿåº¦éå¸¸å¿«ï¼Œä½†åœ¨ä¸€ä¸ªå¤§çš„æ•°æ®åº“ä¸­ä½¿ç”¨å®ƒä»ç„¶å¯èƒ½é€ æˆæ€§èƒ½é—®é¢˜ï¼Œå¦‚æœä½ éœ€è¦ä»ä¸€ä¸ªæ•°æ®é›†ä¸­æŸ¥æ‰¾ç‰¹å®šçš„ keyï¼Œ ä½ æœ€å¥½è¿˜æ˜¯ç”¨ Redis çš„é›†åˆç»“æ„ Set æ¥ä»£æ›¿ã€‚</p></li></ul></li><li><p>Hash</p><ul><li>HSETï¼šæ·»åŠ æˆ–ä¿®æ”¹hashç±»å‹keyçš„fieldçš„å€¼ã€‚<code>HSET myhash field1 &quot;Hello&quot;</code></li><li>HGETï¼šè¿”å› key æŒ‡å®šçš„å“ˆå¸Œé›†ä¸­è¯¥å­—æ®µæ‰€å…³è”çš„å€¼ã€‚<code>HGET myhash field1</code></li><li>HMSETï¼šæ‰¹é‡æ·»åŠ å¤šä¸ªhashç±»å‹çš„keyçš„fieldçš„å€¼ã€‚<code>HMSET myhash field1 &quot;Hello&quot; field2 &quot;World&quot;</code></li><li>HMGETï¼šæ‰¹é‡è·å–å¤šä¸ªhashç±»å‹çš„keyçš„fieldçš„å€¼ã€‚<code>HMGET myhash field1 field2 nofield</code></li><li>HGETALLï¼šè·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰fieldçš„å’Œvalueã€‚</li><li>HKEYSï¼šè·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰fieldã€‚</li><li>HAVLSï¼šè·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰valueã€‚</li><li>HINCRBYï¼šè®©ä¸€ä¸ªhashç±»å‹keyçš„å­—æ®µå€¼è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿ã€‚</li><li>HSETNXï¼šæ·»åŠ ä¸€ä¸ªhashç±»å‹çš„keyçš„fieldå€¼ï¼Œå‰ææ˜¯è¿™ä¸ªfieldä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œã€‚</li></ul></li><li><p>List</p><ul><li>LPUSHï¼šå‘åˆ—è¡¨å·¦ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>LPOPï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨å·¦ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰åˆ™è¿”å›<code>nil</code></li><li>RPUSHï¼šå‘åˆ—è¡¨å³ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>RPOPï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨å³ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰åˆ™è¿”å›<code>nil</code></li><li>LRANGEï¼šè¿”å›ä¸€æ®µè§’æ ‡èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ </li><li>BLPOP å’Œ BRPOPï¼šä¸ LPOP å’Œ RPOP ç±»ä¼¼ï¼Œåªä¸è¿‡åœ¨æ²¡æœ‰å…ƒç´ æ—¶ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›<code>nil</code></li><li>LTRIMï¼šåˆ é™¤ç´¢å¼•1åˆ°2ä»¥å¤–çš„æ‰€æœ‰å…ƒç´ <code>LTRIM numbers 1 2</code></li><li>LREMï¼šä»å­˜äº key çš„åˆ—è¡¨é‡Œç§»é™¤å‰ count æ¬¡å‡ºç°çš„å€¼ä¸º value çš„å…ƒç´ ã€‚ è¿™ä¸ª count å‚æ•°é€šè¿‡ä¸‹é¢å‡ ç§æ–¹å¼å½±å“è¿™ä¸ªæ“ä½œï¼š<code>LREM numbers 0 2</code><ul><li>count &lt; 0, åˆ™ä»å³è¾¹å¼€å§‹åˆ é™¤å‰countä¸ªå€¼ä¸ºvalueçš„å…ƒç´ </li><li>count &gt; 0, åˆ™ä»å·¦è¾¹å¼€å§‹åˆ é™¤å‰countä¸ªå€¼ä¸ºvalueçš„å…ƒç´ </li><li>count = 0, åˆ™åˆ é™¤æ‰€æœ‰å€¼ä¸ºvalueçš„å…ƒç´ </li></ul></li></ul></li><li><p>Set</p><ul><li>SADDï¼šå‘setä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>SREMï¼šç§»é™¤setä¸­çš„æŒ‡å®šå…ƒç´ </li><li>SCARNï¼šè¿”å›setä¸­å…ƒç´ çš„ä¸ªæ•°</li><li>SISMEMBERï¼šåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨setä¸­</li><li>SMEMBERSï¼šè·å–setä¸­çš„æ‰€æœ‰å…ƒç´ </li><li>SINTERï¼šäº¤é›†ï¼Œéƒ½æœ‰çš„</li><li>SDIFFï¼šå·®é›†ï¼Œä¸€ä¸ªé›†åˆä¸­æœ‰ï¼Œå¦ä¸€ä¸ªé›†åˆä¸­æ²¡æœ‰</li><li>SUNIONï¼šå¹¶é›†ï¼Œåˆå¹¶åå»æ‰é‡å¤å…ƒç´ </li></ul></li><li><p>Zset</p><ul><li>ZADDï¼šæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ åˆ°sorted setï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™æ›´æ–°scoreå€¼</li><li>ZREMï¼šåˆ é™¤sorted setä¸­çš„ä¸€ä¸ªæŒ‡å®šå…ƒç´ </li><li>ZSCOREï¼šè·å–sorted setä¸­çš„æŒ‡å®šå…ƒç´ çš„scoreå€¼</li><li>ZRANKï¼šè·å–sorted setä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’å</li><li>ZCARDï¼šè·å–sorted setä¸­çš„å…ƒç´ ä¸ªæ•°</li><li>ZCOUNTï¼šç»Ÿè®¡scoreå€¼åœ¨ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ä¸ªæ•°</li><li>ZINCRBYï¼šè®©sorted setä¸­çš„æŒ‡å®šå…ƒç´ è‡ªå¢ï¼Œæ­¥é•¿ä¸ºæŒ‡å®šçš„incrementå€¼</li><li>ZRANGEï¼šæŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®šæ’åèŒƒå›´å†…çš„å…ƒç´ </li><li>ZRANGBYSCOREï¼šæŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®šscoreèŒƒå›´å†…çš„å…ƒç´ </li><li>ZDIFFã€ZINTERã€ZUNIONï¼šæ±‚å·®é›†ã€äº¤é›†ã€å¹¶é›†</li></ul></li></ol><h2 id="æŒä¹…ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#æŒä¹…ç­–ç•¥"><span>æŒä¹…ç­–ç•¥</span></a></h2><h3 id="rdb" tabindex="-1"><a class="header-anchor" href="#rdb"><span>RDB</span></a></h3><p>redis database backup fileï¼ˆRedisæ•°æ®å¤‡ä»½æ–‡ä»¶ ï¼‰</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>save<span class="token operator">:</span>ç”±redisä¸»è¿›ç¨‹æ‰§è¡Œrdbï¼Œä¼šé˜»å¡æ‰€æœ‰å‘½ä»¤ï¼Œç­‰å¾…æ‰§è¡Œå®Œæˆåè¿”å›ok<span class="token operator">-</span>é€‚ç”¨æœåŠ¡å®•æœºã€åœæœºä¹‹å‰
bgsave<span class="token operator">:</span>å¼€å¯å­è¿›ç¨‹æ‰§è¡Œrdbï¼Œé¿å…ä¸»è¿›ç¨‹å—åˆ°å½±å“ï¼Œæ‰§è¡Œåç«‹å³<span class="token class-name">Background</span> saving started<span class="token operator">-</span>é€‚ç”¨ä½¿ç”¨ä¸­
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://images.xyzzs.top/image/image-20230123205540797.png_char" alt="image-20230123205540797" tabindex="0" loading="lazy"><figcaption>image-20230123205540797</figcaption></figure><p>Rediså†…éƒ¨æœ‰è§¦å‘RDBçš„æœºåˆ¶ï¼Œå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­é…ç½®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 900 ç§’å†…å¦‚æœè‡³å°‘æœ‰1ä¸ªkeyè¢«ä¿®æ”¹ï¼Œåˆ™æ‰§è¡Œbgsave
save 900 1
save 300 10 
save 60  10000

# è¡¨ç¤ºç¦ç”¨RDB
save &quot;&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>RDBå…¶ä»–é…ç½®ä¹Ÿå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­é…ç½®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># æ˜¯å¦å‹ç¼©ï¼Œå»ºè®®ä¸å¼€å¯ï¼Œå‹ç¼©ä¼šæ¶ˆè€—cpuï¼Œç£ç›˜çš„è¯ä¸å€¼é’±
rdbcompression yes
# RDBæ–‡ä»¶å
dbfilename dump.rdb
# æ–‡ä»¶ä¿å­˜çš„è·¯å¾„ç›®å½•
dir ./
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>RDBæ–¹å¼bgsaveçš„ä¸»è¦åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>forkä¸»è¿›ç¨‹å¾—åˆ°ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…±äº«å†…å­˜ç©ºé—´</li><li>å­è¿›ç¨‹è¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥æ–°çš„RDBæ–‡ä»¶</li><li>ç”¨æ–°RDBæ–‡ä»¶æ›¿æ¢æ—§çš„RDBæ–‡ä»¶</li></ol><p>forké‡‡ç”¨çš„æ˜¯copy-on-writeæŠ€æœ¯ï¼š</p><ul><li><p>å½“ä¸»è¿›ç¨‹æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œè®¿é—®å…±äº«å†…å­˜</p></li><li><p>å½“ä¸»è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œåˆ™ä¼šæ‹·è´ä¸€ä»½æ•°æ®ï¼Œæ‰§è¡Œå†™æ“ä½œ</p><p>âš ï¸å‡è®¾åœ¨è¿›è¡ŒRDBè¿›è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æœ‰å†™æ“ä½œè¯·æ±‚ï¼Œæ­¤æ—¶å ç”¨å†…å­˜ç›¸å½“äºä¸¤å€ï¼</p></li></ul><figure><img src="http://images.xyzzs.top/image/image-20230123213045653.png_char" alt="image-20230123213045653" tabindex="0" loading="lazy"><figcaption>image-20230123213045653</figcaption></figure><hr><p>RDBæ‰§è¡Œæ—¶æœºï¼š</p><ol><li>æ‰‹åŠ¨</li></ol><ul><li>æ‰§è¡Œ<code>SAVE</code>å‘½ä»¤æˆ–æ‰§è¡Œ<code>BGSAVE</code>å‘½ä»¤</li></ul><ol start="2"><li>è¢«åŠ¨è§¦å‘</li></ol><ul><li>æ ¹æ®é…ç½®è§„åˆ™è¿›è¡Œè‡ªåŠ¨å¿«ç…§ï¼Œå¦‚<code>SAVE 300 10</code>,300ç§’å†…è‡³å°‘æœ‰10ä¸ªé”®è¢«ä¿®æ”¹åˆ™è¿›è¡Œå¿«ç…§ã€‚</li><li>å¦‚æœä»èŠ‚ç‚¹æ‰§è¡Œå…¨é‡å¤åˆ¶æ“ä½œï¼Œä¸»èŠ‚ç‚¹è‡ªåŠ¨æ‰§è¡Œbgsaveç”ŸæˆRDBæ–‡ä»¶å¹¶å‘é€ç»™ä»èŠ‚ç‚¹ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œshutdownå‘½ä»¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯AOFæŒä¹…åŒ–åŠŸèƒ½åˆ™è‡ªåŠ¨æ‰§è¡Œbgsaveã€‚</li><li>æ‰§è¡Œdebug reloadå‘½ä»¤é‡æ–°åŠ è½½Redisæ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨è§¦å‘saveæ“ä½œã€‚</li></ul><hr><p>RDBä¼˜ç¼ºç‚¹ï¼š</p><p>ğŸ‘â‘ RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚</p><p>â‘¡å ç”¨ç©ºé—´å¾ˆå°ï¼Œå®ƒä¿å­˜äº† Redis æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®é›†ï¼Œå¾ˆé€‚åˆç”¨äºåšå¤‡ä»½ã€‚</p><p>â‘¢é€‚ç”¨äºç¾éš¾æ¢å¤ï¼Œå®ƒåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å†…å®¹éƒ½éå¸¸ç´§å‡‘ï¼Œå¯ä»¥ï¼ˆåœ¨åŠ å¯†åï¼‰å°†å®ƒä¼ é€åˆ°åˆ«çš„æ•°æ®ä¸­å¿ƒã€‚</p><p>ğŸ‘â‘  RDB æ‰§è¡Œé—´éš”æ—¶é—´é•¿ï¼Œä¸¤æ¬¡ RDB ä¹‹é—´å†™å…¥æ•°æ®æœ‰ä¸¢å¤±çš„é£é™©ï¼›</p><p>â€‹ â‘¡ fork å­è¿›ç¨‹ã€å‹ç¼©ã€å†™å‡º RDB æ–‡ä»¶éƒ½æ¯”è¾ƒè€—æ—¶</p><h3 id="aof" tabindex="-1"><a class="header-anchor" href="#aof"><span>AOF</span></a></h3><p>append only fileï¼ˆè¿½åŠ æ–‡ä»¶ï¼‰</p><p>AOFé»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶æ¥å¼€å¯AOF</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># æ˜¯å¦å¼€å¯AOFåŠŸèƒ½ï¼Œé»˜è®¤æ˜¯no
appendonly yes
# AOFæ–‡ä»¶çš„åç§°
appendfilename &quot;appendonly.aof&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AOFè®°å½•å‘½ä»¤çš„é¢‘ç‡ä¹Ÿå¯ä»¥é€šè¿‡redis.confæ–‡ä»¶æ¥é…ç½®</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code># è¡¨ç¤ºæ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œç«‹å³è®°å½•åˆ°<span class="token constant">AOF</span>æ–‡ä»¶
appendfsync always
# å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥<span class="token constant">AOF</span>ç¼“å†²å™¨ï¼Œç„¶åè¡¨ç¤ºæ¯éš”<span class="token number">1</span>ç§’å°†ç¼“å†²åŒºæ•°æ®å†™åˆ°<span class="token constant">AOF</span>æ–‡ä»¶ï¼Œæ˜¯é»˜è®¤æ–¹æ¡ˆ
appendfsync everysec 
# å†™å‘½ä»¤æ‰§è¡Œå®Œç°æ”¾å…¥<span class="token constant">AOF</span>ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜
appendfsync no
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>é…ç½®é¡¹</th><th>åˆ·ç›˜å®é™…</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>Always</td><td>åŒæ­¥åˆ·ç›˜</td><td>å¯é æ€§é«˜ï¼Œå‡ ä¹ä¸ä¸¢æ•°æ®</td><td>æ€§èƒ½å¼€é”€å¤§</td></tr><tr><td>everysec</td><td>æ¯ç§’åˆ·ç›˜</td><td>æ€§èƒ½é€‚ä¸­</td><td>æœ€å¤šä¸¢å¤±1ç§’æ•°æ®</td></tr><tr><td>no</td><td>æ“ä½œç³»ç»Ÿæ§åˆ¶</td><td>æ€§èƒ½æœ€ä½³</td><td>å¯é æ€§è¾ƒå·®ï¼Œå¯èƒ½ä¸¢å¤±å¤§é‡æ•°æ®</td></tr></tbody></table><p>Rediså¤„ç†çš„æ¯ä¸€ä¸ªå†™å‘½ä»¤éƒ½ä¼šè®°å½•åœ¨AOFæ–‡ä»¶ä¸­</p><ul><li><p>everysecï¼ˆé»˜è®¤ï¼‰: æ¯ç§’è°ƒç”¨ fsync, Redis æ€§èƒ½å’Œæ•°æ®å®‰å…¨æ€§é€‚</p></li><li><p>always: åœ¨æ¯æ¬¡å†™å…¥ appendonly æ—¥å¿—ä¹‹åè°ƒç”¨ fsyncï¼Œé€Ÿåº¦æœ€æ…¢ä½†æ˜¯æ•°æ®å®‰å…¨æ€§æœ€é«˜ã€‚</p></li><li><p>no: ä¸è°ƒç”¨ fsync, è®©æ“ä½œç³»ç»Ÿåœ¨éœ€è¦æ—¶åˆ·æ–°æ•°æ®ï¼Œé€Ÿåº¦æœ€å¿«ã€‚</p></li></ul><p>å› ä¸ºæ˜¯è®°å½•å‘½ä»¤ï¼ŒAOFæ–‡ä»¶ä¼šæ¯”RDBæ–‡ä»¶å¤§çš„å¤šã€‚è€Œä¸”AOFä¼šè®°å½•å¯¹åŒä¸€ä¸ªkeyçš„å¤šæ¬¡å†™æ“ä½œï¼Œä½†åªæœ‰æœ€åä¸€æ¬¡å†™æ“ä½œæ‰æœ‰æ„ä¹‰ã€‚é€šè¿‡<!---->å‘½ä»¤ï¼Œå¯ä»¥è®©AOFæ–‡ä»¶æ‰§è¡Œé‡å†™åŠŸèƒ½ï¼Œç”¨æœ€å°‘çš„å‘½ä»¤è¾¾åˆ°ç›¸åŒæ•ˆæœï¼Œæ—¢èŠ‚çœç©ºé—´ï¼Œä¹Ÿæå‡äº†æ¢å¤æ•ˆç‡ã€‚</p><img src="http://images.xyzzs.top/image/image-20230123234111639.png_char" alt="image-20230123234111639" style="zoom:50%;"><p>Redisä¹Ÿä¼šåœ¨è§¦å‘é˜ˆå€¼æ—¶è‡ªåŠ¨å»é‡å†™AOFæ–‡ä»¶ã€‚é˜ˆå€¼ä¹Ÿå¯ä»¥åœ¨redis.confä¸­é…ç½®ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>#å¼€å¯ï¼šAOF é‡å†™ç”±ä¸¤ä¸ªå‚æ•°å…±åŒæ§åˆ¶ï¼Œauto-aof-rewrite-percentage å’Œ auto-aof-rewrite-min-sizeï¼ŒåŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œåˆ™è§¦å‘ AOF åå°é‡å†™ BGREWRITEAOFã€‚
# AOF æ–‡ä»¶æ¯”ä¸Šæ¬¡æ–‡ä»¶ï¼Œå¢é•¿è¶…è¿‡å¤šå°‘ç™¾åˆ†æ¯”åˆ™è§¦å‘é‡å†™
auto-aof-rewrite-percentage 100
# AOFæ–‡ä»¶ä½“ç§¯æœ€å°å¤šå¤§ä»¥ä¸Šæ‰è§¦å‘é‡å†™
auto-aof-rewrite-min-size 64mb

# å…³é—­ï¼šauto-aof-rewrite-percentage 0ï¼ŒæŒ‡å®š0çš„ç™¾åˆ†æ¯”ï¼Œä»¥ç¦ç”¨è‡ªåŠ¨AOFé‡å†™åŠŸèƒ½ã€‚
auto-aof-rewrite-percentage 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶</p><p>å‡è®¾ AOF çš„æ—¥å¿—ç°åœ¨ 128mb ï¼Œå¦‚æœå‘ç°å¢é•¿çš„æ¯”ä¾‹ï¼Œè¶…è¿‡äº†ä¹‹å‰çš„100%ï¼Œå³ 256 mb ï¼Œå°±å¯èƒ½ä¼šå»è§¦å‘ä¸€æ¬¡rewriteï¼Œä½†æ˜¯æ­¤æ—¶è¿˜è¦å»è·Ÿ min-size ï¼š64 mb å»æ¯”è¾ƒï¼Œ 256 mb &gt; 64 mb ï¼Œæ‰ä¼šå»è§¦å‘rewrite</p><hr><p>AOFç ´æŸæ–‡ä»¶çš„ä¿®å¤ï¼š</p><p>å¦‚æœredisåœ¨appendæ•°æ®åˆ°AOFæ–‡ä»¶æ—¶ï¼Œæœºå™¨å®•æœºäº†ï¼Œå¯èƒ½ä¼šå¯¼è‡´AOFæ–‡ä»¶ç ´æŸ</p><p>ç”¨redis-check-aof --fixå‘½ä»¤æ¥ä¿®å¤ç ´æŸçš„AOFæ–‡ä»¶</p><hr><p>ä¸¤ç§æ–¹å¼å¯¹æ¯”</p><table><thead><tr><th></th><th>RDB</th><th>AOF</th></tr></thead><tbody><tr><td>æŒä¹…åŒ–æ–¹å¼</td><td>å®šæ—¶å¯¹æ•´ä¸ªå†…å­˜åšå¿«ç…§</td><td>è®°å½•æ¯ä¸€æ¬¡æ‰§è¡Œçš„å‘½ä»¤</td></tr><tr><td>æ•°æ®å®Œæ•´æ€§</td><td>ä¸å®Œæ•´ï¼Œä¸¤æ¬¡å¤‡ä»½ä¹‹é—´ä¼šä¸¢å¤±</td><td>ç›¸å¯¹å®Œæ•´ï¼Œå–å†³äºåˆ·ç›˜ç­–ç•¥</td></tr><tr><td>æ–‡ä»¶å¤§å°</td><td>ä¼šæœ‰å‹ç¼©ï¼Œæ–‡ä»¶ä½“ç§¯å°</td><td>è®°å½•å‘½ä»¤ï¼Œæ–‡ä»¶ä½“ç§¯å¾ˆå¤§ï¼Œ bgwriteaoå¯é‡å†™</td></tr><tr><td>å®•æœºæ¢å¤é€Ÿåº¦</td><td>å¾ˆå¿«</td><td>æ…¢</td></tr><tr><td>æ•°æ®æ¢å¤ä¼˜å…ˆçº§</td><td>ä½ï¼Œå› ä¸ºæ•°æ®å®Œæ•´æ€§ä¸å¦‚AOF</td><td>é«˜ï¼Œå› ä¸ºæ•°æ®å®Œæ•´æ€§æ›´é«˜</td></tr><tr><td>ç³»ç»Ÿèµ„æºå ç”¨</td><td>é«˜ï¼Œå¤§é‡CPUå’Œå†…å­˜æ¶ˆè€—</td><td>ä½ï¼Œä¸»è¦æ˜¯ç£ç›˜IOèµ„æºï¼Œä½†AOFé‡å†™æ—¶ä¼šå ç”¨å¤§é‡CPUå’Œå†…å­˜èµ„æº</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>å¯ä»¥å®¹å¿æ•°åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼Œè¿½æ±‚æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦</td><td>å¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜</td></tr></tbody></table><h3 id="æ··åˆæŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#æ··åˆæŒä¹…åŒ–"><span>æ··åˆæŒä¹…åŒ–</span></a></h3><p>â€‹ æ··åˆæŒä¹…åŒ–å¹¶ä¸æ˜¯ä¸€ç§å…¨æ–°çš„æŒä¹…åŒ–æ–¹å¼ï¼Œè€Œæ˜¯å¯¹å·²æœ‰æ–¹å¼çš„ä¼˜åŒ–ã€‚æ··åˆæŒä¹…åŒ–åªå‘ç”Ÿäº AOF é‡å†™è¿‡ç¨‹ã€‚ä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼Œé‡å†™åçš„æ–° AOF æ–‡ä»¶å‰åŠæ®µæ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠæ®µæ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®ã€‚</p><p>â€‹ æ•´ä½“æ ¼å¼ä¸ºï¼š<!----></p><p>â€‹ æ··åˆæŒä¹…åŒ–æœ¬è´¨æ˜¯é€šè¿‡ AOF åå°é‡å†™ï¼ˆbgrewriteaof å‘½ä»¤ï¼‰å®Œæˆçš„ï¼Œä¸åŒçš„æ˜¯å½“å¼€å¯æ··åˆæŒä¹…åŒ–æ—¶ï¼Œfork å‡ºçš„å­è¿›ç¨‹å…ˆå°†å½“å‰å…¨é‡æ•°æ®ä»¥ RDB æ–¹å¼å†™å…¥æ–°çš„ AOF æ–‡ä»¶ï¼Œç„¶åå†å°† AOF é‡å†™ç¼“å†²åŒºï¼ˆaof_rewrite_buf_blocksï¼‰çš„å¢é‡å‘½ä»¤ä»¥ AOF æ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ï¼Œå†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚</p><!----><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># å¼€å¯ï¼šåœ¨ redis 4 åˆšå¼•å…¥æ—¶ï¼Œé»˜è®¤æ˜¯å…³é—­æ··åˆæŒä¹…åŒ–çš„ï¼Œä½†æ˜¯åœ¨ redis 5 ä¸­é»˜è®¤å·²ç»æ‰“å¼€äº†ã€‚
aof-use-rdb-preamble yes
# å…³é—­
aof-use-rdb-preamble no
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¼˜ç‚¹ï¼šç»“åˆ RDB å’Œ AOF çš„ä¼˜ç‚¹, æ›´å¿«çš„é‡å†™å’Œæ¢å¤ã€‚</p><p>ç¼ºç‚¹ï¼šAOF æ–‡ä»¶é‡Œé¢çš„ RDB éƒ¨åˆ†ä¸å†æ˜¯ AOF æ ¼å¼ï¼Œå¯è¯»æ€§å·®ã€‚</p><h2 id="ç¼“å­˜æ›´æ–°ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜æ›´æ–°ç­–ç•¥"><span>ç¼“å­˜æ›´æ–°ç­–ç•¥</span></a></h2><table><thead><tr><th></th><th>å†…å­˜æ·˜æ±°</th><th>è¶…æ—¶å‰”é™¤</th><th>ä¸»åŠ¨æ›´æ–°</th></tr></thead><tbody><tr><td>æè¿°</td><td>åˆ©ç”¨Rediså†…å­˜æ·˜æ±°æœºåˆ¶ï¼Œå½“å†…å­˜ä¸è¶³æ—¶è‡ªåŠ¨æ·˜æ±°éƒ¨åˆ†æ•°æ®</td><td>ç»™ç¼“å­˜æ•°æ®æ·»åŠ TTLæ—¶é—´ï¼Œåˆ°æœŸåè‡ªåŠ¨åˆ é™¤ç¼“å­˜ï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°ç¼“å­˜ã€‚</td><td>ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨ä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶ï¼Œæ›´æ–°ç¼“å­˜</td></tr><tr><td>ä¸€è‡´æ€§</td><td>å·®</td><td>ä¸€èˆ¬</td><td>å¥½</td></tr><tr><td>ç»´æŠ¤æˆæœ¬</td><td>æ— </td><td>ä½</td><td>é«˜</td></tr></tbody></table><p><mark>ä¸»åŠ¨æ›´æ–°ç­–ç•¥</mark></p><p>â“åˆ é™¤ç¼“å­˜è¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</p><ul><li>æ›´æ–°ç¼“å­˜ï¼šæ¯æ¬¡æ›´æ–°æ•°æ®åº“æ—¶éƒ½æ›´æ–°ç¼“å­˜ï¼Œå¯èƒ½äº§ç”Ÿå¤šæ¬¡æ›´æ–°ç¼“å­˜ï¼Œä½†æœŸé—´æ²¡äººæ¥æŸ¥è¯¢ç¼“å­˜ï¼Œäº§ç”Ÿæ— æ•ˆå†™è¾ƒå¤šã€‚âŒ</li><li>åˆ é™¤ç¼“å­˜ï¼šæ›´æ–°æ•°æ®åº“æ—¶ï¼Œè®©ç¼“å­˜å¤±æ•ˆï¼ŒæŸ¥è¯¢æ—¶å†æ›´æ–°ç¼“å­˜ã€‚âœ”ï¸</li></ul><p>â“å…ˆæ“ä½œç¼“å­˜è¿˜æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Ÿ</p><ul><li><!---->ï¼šç¼“å­˜åˆ é™¤åï¼Œæ›´æ–°æ•°æ®åº“å¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œå¹¶å‘ç¯å¢ƒä¸‹ï¼Œå…¶ä»–çº¿ç¨‹æ­¤æ—¶è¿›æ¥å¯èƒ½æ— æ³•æ„ŸçŸ¥åˆ°ç¼“å­˜çš„å­˜åœ¨ï¼Œç›´æ¥æŸ¥è¯¢æ•°æ®åº“å¹¶è¿”å›ã€‚<!---->ä¸æ¨èâŒ<figure><img src="http://images.xyzzs.top/image/image-20230125110532941.png_char" alt="image-20230125110532941" tabindex="0" loading="lazy"><figcaption>image-20230125110532941</figcaption></figure></li><li><!---->ï¼šåœ¨æŸ¥è¯¢æ•°æ®åº“åæ›´æ–°ç¼“å­˜å‰ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹æ›´æ–°äº†æ•°æ®åº“æ•°æ®ï¼Œå¯¼è‡´æ•°æ®åº“æ•°æ®å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´ã€‚<!---->æ¨èâœ”ï¸<figure><img src="http://images.xyzzs.top/image/image-20230125111321967.png_char" alt="image-20230125111321967" tabindex="0" loading="lazy"><figcaption>image-20230125111321967</figcaption></figure></li></ul><p>æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©æœ€ä½³å®è·µæ–¹æ¡ˆï¼š</p><ol><li>ä½ä¸€è‡´æ€§éœ€æ±‚ï¼šä½¿ç”¨Redisè‡ªå¸¦çš„å†…å­˜æ·˜æ±°æœºåˆ¶ã€‚</li><li>é«˜ä¸€è‡´æ€§éœ€æ±‚ï¼šä¸»åŠ¨æ›´æ–°ï¼Œå¹¶ä»¥è¶…æ—¶å‰”é™¤ä½œä¸ºå…œåº•æ–¹æ¡ˆã€‚ <ul><li>è¯»æ“ä½œ <ul><li>ç¼“å­˜å‘½ä¸­åˆ™ç›´æ¥è¿”å›</li><li>ç¼“å­˜æœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶å†™å…¥ç¼“å­˜ï¼Œè®¾å®šè¶…æ—¶æ—¶é—´</li></ul></li><li>å†™æ“ä½œ <ul><li>å…ˆå†™æ•°æ®åº“ï¼Œç„¶åå†åˆ é™¤ç¼“å­˜</li><li>å¿…è¦æ—¶ï¼Œç¡®ä¿æ•°æ®åº“ä¸ç¼“å†²æ“ä½œçš„åŸå­æ€§</li></ul></li></ul></li></ol><h2 id="å†…å­˜ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#å†…å­˜ç­–ç•¥"><span>å†…å­˜ç­–ç•¥</span></a></h2><h3 id="è¿‡æœŸç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#è¿‡æœŸç­–ç•¥"><span>è¿‡æœŸç­–ç•¥</span></a></h3><p>ğŸ¤” æ€è€ƒï¼šRediså¦‚ä½•çŸ¥é“ä¸€ä¸ªkeyæ˜¯å¦è¿‡æœŸå‘¢ï¼Ÿå¦‚æœTTLåˆ°æœŸåæ˜¯å¦ç«‹å³åˆ é™¤å‘¢ï¼Ÿ</p><p>Redisæœ¬èº«æ˜¯ä¸€ä¸ªå…¸å‹çš„key-valueå†…å­˜å­˜å‚¨æ•°æ®åº“ï¼Œå› æ­¤æ‰€æœ‰çš„keyã€valueéƒ½ä¿å­˜åœ¨Dictç»“æ„ä¸­ã€‚ä¸è¿‡åœ¨å…¶databaseç»“æ„ä½“ä¸­ï¼Œæœ‰ä¸¤ä¸ªDictï¼šä¸€ä¸ªç”¨æ¥è®°å½•key-valueï¼›å¦ä¸€ä¸ªç”¨æ¥è®°å½•key-TTLã€‚</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisDb</span> <span class="token punctuation">{</span>
    dict <span class="token operator">*</span>dict<span class="token punctuation">;</span>		<span class="token comment">//å­˜æ”¾æ‰€æœ‰keyåŠvalueçš„åœ°æ–¹</span>
    dict <span class="token operator">*</span>expires<span class="token punctuation">;</span>	<span class="token comment">//å­˜æ”¾æ¯ä¸€ä¸ªkeyåŠTTLï¼ŒåªåŒ…å«è®¾ç½®äº†TTLçš„key</span>
    dict <span class="token operator">*</span>blocking_keys<span class="token punctuation">;</span>
    dict <span class="token operator">*</span>read_keys<span class="token punctuation">;</span>
    dict <span class="token operator">*</span>watched_keys<span class="token punctuation">;</span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> avg_ttl<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> expires_cursor<span class="token punctuation">;</span>
<span class="token punctuation">}</span> redisDb<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://images.xyzzs.top/image/image-20230127150342143.png_char" alt="image-20230127150342143" tabindex="0" loading="lazy"><figcaption>image-20230127150342143</figcaption></figure><!---->ï¼šæ¯æ¬¡æŸ¥æ‰¾keyæ—¶åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤ <p>é¡¾åæ€ä¹‰å¹¶ä¸æ˜¯TTLåˆ°æœŸåé©¬ä¸Šåˆ é™¤ï¼Œè€Œæ˜¯åœ¨è®¿é—®ä¸€ä¸ªkeyæ—¶ï¼Œæ£€æŸ¥è¯¥keyçš„å­˜è´§æ—¶é—´ï¼Œå¦‚æœå·²ç»è¿‡æœŸæ‰æ‰§è¡Œåˆ é™¤ã€‚</p><p><mark>å‘¨æœŸåˆ é™¤</mark>ï¼šå®šæœŸæŠ½æ ·éƒ¨åˆ†keyï¼Œåˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤</p><p>å³é€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå‘¨æœŸæ€§çš„æŠ½æ ·éƒ¨åˆ†è¿‡æœŸçš„keyï¼Œç„¶åæ‰§è¡Œåˆ é™¤ã€‚æ‰§è¡Œå‘¨æœŸåˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>Redisä¼šè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡serverCorn()ï¼ŒæŒ‰ç…§server.hzé¢‘ç‡æ¥æ‰§è¡Œè¿‡æœŸkeyï¼Œæ¨¡å¼ä¸ºSLOW</li><li>Redisçš„æ¯ä¸ªäº‹ä»¶å¾ªç¯å‰ä¼šè°ƒç”¨beforeSleep()å‡½æ•°ï¼Œæ‰§è¡Œè¿‡æœŸkeyæ¸…ç†ï¼Œæ¨¡å¼ä¸ºFAST</li></ul><p><strong>SLOWæ¨¡å¼è§„åˆ™</strong>â€”â€”<!----></p><p>â‘  æ‰§è¡Œé¢‘ç‡å—server.hzå½±å“ï¼Œé»˜è®¤10ï¼Œå³æ¯ç§’æ‰§è¡Œ10æ¬¡ï¼Œæ¯ä¸ªæ‰§è¡Œå‘¨æœŸ<!---->ã€‚</p><p>â‘¡ æ‰§è¡Œæ¸…ç†è€—æ—¶ä¸è¶…è¿‡ä¸€æ¬¡æ‰§è¡Œå‘¨æœŸçš„25%</p><p>â‘¢ é€ä¸ªéå†dbï¼Œé€ä¸ªéå†dbä¸­çš„bucketï¼ŒæŠ½å–20ä¸ªkeyåˆ¤æ–­æ˜¯å¦è¿‡æœŸ</p><p>â‘£ å¦‚æœæ²¡æ‰“åˆ°æ—¶é—´ä¸Šé™ï¼ˆ25msï¼‰å¹¶ä¸”è¿‡æœŸkeyæ¯”ä¾‹ä¸å¤§äº10%ï¼Œå†è¿›è¡Œä¸€æ¬¡æŠ½æ ·ï¼Œå¦åˆ™ç»“æŸã€‚</p><p><strong>FASTæ¨¡å¼</strong>â€”â€”<!----></p><p>â‘  æ‰§è¡Œé¢‘ç‡å—beforeSleep()è°ƒç”¨é¢‘ç‡å½±å“ï¼Œä½†ä¸¤æ¬¡FASTæ¨¡å¼é—´éš”<!----></p><p>â‘¡ æ‰§è¡Œæ¸…ç†è€—æ—¶ä¸è¶…è¿‡1ms</p><p>â‘¢ é€ä¸ªéå†dbï¼Œé€ä¸ªéå†dbä¸­çš„bucketï¼ŒæŠ½å–20ä¸ªkeyåˆ¤æ–­æ˜¯å¦è¿‡æœŸ</p><p>â‘£ å¦‚æœæ²¡è¾¾åˆ°æ—¶é—´ä¸Šé™ï¼ˆ1msï¼‰ï¼Œå¹¶ä¸”è¿‡æœŸkeyæ¯”ä¾‹å¤§äº10%ï¼Œå†è¿›è¡Œä¸€æ¬¡æŠ½æ ·ï¼Œå¦åˆ™ç»“æŸã€‚</p><h3 id="æ·˜æ±°ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#æ·˜æ±°ç­–ç•¥"><span>æ·˜æ±°ç­–ç•¥</span></a></h3><p>å†…å­˜æ·˜æ±°ï¼šå°±æ˜¯å½“Rediså†…å­˜ä½¿ç”¨è¾¾åˆ°è®¾ç½®çš„é˜ˆå€¼æ—¶ï¼ŒRedisä¸»åŠ¨æŒ‘é€‰éƒ¨åˆ†keyåˆ é™¤ä»¥é‡Šæ”¾æ›´å¤šå†…å­˜ã€‚</p><p>Redisä¼šåœ¨å¤„ç†å®¢æˆ·ç«¯å‘½ä»¤çš„æ–¹æ³•processCommand()ä¸­å°è¯•åšå†…å­˜æ·˜æ±°ï¼ˆå³æ‰§è¡Œå¤„ç†å‘½ä»¤æ—¶ï¼‰</p><p><mark>8ç§æ·˜æ±°ç­–ç•¥</mark>ï¼Œé»˜è®¤çš„ç­–ç•¥ä¸ºnoeviction</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>noevictionï¼šä¸ä¼šæ·˜æ±°ä»»ä½•æ•°æ®ï¼Œå½“ä½¿ç”¨çš„å†…å­˜ç©ºé—´è¶…è¿‡ maxmemory å€¼æ—¶ï¼Œå†æœ‰å†™è¯·æ±‚æ¥æ—¶è¿”å›é”™è¯¯ã€‚
<span class="token keyword">volatile</span><span class="token operator">-</span>ttlï¼šé’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œæ¯”è¾ƒkeyçš„å‰©ä½™TTLå€¼ï¼Œè¶Šå°è¶Šå…ˆè¢«æ·˜æ±°
<span class="token keyword">volatile</span><span class="token operator">-</span>randomï¼šå¯¹è®¾ç½®äº†TTLçš„keyï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚ä¹Ÿå°±æ˜¯ä»db<span class="token operator">&gt;</span>expiresä¸­éšæœºæŒ‘é€‰
allkeys<span class="token operator">-</span>randomï¼šå¯¹å…¨ä½“keyï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚ä¹Ÿå°±æ˜¯ä»db<span class="token operator">&gt;</span>dictä¸­éšæœºæŒ‘é€‰
<span class="token keyword">volatile</span><span class="token operator">-</span>lruï¼Œå¯¹è®¾ç½®äº†TTLçš„keyï¼Œä½¿ç”¨lruç®—æ³•è¿›è¡Œæ·˜æ±°ã€‚
allkeys<span class="token operator">-</span>lruï¼Œå¯¹å…¨ä½“keyï¼Œä½¿ç”¨lruç®—æ³•è¿›è¡Œæ·˜æ±°ã€‚
<span class="token keyword">volatile</span><span class="token operator">-</span>lfuï¼Œå¯¹è®¾ç½®äº†TTLçš„keyï¼Œä½¿ç”¨lfuç®—æ³•è¿›è¡Œæ·˜æ±°ã€‚
allkeys<span class="token operator">-</span>lfuï¼Œå¯¹å…¨ä½“keyï¼Œä½¿ç”¨lfuç®—æ³•è¿›è¡Œæ·˜æ±°ã€‚

<span class="token comment">/* å‰ç¼€ä¸ºvolatile-å’Œallkeys-çš„åŒºåˆ«åœ¨äºäºŒè€…é€‰æ‹©è¦æ¸…é™¤çš„é”®æ—¶çš„å­—å…¸ä¸åŒ:
volatile - å‰ç¼€çš„ç­–ç•¥ä»£è¡¨ä»redisDbä¸­çš„ expire å­—å…¸ä¸­é€‰æ‹©é”®è¿›è¡Œæ¸…é™¤ï¼›
allkeys  - å‰ç¼€çš„ç­–ç•¥ä»£è¡¨ä»redisDbä¸­çš„ dict å­—å…¸ä¸­é€‰æ‹©é”®è¿›è¡Œæ¸…é™¤ã€‚ */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>LRU(Least Recently Used)ï¼šæœ€å°‘<!---->ä½¿ç”¨ã€‚ç”¨å½“å‰æ—¶é—´å‡å»æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œè¿™ä¸ªå€¼è¶Šå¤§ï¼Œä»£è¡¨ä¸Šæ¬¡è®¿é—®è¶Šä¹…ï¼Œåˆ™è¶Šä¼˜å…ˆæ·˜æ±°ã€‚</p><p>LFU(Least Frequently Used)ï¼šæœ€å°‘<!---->ä½¿ç”¨ã€‚ç»Ÿè®¡æ¯ä¸ªkeyçš„è®¿é—®é¢‘ç‡ï¼Œå€¼è¶Šå°ï¼Œä»£è¡¨è®¿é—®é¢‘ç‡è¶Šä½ï¼Œåˆ™è¶Šä¼˜å…ˆæ·˜æ±°ã€‚</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> type<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> encoding<span class="token punctuation">;</span>
    <span class="token comment">//LRU:ä»¥ç§’ä¸ºå•ä½è®°å½•æœ€è¿‘ä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œé•¿åº¦24bit</span>
    <span class="token comment">//LFU:é«˜16ä½ä»¥åˆ†é’Ÿä¸ºå•ä½è®°å½•æœ€è¿‘ä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œä½8ä½è®°å½•é€»è¾‘è®¿é—®æ¬¡æ•°</span>
    <span class="token keyword">unsigned</span> lru<span class="token punctuation">;</span>
    <span class="token keyword">int</span> refcount<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>LFUçš„è®¿é—®æ¬¡æ•°ä¹‹æ‰€ä»¥å«åš<strong>é€»è¾‘è®¿é—®æ¬¡æ•°</strong>ï¼Œæ˜¯å› ä¸ºå¹¶ä¸æ˜¯æ¯æ¬¡keyè¢«è®¿é—®éƒ½è®¡ç®—ï¼Œè€Œæ˜¯é€šè¿‡è¿ç®—ï¼š</p><ol><li>ç”Ÿæˆ 0 ~ 1 ä¹‹é—´çš„éšæœºæ•°R</li><li>è®¡ç®— <code>1/(æ—§æ¬¡æ•° + lfr_log_factor + 1)</code>ï¼Œè®°å½•ä¸ºPï¼Œlfr_log_factor é»˜è®¤ä¸º10</li><li>å¦‚æœ R &lt; Pï¼Œåˆ™è®¡æ•°å™¨ + 1ï¼Œä¸”æœ€å¤§ä¸è¶…è¿‡ 255</li><li>è®¿é—®æ¬¡æ•°ä¼šéšæ—¶é—´è¡°å‡ï¼Œè·ç¦»ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´é—´éš” lfr_decay_time åˆ†é’Ÿï¼ˆé»˜è®¤1ï¼‰ï¼Œ<!----></li></ol><p><mark>æ·˜æ±°æµç¨‹</mark></p><figure><img src="http://images.xyzzs.top/image/1665412912054-7642e6c0-e05a-4d59-bd17-647fddc2fe43.png_char" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©"><span>ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©</span></a></h2><h3 id="ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜ç©¿é€"><span>ç¼“å­˜ç©¿é€</span></a></h3><p>äº§ç”ŸåŸå› ï¼šæŒ‡å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨<!---->ï¼Œè¿™æ ·ç¼“å­˜æ°¸ä¸ä¼šç”Ÿæ•ˆï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ã€‚</p><p>è§£å†³æ–¹æ¡ˆ ï¼š</p><ol><li>ç¼“å­˜ç©ºå¯¹è±¡ï¼šå»ºè®®è®¾ç½®æœ‰æ•ˆæœŸ <ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼šé¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œå¯èƒ½ç¼“å­˜å¤§é‡ä¸å¿…è¦æ•°æ®</li></ul></li><li>å¸ƒéš†è¿‡æ»¤å™¨ï¼šåˆ¤æ–­ä¸å­˜åœ¨çš„ï¼Œåˆ™ä¸€å®šä¸å­˜åœ¨ï¼›åˆ¤æ–­å­˜åœ¨çš„ï¼Œå¤§æ¦‚ç‡å­˜åœ¨ï¼Œä½†ä¹Ÿæœ‰å°æ¦‚ç‡ä¸å­˜åœ¨ã€‚ <ul><li>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™key</li><li>ç¼ºç‚¹ï¼š1.å®ç°å¤æ‚ï¼›2.å­˜åœ¨è¯¯åˆ¤å¯èƒ½ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šå‘ç”Ÿç©¿é€</li></ul></li><li>åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ</li><li>åŠ å¼ºç”¨æˆ·æƒé™æ ¡éªŒ</li><li>åšå¥½çƒ­ç‚¹å‚æ•°çš„é™æµ</li></ol><h3 id="ç¼“å­˜å‡»ç©¿" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜å‡»ç©¿"><span>ç¼“å­˜å‡»ç©¿</span></a></h3><p>ä¹Ÿç§°çƒ­ç‚¹keyé—®é¢˜</p><p>äº§ç”ŸåŸå› ï¼šä¸€ä¸ªè¢«<strong>é«˜å¹¶å‘è®¿é—®</strong>å¹¶ä¸”<strong>ç¼“å­˜é‡å»ºä¸šåŠ¡å¤æ‚</strong>çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å†²å‡»ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>äº’æ–¥é”ï¼šä¿è¯æ¯ä¸ªkeyåªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æŸ¥è¯¢æ•°æ®åº“ï¼Œè€Œå…¶ä»–çº¿ç¨‹ä¸ºç­‰å¾…çŠ¶æ€ã€‚</p><img src="http://images.xyzzs.top/image/image-20230125133155500.png_char" alt="image-20230125133155500" style="zoom:50%;"></li><li><p>é€»è¾‘è¿‡æœŸï¼šè®¾ç½®ç¼“å­˜æ°¸è¿œä¸è¿‡æœŸï¼Œé€šè¿‡å­—æ®µåˆ¤æ–­ç¼“å­˜æ˜¯å¦æœ‰æ•ˆï¼Œè‹¥å¤±æ•ˆä¸”åœ¨é‡å»ºè¿‡ç¨‹ä¸­ï¼Œå¯æš‚æ—¶è¿”å›æ—§æ•°æ®ã€‚</p></li></ol><table><thead><tr><th></th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>äº’æ–¥é”</td><td>æ²¡æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—<br>ä¿è¯ä¸€è‡´æ€§<br>å®ç°ç®€ç­”</td><td>çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼Œæ€§èƒ½å—å½±å“<br>å¯èƒ½æœ‰æ­»é”é£é™©</td></tr><tr><td>é€»è¾‘è¿‡æœŸ</td><td>çº¿ç¨‹æ— éœ€ç­‰å¾…ï¼Œæ€§èƒ½è¾ƒå¥½</td><td>ä¸ä¿è¯ä¸€è‡´æ€§<br>æœ‰é¢å¤–å†…å­˜æ¶ˆè€—<br>å®ç°å¤æ‚</td></tr></tbody></table><h3 id="ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜é›ªå´©"><span>ç¼“å­˜é›ªå´©</span></a></h3><p>äº§ç”ŸåŸå› ï¼šåœ¨åŒä¸€æ—¶æ®µå†…<!---->ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ä¸åŒçš„keyçš„TTLè®¾ç½®éšæœºå€¼</li><li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§</li><li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥</li><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜</li></ol><h2 id="ç¼“å­˜-åˆ†å¸ƒå¼" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜-åˆ†å¸ƒå¼"><span>ç¼“å­˜-åˆ†å¸ƒå¼</span></a></h2><h3 id="ä¸»ä»" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»"><span>ä¸»ä»</span></a></h3><p><mark>æ­å»ºä¸»ä»æ¶æ„</mark>ï¼Œéå¸¸ç®€å•ï¼ˆæ”¹é…ç½®æ–‡ä»¶ &gt; å¯åŠ¨ &gt;&gt; å»ºç«‹è”ç³»ï¼‰</p><ol><li><p>å¤åˆ¶é…ç½®æ–‡ä»¶redis.confã€‚<code>cp redis.conf redis7001.conf</code></p></li><li><p>æ”¹ç«¯å£ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># æ”¹ä¸ºç©ºé—²ç«¯å£</span>
port <span class="token number">7001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹ä¿æŠ¤è¿›ç¨‹ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#è¿™é‡ŒåŸæ¥æ˜¯NOçš„ï¼ŒæŠŠå®ƒæ”¹ä¸ºYESï¼Œè¿™æ ·å®ƒå°±å¯ä»¥åœ¨åå°è¿›è¡Œè¿è¡Œäº†</span>
daemonize <span class="token function">yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹pidfile</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#è¿™é‡ŒåŸæ¥æ˜¯pidfile /var/run/redis_6379.pidï¼Œè¿™é‡Œåé¢çš„åå­—æ”¹ä¸ºä»€ä¹ˆæ— æ‰€è°“çš„ï¼Œåªè¦èƒ½åšåŒºåˆ†å³å¯ã€‚</span>
pidfile /var/run/redis_7001.pid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ·»åŠ æ—¥å¿—æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># è¿™é‡ŒåŸæ¥æ˜¯logfile &quot;&quot;ï¼Œå¯ä»¥åŠ ä¸Šæ—¥å¿—çš„æ–‡ä»¶åï¼Œåå­—å¯ä»¥éšä¾¿èµ·ï¼Œä¸ºäº†æ–¹ä¾¿ä»¥åæŸ¥çœ‹ï¼Œç›´æ¥ port.log</span>
logfile <span class="token number">7001</span>.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹dbfilename</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>dbfilename dump7001.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å»ºç«‹ä¸»ä»å…³ç³»</p><ol><li><p>æ°¸ä¹…å»ºç«‹ï¼Œredis.confé…ç½®é¡¹</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>replicaof <span class="token operator">&lt;</span>masterip<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>masterport<span class="token operator">&gt;</span>
replicaof localhost <span class="token number">7001</span>

<span class="token comment"># ä»æœºåªè¯»æ¨¡å¼é»˜è®¤æ˜¯å¼€å¯çš„ï¼š</span>
replica-read-only <span class="token function">yes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¸´æ—¶å»ºç«‹ï¼Œå‘½ä»¤è¡Œæ–¹å¼</p><p>âš ï¸æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•åªèƒ½æ˜¯æš‚æ—¶çš„ï¼Œå¦‚æœé‡å¯ä¹‹åï¼Œä»–ä»¬åˆä¸æ˜¯ä¸»ä»å…³ç³»äº†ï¼Œå¦‚æœæƒ³æ°¸ä¹…å˜ä¸ºä¸»ä»å…³ç³»ï¼Œé‚£å°±æ˜¯ç¬¬ä¸€ç§æ–¹æ³•ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># ä»¥7001ä¸»æœºï¼Œ7002ä»æœºä¸ºä¾‹</span>
--å¯åŠ¨7001ã€7002
--è¿æ¥7002
redis-cli <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-p</span> <span class="token number">7002</span>

-- æ‰§è¡Œslaveofå‘½ä»¤ï¼ˆslaveof IP portï¼‰
slaveof localhost <span class="token number">7001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>æŸ¥çœ‹ä¸»ä»ä¿¡æ¯</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># ä¸»æœºæŸ¥çœ‹ä¸»ä»ä¿¡æ¯ï¼ˆå…ˆè¿è¡Œredis-cliï¼‰,role:masterï¼Œè¡¨ç¤ºæ˜¯ä¸»æœº,role:slaveï¼Œè¡¨ç¤ºä»æœº</span>
info replication
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æµ‹è¯•</p><ol><li>ä¸»æœºæ‰§è¡Œsetï¼Œä»æœºæ‰§è¡Œget</li><li>ä»æœºæ‰§è¡Œsetï¼Œæ— æ³•æ‰§è¡Œ<code>(error) READONLY You can&#39;t write against a read only replica.</code></li></ol></li></ol><hr><p><mark>å…¨é‡åŒæ­¥</mark></p><p>ä¸»ä»ç¬¬ä¸€æ¬¡åŒæ­¥æ˜¯å…¨é‡åŒæ­¥</p><figure><img src="http://images.xyzzs.top/image/image-20230124140019432.png_char" alt="image-20230124140019432" tabindex="0" loading="lazy"><figcaption>image-20230124140019432</figcaption></figure><p>masterå¦‚ä½•åˆ¤æ–­slaveæ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡æ¥åŒæ­¥æ•°æ®ï¼Ÿéœ€è¦ä»¥ä¸‹å­—æ®µä¿è¯ï¼š</p><ul><li><!---->ï¼šç®€ç§°replidï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œidä¸€è‡´åˆ™è¯´æ˜æ˜¯åŒä¸€æ•°æ®é›†ã€‚æ¯ä¸€ä¸ªmasteréƒ½æœ‰å”¯ä¸€çš„replidï¼Œslaveåˆ™ä¼šç»§æ‰¿masterèŠ‚ç‚¹çš„replid</li><li><!---->ï¼šåç§»é‡ï¼Œéšç€è®°å½•åœ¨repl_baklogä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚slaveå®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„offsetã€‚å¦‚æœslaveçš„offsetå°äºmasterçš„offsetï¼Œè¯´æ˜slaveæ•°æ®è½åäºmasterï¼Œéœ€è¦æ›´æ–°ã€‚</li></ul><p>å› æ­¤slaveåšæ•°æ®åŒæ­¥æ—¶ï¼Œå¿…é¡»å‘masterå£°æ˜è‡ªå·±çš„replication idå’Œoffsetï¼Œmasteræ‰èƒ½åˆ¤æ–­åˆ°åº•éœ€è¦åŒæ­¥å“ªäº›æ•°æ®ã€‚</p><p><mark>å¢é‡åŒæ­¥</mark></p><figure><img src="http://images.xyzzs.top/image/image-20230124140112235.png_char" alt="image-20230124140112235" tabindex="0" loading="lazy"><figcaption>image-20230124140112235</figcaption></figure><img src="http://images.xyzzs.top/image/image-20230124135718216.png_char" alt="image-20230124135718216" style="zoom:50%;"><p>âš ï¸repl_baklogå¤§å°æœ‰ä¸Šé™ï¼Œå†™æ»¡åè¦†ç›–æœ€æ—©çš„æ•°æ®ã€‚å¦‚æœslaveæ–­å¼€æ—¶é—´è¿‡ä¹…ï¼Œå¯¼è‡´å°šæœªå¤‡ä»½çš„æ•°æ®è¢«è¦†ç›–ï¼Œåˆ™æ— æ³•åŸºäºlogåšå¢é‡åŒæ­¥ï¼Œåªèƒ½å†æ¬¡å…¨é‡åŒæ­¥ã€‚</p><p>å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä¼˜åŒ–Redisä¸»ä»é›†ç¾¤ï¼ˆæ€è·¯1ï¼šå‡å°‘å…¨é‡åŒæ­¥ã€æ€è·¯2ï¼šä¼˜åŒ–å…¨é‡åŒæ­¥æ€§èƒ½ï¼‰</p><ul><li><p>åœ¨masterä¸­é…ç½®repl-diskless-sync yeså¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼Œé¿å…å…¨é‡åŒæ­¥æ—¶çš„ç£ç›˜IOâ€”è¦æ±‚ç½‘ç»œå¸¦å®½é«˜</p></li><li><p>Rediså•èŠ‚ç‚¹ä¸Šçš„å†…å­˜å ç”¨ä¸è¦å¤ªå¤§ï¼Œå‡å°‘RDBå¯¼è‡´çš„è¿‡å¤šç£ç›˜IO</p></li><li><p>é€‚å½“æé«˜repl_baklogçš„å¤§å°ï¼Œå‘ç°slaveå®•æœºæ—¶å°½å¿«å®ç°æ•…éšœæ¢å¤ï¼Œå°½å¯èƒ½é¿å…å…¨é‡åŒæ­¥</p></li><li><p>é™åˆ¶ä¸€ä¸ªmasterä¸Šçš„slaveèŠ‚ç‚¹æ•°é‡ï¼Œå¦‚æœå®åœ¨æ˜¯å¤ªå¤šslaveï¼Œåˆ™å¯ä»¥é‡‡ç”¨ä¸»-ä»-ä»é“¾å¼ç»“æ„ï¼Œå‡å°‘materå‹åŠ›</p><figure><img src="http://images.xyzzs.top/image/image-20230124141221433.png_char" alt="image-20230124141221433" tabindex="0" loading="lazy"><figcaption>image-20230124141221433</figcaption></figure><p><mark>å…¨é‡/å¢é‡åŒæ­¥å°ç»“</mark></p><ol><li>ç®€è¿°å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥åŒºåˆ«ï¼Ÿ <ul><li>å…¨é‡åŒæ­¥ï¼šmasterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€åˆ°slaveã€‚åç»­å‘½ä»¤è®°å½•åœ¨repl_baklogï¼Œé€ä¸ªå‘é€ç»™slaveã€‚</li><li>å¢é‡åŒæ­¥ï¼šslaveæäº¤è‡ªå·±çš„offsetåˆ°masterï¼Œmasterè·å–repl_baklogä¸­ä»offsetä¹‹åçš„å‘½ä»¤ç»™slave</li></ul></li><li>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå…¨é‡åŒæ­¥? <ul><li>slaveèŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¿æ¥masterèŠ‚ç‚¹æ—¶</li><li>slaveèŠ‚ç‚¹æ–­å¼€æ—¶é—´å¤ªä¹…ï¼Œrepl_baklogä¸­çš„offsetå·²ç»è¢«è¦†ç›–æ—¶</li></ul></li><li>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå¢é‡åŒæ­¥? <ul><li>slaveèŠ‚ç‚¹æ–­å¼€åˆæ¢å¤ï¼Œå¹¶ä¸”repl_baklogä¸­èƒ½æ‰¾åˆ°offsetæ—¶</li></ul></li></ol></li></ul><h3 id="å“¨å…µ" tabindex="-1"><a class="header-anchor" href="#å“¨å…µ"><span>å“¨å…µ</span></a></h3><p>ğŸ¤”slaveèŠ‚ç‚¹å®•æœºæ¢å¤åå¯ä»¥æ‰¾masterèŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œé‚£masterèŠ‚ç‚¹å²©æœºæ€ä¹ˆåŠ?</p><p><mark>ä½œç”¨å’ŒåŸç†</mark></p><p>Redisæä¾›äº†å“¨å…µ(Sentinel)æœºåˆ¶æ¥å®ç°ä¸»ä»é›†ç¾¤çš„è‡ªåŠ¨æ•…éšœæ¢å¤ã€‚å“¨å…µçš„ç»“æ„å’Œä½œç”¨å¦‚ä¸‹:</p><img src="http://images.xyzzs.top/image/image-20230124144519132.png_char" alt="image-20230124144519132" style="zoom:50%;"><ul><li>ç›‘æ§ï¼šSentinelä¼šä¸æ–­æ£€æŸ¥masterå’Œslaveæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ</li><li>è‡ªåŠ¨æ•…éšœæ¢å¤ï¼šå¦‚æœmasteræ•…éšœï¼ŒSentinelä¼šå°†ä¸€ä¸ªslaveæå‡ä¸ºmasterã€‚å½“æ•…éšœå®ä¾‹æ¢å¤åä¹Ÿä»¥æ–°çš„masterä¸ºä¸»</li><li>é€šçŸ¥ï¼šSentinelå……å½“Rediså®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œä¼šå°†æœ€æ–°ä¿¡æ¯æ¨é€ç»™Redisçš„å®¢æˆ·ç«¯</li></ul><hr><p>ä¸»è¦æµç¨‹ï¼šçŠ¶æ€ç›‘æ§ &gt; é€‰ä¸¾æ–°master &gt; å®ç°æ•…éšœè‡ªåŠ¨è½¬ç§»</p><!----><p>SentinelåŸºäºå¿ƒè·³æœºåˆ¶ç›‘æµ‹æœåŠ¡çŠ¶æ€ï¼Œæ¯éš”1ç§’å‘é›†ç¾¤çš„æ¯ä¸ªå®ä¾‹å‘é€pingå‘½ä»¤:</p><ul><li>ä¸»è§‚ä¸‹çº¿: å¦‚æœæŸsentinelèŠ‚ç‚¹å‘ç°æŸå®ä¾‹æœªåœ¨è§„å®šæ—¶é—´å“åº”ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹ä¸»è§‚ä¸‹çº¿ã€‚</li><li>å®¢è§‚ä¸‹çº¿:è‹¥è¶…è¿‡æŒ‡å®šæ•°é‡(quorum)çš„sentineléƒ½è®¤ä¸ºè¯¥å®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™è¯¥å®ä¾‹å®¢è§‚ä¸‹çº¿ã€‚quorumå€¼æœ€å¥½è¶…è¿‡Sentinelå®ä¾‹æ•°é‡çš„ä¸€åŠã€‚</li></ul><!----><p>ä¸€æ—¦å‘ç°masteræ•…éšœï¼Œsentineléœ€è¦åœ¨salveä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°çš„masterï¼Œé€‰æ‹©ä¾æ®æ˜¯è¿™æ ·çš„:</p><ul><li>é¦–å…ˆä¼šåˆ¤æ–­slaveèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹æ–°å¼€æ—¶é—´é•¿çŸ­ï¼Œå¦‚æœè¶…è¿‡æŒ‡å®šå€¼ (down-after-miliseconds* 10) åˆ™ä¼šæ’é™¤è¯¥slaveèŠ‚ç‚¹</li><li>ç„¶ååˆ¤æ–­slaveèŠ‚ç‚¹çš„slave-priorityå€¼ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</li><li>å¦‚æœæ˜¯0åˆ™æ°¸ä¸å‚ä¸é€‰ä¸¾å¦‚æœslave-prorityä¸€æ ·ï¼Œåˆ™åˆ¤æ–­slaveèŠ‚ç‚¹çš„sffsetå€¼ï¼Œè¶Šå¤§è¯´æ˜æ•°æ®è¶Šæ–°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li><li>æœ€åæ˜¯åˆ¤æ–­slaveèŠ‚ç‚¹çš„è¿è¡Œidå¤§å°ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</li></ul><!----><p>å½“é€‰ä¸­äº†å…¶ä¸­ä¸€ä¸ªslaveä¸ºæ–°çš„masterå(ä¾‹å¦‚slave1)ï¼Œæ•…éšœçš„è½¬ç§»çš„æ­¥éª¤å¦‚ä¸‹</p><ul><li>sentinelç»™å¤‡é€‰çš„slave1èŠ‚ç‚¹å‘é€slaveof no oneå‘½ä»¤ï¼Œè®©è¯¥èŠ‚ç‚¹æˆä¸ºmaster</li><li>sentinelç»™æ‰€æœ‰å…¶å®ƒslaveå‘é€slaveof 192.168.150.1017002å‘½ä»¤ï¼Œè®©è¿™äº›slaveæˆä¸ºæ–°masterçš„ä»èŠ‚ç‚¹ï¼Œå¼€å§‹ä»æ–°çš„masterä¸ŠåŒæ­¥æ•°æ®ã€‚</li><li>æœ€åï¼Œsentinelå°†æ•…éšœèŠ‚ç‚¹æ ‡è®°ä¸ºslaveï¼Œå½“æ•…éšœèŠ‚ç‚¹æ¢å¤åä¼šè‡ªåŠ¨æˆä¸ºæ–°çš„masterçš„slaveèŠ‚ç‚¹</li></ul><!-- <mark>æ­å»ºå“¨å…µé›†ç¾¤</mark> --><!-- <mark>RedisTemplateçš„å“¨å…µæ¨¡å¼</mark> --><h3 id="åˆ†ç‰‡å¼é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#åˆ†ç‰‡å¼é›†ç¾¤"><span>åˆ†ç‰‡å¼é›†ç¾¤</span></a></h3><p>ä¸»ä»å’Œå“¨å…µå¯ä»¥è§£å†³é«˜å¯ç”¨ã€é«˜å¹¶å‘è¯»çš„é—®é¢˜ã€‚ä½†æ˜¯ä¾ç„¶æœ‰ä¸¤ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼ŒğŸ˜­ç»å…¸ç™½é›ªï¼ŸğŸ˜­</p><ul><li>æµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜</li><li>é«˜å¹¶å‘å†™çš„é—®é¢˜</li></ul><p>ä½¿ç”¨åˆ†ç‰‡é›†ç¾¤å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œåˆ†ç‰‡é›†ç¾¤ç‰¹å¾</p><ul><li>é›†ç¾¤ä¸­æœ‰å¤šä¸ªmasterï¼Œæ¯ä¸ªmasterä¿å­˜ä¸åŒæ•°æ®</li><li>æ¯ä¸ªmasteréƒ½å¯ä»¥æœ‰å¤šä¸ªslaveèŠ‚ç‚¹</li><li>masterä¹‹é—´é€šè¿‡pingç›‘æµ‹å½¼æ­¤å¥åº·çŠ¶æ€</li><li>å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥è®¿é—®é›†ç¾¤ä»»æ„èŠ‚ç‚¹ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°æ­£ç¡®èŠ‚ç‚¹</li></ul><p>åˆ†ç‰‡é›†ç¾¤ç»“æ„å¦‚ä¸‹</p><figure><img src="http://images.xyzzs.top/image/image-20230124162755259.png_char" alt="image-20230124162755259" tabindex="0" loading="lazy"><figcaption>image-20230124162755259</figcaption></figure><p><mark>æ•£åˆ—æ’æ§½</mark></p><p>Redisä¼šæŠŠæ¯ä¸€ä¸ªmasterèŠ‚ç‚¹æ˜ å°„åˆ°0~16384ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ä¸Šã€‚</p><p>æ•°æ®keyä¸æ˜¯ä¸èŠ‚ç‚¹ç»‘å®šï¼Œè€Œæ˜¯ä¸æ’æ§½ç»‘å®šã€‚redisä¼šæ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—æ’æ§½å€¼ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š</p><ul><li>keyä¸­åŒ…å«&quot;{}&quot;ï¼Œä¸”â€œ{}â€ä¸­è‡³å°‘åŒ…å«1ä¸ªå­—ç¬¦ï¼Œâ€œ{}â€ä¸­çš„éƒ¨åˆ†æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li><li>keyä¸­ä¸åŒ…å«â€œ{}â€ï¼Œæ•´ä¸ªkeyéƒ½æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li></ul><p>ä¾‹å¦‚: keyæ˜¯numï¼Œé‚£ä¹ˆå°±æ ¹æ®numè®¡ç®—ï¼Œå¦‚æœæ˜¯{itcast}numï¼Œåˆ™æ ¹æ®itcastè®¡ç®—ã€‚è®¡ç®—æ–¹å¼æ˜¯åˆ©ç”¨CRC16ç®—æ³•å¾—åˆ°ä¸€ä¸ªhashå€¼ï¼Œç„¶åå¯¹16384å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯slotå€¼ã€‚</p><p>â“å¦‚ä½•å°†åŒä¸€ç±»æ•°æ®å›ºå®šçš„ä¿å­˜åœ¨åŒä¸€ä¸ªRediså®ä¾‹ï¼Ÿ</p><ul><li>è¿™ä¸€ç±»æ•°æ®ä½¿ç”¨ç›¸åŒçš„æœ‰æ•ˆéƒ¨åˆ†ï¼Œä¾‹å¦‚keyéƒ½ä»¥{typeid}ä¸ºå‰ç¼€</li></ul><p><mark>é›†ç¾¤æ”¶ç¼©</mark></p><!---->ï¼ˆåŒ…å«ä¸»ä»èŠ‚ç‚¹æ·»åŠ æ–¹å¼ï¼‰<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># åŠ å…¥é›†ç¾¤</span>
redis-cli <span class="token parameter variable">--cluster</span> add-node <span class="token operator">&lt;</span>æ–°IP<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>æ–°ç«¯å£<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>é›†ç¾¤å…¶ä¸€IP<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>é›†ç¾¤å…¶ä¸€ç«¯å£<span class="token operator">&gt;</span>
		  --cluster-salve <span class="token comment">#é»˜è®¤æ˜¯ä¸»èŠ‚ç‚¹ï¼ŒåŠ ä¸Šæ­¤å‚æ•°åˆ™é»˜è®¤ä»èŠ‚ç‚¹</span>
		  --cluster-master-id <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span> <span class="token comment">#å¹¶æŒ‡å®šä¸»æœºid</span>

<span class="token comment"># æ–°å¢åï¼Œä»é›†ç¾¤èŠ‚ç‚¹åˆ†é…æ’æ§½ç»™å½“å‰å®ä¾‹</span>
redis-cli <span class="token parameter variable">--cluster</span> reshard <span class="token operator">&lt;</span>é›†ç¾¤å…¶ä¸€IP<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>é›†ç¾¤å…¶ä¸€ç«¯å£<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!----><ol><li><!----><p>âš ï¸åˆ é™¤ä¸»èŠ‚ç‚¹ä¹‹å‰ï¼Œä¸ºäº†<strong>é˜²æ­¢æ•°æ®çš„ä¸¢å¤±</strong>ä»¥åŠ<strong>é›†ç¾¤åŠŸèƒ½çš„æ­£å¸¸</strong>ï¼Œå…ˆåº”<strong>æŠŠä¸»èŠ‚ç‚¹æ‰€åˆ†é…çš„å“ˆå¸Œæ§½è½¬ç§»åˆ°å…¶ä»–ä¸»èŠ‚ç‚¹</strong>ä¸Šã€‚åœ¨ç§»åŠ¨å“ˆå¸Œæ§½æ—¶ï¼Œè¦æ³¨æ„å“ˆå¸Œæ§½ä»0å¼€å§‹è®¡æ•°ï¼Œæ‰€ä»¥<strong>ç§»åŠ¨æ—¶è¦è¾“å…¥çš„æ•°å­—æ¯”æ·»åŠ æ—¶å°‘1</strong>ã€‚</p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 1.è½¬ç§»ä¸»èŠ‚ç‚¹åˆ†é…çš„å“ˆå¸Œæ§½</span>
redis-cli <span class="token parameter variable">--cluster</span> reshard <span class="token operator">&lt;</span>é›†ç¾¤å…¶ä¸€IP<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>é›†ç¾¤å…¶ä¸€ç«¯å£<span class="token operator">&gt;</span>

<span class="token comment"># 2.åˆ é™¤æ²¡æœ‰å“ˆå¸Œæ§½çš„ä¸»èŠ‚ç‚¹</span>
redis-cli <span class="token parameter variable">--cluster</span> del-node <span class="token operator">&lt;</span>åˆ é™¤IP<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>åˆ é™¤ç«¯å£<span class="token operator">&gt;</span> åˆ é™¤çš„èŠ‚ç‚¹ID
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><!---->ï¼šè‹¥ä¸»èŠ‚ç‚¹æ²¡æœ‰åˆ†é…æ’æ§½ï¼Œä¹Ÿå¯ç›´æ¥åˆ é™¤è¯¥ä¸»èŠ‚ç‚¹</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">--cluster</span> del-node <span class="token operator">&lt;</span>åˆ é™¤IP<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>åˆ é™¤ç«¯å£<span class="token operator">&gt;</span> åˆ é™¤çš„èŠ‚ç‚¹ID
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><p><mark>æ•…éšœè½¬ç§»</mark></p><ul><li><!---->ï¼šå½“é›†ç¾¤ä¸­æœ‰ä¸€ä¸ªmasterå²©æœºï¼Œå°†ä¼šé€šè¿‡ä»¥ä¸‹æµç¨‹è‡ªåŠ¨è½¬ç§»<ol><li>é¦–å…ˆæ˜¯è¯¥å®ä¾‹ä¸å…¶å®ƒå®ä¾‹å¤±å»è¿æ¥</li><li>ç„¶åæ˜¯ç–‘ä¼¼å®•æœº</li><li>æœ€åæ˜¯ç¡®å®šä¸‹çº¿ï¼Œè‡ªåŠ¨æå‡ä¸€ä¸ªslaveä¸ºæ–°çš„master</li></ol></li><li><!---->ï¼šä¸€èˆ¬é€‚ç”¨äºæ–°æœºä¸»åŠ¨å»æ›¿æ¢æ—§ä¸»æœº<p>åˆ©ç”¨<!---->å‘½ä»¤å¯ä»¥æ‰‹åŠ¨è®©é›†ç¾¤ä¸­çš„æŸä¸ªmasterå®•æœºï¼Œåˆ‡æ¢åˆ°æ‰§è¡Œ<code>cluster failover</code>å‘½ä»¤çš„è¿™ä¸ªslaveèŠ‚ç‚¹ï¼Œå®ç°æ— æ„ŸçŸ¥çš„æ•°æ®è¿ç§»ã€‚å…¶æµç¨‹å¦‚ä¸‹:</p><img src="http://images.xyzzs.top/image/image-20230124195548323.png_char" alt="image-20230124195548323" style="zoom:50%;"><p>æ‰‹åŠ¨çš„Failoveræ”¯æŒä¸‰ç§ä¸åŒæ¨¡å¼ï¼š</p><ul><li>ç¼ºçœï¼šé»˜è®¤çš„æµç¨‹ï¼Œå¦‚å›¾1~6æ­¥</li><li>forceï¼šçœç•¥äº†å¯¹offsetçš„ä¸€è‡´æ€§æ ¡éªŒ</li><li>takeoverï¼šç›´æ¥æ‰§è¡Œç¬¬5æ­¥ï¼Œå¿½ç•¥æ•°æ®ä¸€è‡´æ€§ã€å¿½ç•¥masterçŠ¶æ€å’Œå…¶å®ƒmasterçš„æ„è§</li></ul></li></ul><!-- <mark>æ­å»ºåˆ†ç‰‡é›†ç¾¤</mark> --><!-- <mark>RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤</mark> --><hr><p><mark>é›†ç¾¤æ³¨æ„ç‚¹</mark></p><ul><li><!----><!---->ï¼š é»˜è®¤å€¼ yes , å³éœ€è¦é›†ç¾¤å®Œæ•´æ€§ï¼Œæ–¹å¯å¯¹å¤–æä¾›æœåŠ¡<p>å¦‚æœä½ çš„è¯‰æ±‚æ˜¯ï¼Œé›†ç¾¤ä¸å®Œæ•´çš„è¯ï¼Œä¹Ÿéœ€è¦å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ¯”å¦‚å¦‚ä¸‹å›¾ï¼Œä½ ä¹Ÿå¸Œæœ›å…¶å®ƒçš„å°é›†ç¾¤ä»èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œå°±éœ€è¦å°†è¯¥å‚æ•°è®¾ç½®ä¸ºno ï¼›è¿™æ ·çš„è¯ï¼ŒæŒ‚æ‰çš„é‚£ä¸ªå°é›†ç¾¤æ˜¯ä¸è¡Œäº†ï¼Œä½†æ˜¯å…¶ä»–çš„å°é›†ç¾¤ä»ç„¶å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡</p><img src="http://images.xyzzs.top/image/20200419224851565.png_char" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:75%;"><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># ä¸ºäº†ä¿è¯é«˜å¯ç”¨æ€§ï¼Œå»ºè®®å°†cluster-require-full-coverageè®¾ç½®no</span>
cluster-require-full-coverage no
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><!----><p>é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´ä¼šä¸æ–­çš„äº’ç›¸Pingæ¥ç¡®å®šé›†ç¾¤ä¸­å…¶å®ƒèŠ‚ç‚¹çš„çŠ¶æ€ã€‚æ¯æ¬¡Pingæºå¸¦çš„ä¿¡æ¯è‡³å°‘åŒ…æ‹¬:</p><ul><li>æ’æ§½ä¿¡æ¯</li><li>é›†ç¾¤çŠ¶æ€ä¿¡æ¯</li></ul><p>é›†ç¾¤ä¸­èŠ‚ç‚¹è¶Šå¤šï¼Œé›†ç¾¤çŠ¶æ€ä¿¡æ¯æ•°æ®é‡ä¹Ÿè¶Šå¤§ï¼Œ10ä¸ªèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯å¯èƒ½è¾¾åˆ°1kbï¼Œæ­¤æ—¶æ¯æ¬¡é›†ç¾¤äº’é€šéœ€è¦çš„å¸¦å®½ä¼šéå¸¸é«˜ã€‚è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li>é¿å…å¤§é›†ç¾¤ï¼Œé›†ç¾¤èŠ‚ç‚¹æ•°ä¸è¦å¤ªå¤šï¼Œæœ€å¥½å°‘äº1000ï¼Œå¦‚æœä¸šåŠ¡åºå¤§ï¼Œå¯æ‹†åˆ†ä¸šåŠ¡ï¼Œå»ºç«‹å¤šä¸ªé›†ç¾¤ã€‚</li><li>é¿å…åœ¨å•ä¸ªç‰©ç†æœºä¸­è¿è¡Œå¤ªå¤šRediså®ä¾‹</li><li>é…ç½®åˆé€‚çš„cluster-node-timeoutå€¼ï¼ŒèŠ‚ç‚¹å¤±æ•ˆæ£€æµ‹æ—¶é—´ï¼Œé»˜è®¤ 15000 ms</li></ol></li><li><!----><p>ä½¿ç”¨ç›¸åŒçš„æœ‰æ•ˆkeyï¼Œå¯¼è‡´éƒ¨åˆ†è´Ÿæ‹…è¿‡é‡</p></li><li><!----><p>è®¿é—®é›†ç¾¤ï¼Œéœ€è¦åšèŠ‚ç‚¹çš„é€‰æ‹©ã€æ’æ§½çš„åˆ¤æ–­ã€è¯»å†™çš„åˆ¤æ–­ç­‰ç­‰ï¼ŒåŠ¿å¿…ä¼šæµªè´¹ä¸€éƒ¨åˆ†æ€§èƒ½</p></li><li><!----><p>å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„</p></li><li><!----><p>å¤šé”®çš„Redisäº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚luaè„šæœ¬ä¸è¢«æ”¯æŒã€‚</p></li></ul><p>â—å¯ä»¥çœ‹åˆ°é›†ç¾¤å®ç°è¿˜æ˜¯ç›¸å¯¹å¤æ‚çš„ï¼Œè¦è€ƒè™‘çš„ç»†èŠ‚ä¹Ÿå¾ˆå¤šï¼›ä¸”å•ä½“Redisï¼ˆä¸»ä»Redisï¼‰å·²ç»èƒ½è¾¾åˆ°ä¸‡çº§åˆ«çš„QPSï¼ˆèƒ½æ»¡è¶³å¤§éƒ¨åˆ†ä¸­å°å‚éœ€æ±‚ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿå…·å¤‡å¾ˆå¼ºçš„é«˜å¯ç”¨æ€§ã€‚å¦‚æœä¸»ä»èƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œä¸å»ºè®®æ­å»ºRedisé›†ç¾¤ã€‚</p><h2 id="redisç½‘ç»œæ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#redisç½‘ç»œæ¨¡å‹"><span>redisç½‘ç»œæ¨¡å‹</span></a></h2><p>â“Redisåˆ°åº•æ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ</p><ul><li>å¦‚æœä»…ä»…è€ƒè™‘Redisæ ¸å¿ƒä¸šåŠ¡éƒ¨åˆ†ï¼ˆå‘½ä»¤å¤„ç†ï¼‰ï¼Œé‚£ä¹ˆæ˜¯å•çº¿ç¨‹</li><li>å¦‚æœæ˜¯æ•´ä¸ªRedisï¼Œé‚£ä¹ˆæ˜¯å¤šçº¿ç¨‹</li></ul><p>åœ¨Redisç‰ˆæœ¬è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œåœ¨ä¸¤ä¸ªé‡è¦çš„æ—¶é—´èŠ‚ç‚¹ä¸Šå¼•å…¥äº†å¤šçº¿ç¨‹æ”¯æŒï¼š</p><p>ğŸ”·Redis v4ï¼šå¼•å…¥å¤šçº¿ç¨‹å¼‚æ­¥å¤„ç†ä¸€äº›è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ï¼Œä¾‹å¦‚å¼‚æ­¥åˆ é™¤å‘½ä»¤ç­‰</p><p>ğŸ”·Redis v6ï¼šåœ¨æ ¸å¿ƒç½‘ç»œæ¨¡å‹ä¸­å¼•å…¥å¤šçº¿ï¼Œè¿›ä¸€æ­¥æé«˜å¯¹äºå¤šå–CPUçš„åˆ©ç”¨ç‡</p><p>â“é‚£ä¹ˆï¼ŒRedisä¸ºä»€ä¹ˆè¦åšæŒä½¿ç”¨å•çº¿ç¨‹å‘¢ï¼Ÿ</p><ol><li>Redisæ˜¯çº¯å†…å­˜æ“ä½œï¼ˆæš‚ä¸è€ƒè™‘æŒä¹…åŒ–ï¼‰ï¼Œæ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ï¼Œå®ƒçš„æ€§èƒ½ç“¶é¢ˆæ˜¯ç½‘ç»œå»¶è¿Ÿè€Œä¸æ˜¯æ‰§è¡Œé€Ÿåº¦ï¼Œå› æ­¤å¤šçº¿ç¨‹å¹¶ä¸ä¼šå¸¦æ¥æ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚</li><li>å¤šçº¿ç¨‹ä¼šå¯¼è‡´è¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¸¦æ¥ä¸å¿…è¦çš„å¼€é”€</li><li>å¼•å…¥å¤šçº¿ç¨‹ä¼šé¢ä¸´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¿…ç„¶é‡‡å–çº¿ç¨‹é”ç­‰å®‰å…¨æ‰‹æ®µï¼Œå®ç°å¤æ‚åº¦å¢é«˜ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿä¼šæœ‰æ‰€ä¸‹é™ã€‚</li></ol><p>Redis v6 ç‰ˆæœ¬ä¸­å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜IOè¯»å†™æ•ˆç‡ã€‚å› æ­¤åœ¨è§£æå®¢æˆ·ç«¯å‘½ä»¤ã€å†™å“åº”ç»“æœæ—¶é‡‡ç”¨äº†å¤šçº¿ç¨‹ã€‚æ ¸å¿ƒçš„å‘½ä»¤æ‰§è¡Œã€IOå¤šè·¯å¤ç”¨æ¨¡å—ä¾ç„¶æ˜¯ä¸»çº¿ç¨‹æ‰§è¡Œã€‚</p><figure><img src="http://images.xyzzs.top/image/image-20230127172621033.png_char" alt="image-20230127172621033" tabindex="0" loading="lazy"><figcaption>image-20230127172621033</figcaption></figure><ol><li>å¯åŠ¨server Socketï¼Œå°†server Socketçš„FDè¿›è¡Œæ³¨å†Œï¼Œç›‘å¬è¯¥FDï¼Œå¹¶å¯¹æ­¤FDç»‘å®šå¤„ç†å™¨â€”<code>è¿æ¥åº”ç­”å¤„ç†å™¨</code>ï¼Œè¯¥å¤„ç†å™¨ç”¨äºæ¥æ”¶å®¢æˆ·çš„è¯·æ±‚ï¼Œå¤„ç†server socketçš„readableäº‹ä»¶</li><li>Client Socketå‘service Socketå‘èµ·è¯·æ±‚ï¼Œè§¦å‘client Socketçš„readableäº‹ä»¶ï¼Œç»‘å®šå¤„ç†å™¨â€”<code>å‘½ä»¤è¯·æ±‚å¤„ç†å™¨</code><ol><li>é¦–å…ˆç»™æ¯ä¸€ä¸ªå®¢æˆ·ç«¯å°è£…ä¸€ä¸ªå¯¹åº”çš„çš„clientï¼›</li><li>ç„¶åå°†è¯·æ±‚æ•°æ®å†™å…¥client.queryBufï¼Œ</li><li>å†è°ƒç”¨client.queryBufä¸­çš„æ•°æ®ï¼Œé€šè¿‡è§£æï¼Œè½¬ä¸ºRediså‘½ä»¤ï¼Œæ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­</li><li>æŠŠæ‰§è¡Œç»“æœå†™å‡ºï¼Œå°è¯•æŠŠç»“æœå†™åˆ°client.bufç¼“å­˜åŒºï¼Œå¦‚æœå†™ä¸ä¸‹ï¼Œåˆ™å†™åˆ°client.replyï¼Œè¿™æ˜¯ä¸ªé“¾è¡¨ï¼Œæ— ä¸Šé™</li><li>å°†å¾…å†™å‡ºçš„å®¢æˆ·ç«¯æ·»åŠ åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç­‰å¾…è¢«å†™å‡º</li></ol></li><li>éå†é˜Ÿåˆ—ä¸­çš„clientï¼Œç›‘å¬FDå†™äº‹ä»¶ï¼Œç»‘å®šå†™å¤„ç†å™¨â€”<code>å‘½ä»¤å›å¤å¤„ç†å™¨</code>ï¼Œå°†å‘½ä»¤ç»“æœè¿”å›å®¢æˆ·ç«¯ã€‚</li></ol><h2 id="æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#æœ€ä½³å®è·µ"><span>æœ€ä½³å®è·µ</span></a></h2><h3 id="redisé”®å€¼è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#redisé”®å€¼è®¾è®¡"><span>Redisé”®å€¼è®¾è®¡</span></a></h3><h4 id="ä¼˜é›…çš„keyç»“æ„" tabindex="-1"><a class="header-anchor" href="#ä¼˜é›…çš„keyç»“æ„"><span>ä¼˜é›…çš„keyç»“æ„</span></a></h4><p>Redisçš„keyè™½ç„¶å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æœ€å¥½éµå¾ªä»¥ä¸‹è§„åˆ™çº¦å®šï¼š</p><ul><li>éµå¾ªåŸºæœ¬è§„åˆ™ï¼š[ä¸šåŠ¡åç§°]:[æ•°æ®å]:[id]ï¼Œä¾‹ï¼šç™»é™†ä¸šåŠ¡ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼š<code>login:user:1024</code></li><li>é•¿åº¦ä¸è¶…è¿‡44å­—èŠ‚ï¼Œembstråœ¨å°äº44å­—èŠ‚ä½¿ç”¨ï¼Œé‡‡ç”¨è¿ç»­ç©ºé—´ï¼Œå†…å­˜å ç”¨æ›´æ™“</li><li>ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦</li></ul><p>ä¼˜ç‚¹ï¼šâ‘ å¯è¯»æ€§å¼ºï¼›â‘¡é¿å…keyå†²çªï¼›â‘¢æ–¹ä¾¿ç®¡ç†ï¼›</p><h4 id="æ‹’ç»bigkey" tabindex="-1"><a class="header-anchor" href="#æ‹’ç»bigkey"><span>æ‹’ç»bigkey</span></a></h4><p>bigkeyé€šå¸¸ä»¥keyçš„å¤§å°å’Œkeyä¸­æˆå‘˜çš„æ•°é‡æ¥ç»¼åˆåˆ¤å®šï¼Œ</p><ul><li><p>keyæœ¬èº«çš„æ•°æ®é‡è¿‡å¤§ï¼šä¸€ä¸ªStringç±»å‹çš„keyï¼Œå®ƒçš„å€¼ä¸º5MBã€‚</p></li><li><p>keyä¸­æˆå‘˜æ•°è¿‡å¤šï¼šå›¾ä¸ªäººZSetç±»å‹çš„keyï¼Œå®ƒçš„æˆå‘˜æ•°é‡ä¸º10000 ä¸ªã€‚</p></li><li><p>keyä¸­æˆå‘˜çš„æ•°æ®é‡è¿‡å¤§ï¼šä¸€ä¸ªHashç±»å‹çš„keyï¼Œå®ƒçš„æˆå‘˜æ•°é‡è™½ç„¶åªæœ‰1000ä¸ªï¼Œä½†è¿™äº›æˆå‘˜çš„valueæ€»å¤§å°100MB</p><p>æ¨èå€¼ï¼šâ‘ å•ä¸ªkeyçš„valueå°äº10kbï¼›â‘¡å¯¹äºé›†åˆç±»å‹çš„keyï¼Œå»ºè®®å…ƒç´ æ•°é‡å°äº1000</p></li></ul><p><mark>Bigkeyçš„å±å®³</mark></p><ul><li><p>ç½‘ç»œé˜»å¡</p><p>å¯¹bigkeyæ‰§è¡Œè¯»è¯·æ±‚æ—¶ï¼Œå°‘é‡çš„QPSå°±å¯èƒ½å¯¼è‡´å¸¦å®½ä½¿ç”¨ç‡è¢«å æ»¡ï¼Œå¯¼è‡´Rediså®ä¾‹ï¼Œä¹ƒè‡³æ‰€åœ¨ç‰©ç†æœºå˜æ…¢</p></li><li><p>æ•°æ®å€¾æ–œ</p><p>bigkeyæ‰€åœ¨çš„Rediså®ä¾‹å†…å­˜ä½¿ç”¨ç‡è¿œè¶…å…¶ä»–å®ä¾‹ï¼Œæ— æ³•è¾¾åˆ°å‡è¡¡</p></li><li><p>Redisé˜»å¡</p><p>å¯¹å…ƒç´ è¾ƒå¤šçš„hashã€listã€zsetç­‰åšè¿ç®—ä¼šè€—æ—¶è¾ƒä¹…ï¼Œä½¿ä¸»çº¿ç¨‹è¢«é˜»å¡</p></li><li><p>CPIå‹åŠ›</p><p>å¯¹bigkeyçš„æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¼šå¯¼è‡´CPUä½¿ç”¨ç‡é£™å‡ï¼Œå°è±¡Rediså®ä¾‹å’Œæœ¬æœºå…¶ä»–åº”ç”¨</p></li></ul><p><mark>å¦‚ä½•å‘ç°Bigkey</mark></p><ul><li><p>redis-cli-bigkeys</p><p>åˆ©ç”¨redis-cliæä¾›çš„ --bigkeyå‚æ•°ï¼Œéå†åˆ†ææ‰€æœ‰keyï¼Œå¹¶è¿”å›keyçš„æ•´ä½“ç»Ÿè®¡ä¿¡æ¯ä¸æ¯ä¸ªæ•°æ®çš„top1çš„bigkey</p></li><li><p>scanæ‰«æ</p><p>è‡ªå·±ç¼–ç¨‹ï¼Œåˆ©ç”¨scanæ‰«æRedisä¸­çš„æ‰€æœ‰keyï¼Œåˆ©ç”¨strlenï¼Œhlenç­‰å‘½ä»¤åˆ¤æ–­keyçš„é•¿åº¦</p></li><li><p>ç¬¬ä¸‰æ–¹å·¥å…·</p><p>åˆ©ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¦‚<code>Redis-Rdb-Tools</code>åˆ†æRDBå¿«ç…§æ–‡ä»¶ï¼Œå…¨é¢åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ</p></li><li><p>ç½‘ç»œç›‘æ§</p><p>è‡ªå®šä¹‰å·¥å…·ï¼Œç›‘æ§è¿›å‡ºRedisçš„ç½‘ç»œæ•°æ®ï¼Œè¶…å‡ºé¢„è­¦å€¼æ—¶ä¸»åŠ¨å‘Šè­¦</p></li></ul><p><mark>å¦‚ä½•åˆ é™¤Bigkey</mark></p><p>Bigkeyå†…å­˜å ç”¨è¾ƒå¤šï¼Œåˆ é™¤è¿™æ ·çš„keyä¹Ÿéœ€è¦è€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œå¯¼è‡´Redisä¸»çº¿ç¨‹é˜»å¡ï¼Œå¼•å‘ä¸€äº›åˆ—é—®é¢˜ã€‚</p><ul><li><p>Redis V3 åŠä»¥å‰ç‰ˆæœ¬</p><p>å¦‚ä½•æ˜¯é›†åˆç±»å‹ï¼Œåˆ™éå†Bigkeyçš„å…ƒç´ ï¼Œå…ˆé€ä¸ªåˆ é™¤å­å…ƒç´ ï¼Œæœ€ååˆ é™¤Bigkey</p></li><li><p>Redis V4ä»¥å</p><p>4.0åæä¾›å¼‚æ­¥åˆ é™¤å‘½ä»¤ï¼šunlink</p></li></ul><h3 id="æ‰¹å¤„ç†" tabindex="-1"><a class="header-anchor" href="#æ‰¹å¤„ç†"><span>æ‰¹å¤„ç†</span></a></h3><h4 id="pipline" tabindex="-1"><a class="header-anchor" href="#pipline"><span>pipline</span></a></h4><p>æ‰¹å¤„ç†æ–¹æ¡ˆï¼š</p><ol><li>åŸç”Ÿçš„Mæ“ä½œ</li><li>piplineæ‰¹å¤„ç†</li></ol><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>æ‰¹å¤„ç†æ—¶ä¸å»ºè®®ä¸€æ¬¡æºå¸¦å¤ªå¤šå‘½ä»¤</li><li>piplineçš„å¤šä¸ªå‘½ä»¤ä¹‹é—´ä¸å…·å¤‡åŸå­æ€§</li></ul><h4 id="é›†ç¾¤æ¨¡å¼ä¸‹çš„æ‰¹å¤„ç†" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤æ¨¡å¼ä¸‹çš„æ‰¹å¤„ç†"><span>é›†ç¾¤æ¨¡å¼ä¸‹çš„æ‰¹å¤„ç†</span></a></h4><p>å¦‚msetæˆ–piplineè¿™æ ·çš„æ‰¹å¤„ç†éœ€è¦åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æºå¸¦å¤šæ¡å‘½ä»¤ï¼Œè€Œæ­¤æ—¶å¦‚æœRedisæ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œé‚£æ‰¹å¤„ç†å‘½ä»¤çš„å¤šä¸ªkeyå¿…é¡»è½åœ¨ä¸€ä¸ªæ’æ§½ä¸­ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´æ‰§è¡Œå¤±è´¥ã€‚</p><table><thead><tr><th></th><th>ä¸²è¡Œå‘½ä»¤</th><th>ä¸²è¡Œslot</th><th>å¹¶è¡Œslot</th><th>hash_tag</th></tr></thead><tbody><tr><td>å®ç°æ€è·¯</td><td></td><td></td><td></td><td></td></tr><tr><td>è€—æ—¶</td><td></td><td></td><td></td><td></td></tr><tr><td>ä¼˜ç‚¹</td><td></td><td></td><td></td><td></td></tr><tr><td>ç¼ºç‚¹</td><td></td><td></td><td></td><td></td></tr></tbody></table><!--  

### æœåŠ¡ç«¯é…ç½®ä¼˜åŒ–

#### å†…å­˜é…ç½®

info memory

memory state

#### å‘½ä»¤åŠå®‰å…¨é…ç½®

ç§˜é’¥ç™»é™†bug 

#### æ…¢æŸ¥è¯¢é…ç½®

#### æŒä¹…åŒ–é…ç½®

--></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/redis/README.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: zzss5224@163.com">jossezs</span><!--]--><!--]--></div></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">é»˜è®¤é¡µè„š</div><div class="vp-copyright">Copyright Â© 2024 Mr.Hope </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DmhNJ90i.js" defer></script>
  </body>
</html>
