<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.37" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/message-queue/kafka.html"><meta property="og:site_name" content="文档演示"><meta property="og:title" content="Kafka导航栏"><meta property="og:description" content="Kafka导航栏 Topic 是一个消息的分类，只是一个逻辑概念，代表了一类消息。通常我们可以使用 topic 来区分实际业务，比如业务 A 使用一个 topic，业务 B 使用另外一个 topic 。 Partition 是的概念，就是物理上进行分离，分布在不同的实体机器（broke）上。 Replication ： 副本，是 Kafka ，Kafk..."><meta property="og:type" content="article"><meta property="og:image" content="http://images.xyzzs.top/image/image-20230221131242940.png_char_char"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-24T15:46:57.000Z"><meta property="article:author" content="Mr.Hope"><meta property="article:modified_time" content="2024-04-24T15:46:57.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Kafka导航栏","image":["http://images.xyzzs.top/image/image-20230221131242940.png_char_char","http://images.xyzzs.top/image/1677028966704-9b5a4f2e-abfe-45b5-9dca-575157a6c096.png_char","http://images.xyzzs.top/image/1677032584417-2a5caeeb-d674-4f31-9760-2d728390a041.png_char","http://images.xyzzs.top/image/1677033107884-909b1a15-04d7-4fff-9740-517fec12bd8c.png_char"],"dateModified":"2024-04-24T15:46:57.000Z","author":[{"@type":"Person","name":"Mr.Hope","url":"https://mister-hope.com"}]}</script><title>Kafka导航栏 | 文档演示</title><meta name="description" content="Kafka导航栏 Topic 是一个消息的分类，只是一个逻辑概念，代表了一类消息。通常我们可以使用 topic 来区分实际业务，比如业务 A 使用一个 topic，业务 B 使用另外一个 topic 。 Partition 是的概念，就是物理上进行分离，分布在不同的实体机器（broke）上。 Replication ： 副本，是 Kafka ，Kafk...">
    <link rel="preload" href="/assets/style-DPrIjLWf.css" as="style"><link rel="stylesheet" href="/assets/style-DPrIjLWf.css">
    <link rel="modulepreload" href="/assets/app-CoZ3ixxr.js"><link rel="modulepreload" href="/assets/kafka.html-CC--xfht.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-eTOjNCEg.js" as="script"><link rel="prefetch" href="/assets/computer-networks.html-C4se08vS.js" as="script"><link rel="prefetch" href="/assets/computer-organization.html-QLR24_hL.js" as="script"><link rel="prefetch" href="/assets/data-strurture-and-arithmetic.html-VpKpqQeB.js" as="script"><link rel="prefetch" href="/assets/os.html-CEziHuVS.js" as="script"><link rel="prefetch" href="/assets/index.html-kix8gDBs.js" as="script"><link rel="prefetch" href="/assets/index.html-B2J13XFp.js" as="script"><link rel="prefetch" href="/assets/disable.html-DpyT_vpZ.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-DnAdVGiO.js" as="script"><link rel="prefetch" href="/assets/layout.html-iMLNR8XH.js" as="script"><link rel="prefetch" href="/assets/markdown.html-Br8_t30w.js" as="script"><link rel="prefetch" href="/assets/page.html-MELpnpVg.js" as="script"><link rel="prefetch" href="/assets/id.html-c9F6kztX.js" as="script"><link rel="prefetch" href="/assets/lock.html-PBUJTo3c.js" as="script"><link rel="prefetch" href="/assets/index.html-pv-xsK1E.js" as="script"><link rel="prefetch" href="/assets/index.html-BPPKywQe.js" as="script"><link rel="prefetch" href="/assets/base.html-BSUAQZ5Y.js" as="script"><link rel="prefetch" href="/assets/collection.html-DCa-9T6J.js" as="script"><link rel="prefetch" href="/assets/io.html-C5JYfuV_.js" as="script"><link rel="prefetch" href="/assets/reflect.html-BWFtJUsN.js" as="script"><link rel="prefetch" href="/assets/unsafe.html-CLIggjiK.js" as="script"><link rel="prefetch" href="/assets/class-file-structure.html-DcRt2mAh.js" as="script"><link rel="prefetch" href="/assets/memory-garbage-recycle.html-Cfayyq2O.js" as="script"><link rel="prefetch" href="/assets/monitoring-and-troubleshooting-tools.html-hQ-l85Fw.js" as="script"><link rel="prefetch" href="/assets/index.html-K_yhP2c8.js" as="script"><link rel="prefetch" href="/assets/index.html-Df5xYy_N.js" as="script"><link rel="prefetch" href="/assets/index.html-M8pQ-Xee.js" as="script"><link rel="prefetch" href="/assets/Redis_bak.html-Ck0OEFTd.js" as="script"><link rel="prefetch" href="/assets/spring-boot.html-BXNMR7Q7.js" as="script"><link rel="prefetch" href="/assets/spring-cloud.html-DTFrUJ0T.js" as="script"><link rel="prefetch" href="/assets/spring-framework.html-BvAvG73D.js" as="script"><link rel="prefetch" href="/assets/spring-mvc.html-5IZdRvcP.js" as="script"><link rel="prefetch" href="/assets/design-mode.html-NqahTynh.js" as="script"><link rel="prefetch" href="/assets/distributed.html-CPRZE8KK.js" as="script"><link rel="prefetch" href="/assets/dubbo.html-BSSEgten.js" as="script"><link rel="prefetch" href="/assets/netty.html-BW_9gnio.js" as="script"><link rel="prefetch" href="/assets/performance.html-IxqMjW7D.js" as="script"><link rel="prefetch" href="/assets/standard.html-DkvKYGTd.js" as="script"><link rel="prefetch" href="/assets/index.html-Cws1DB78.js" as="script"><link rel="prefetch" href="/assets/index.html-DQp9Q0Er.js" as="script"><link rel="prefetch" href="/assets/disable.html-x2XEvYyV.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-C9TgSXRO.js" as="script"><link rel="prefetch" href="/assets/layout.html-BeVJduAi.js" as="script"><link rel="prefetch" href="/assets/markdown.html-BfVRa2K6.js" as="script"><link rel="prefetch" href="/assets/page.html-BBDUb2sp.js" as="script"><link rel="prefetch" href="/assets/index.html-BGF-1dlt.js" as="script"><link rel="prefetch" href="/assets/index.html-DWyJCAi9.js" as="script"><link rel="prefetch" href="/assets/baz.html-JvtdJ1K0.js" as="script"><link rel="prefetch" href="/assets/index.html-DG4OgupB.js" as="script"><link rel="prefetch" href="/assets/ray.html-DGQq6_du.js" as="script"><link rel="prefetch" href="/assets/docker.html-qF8Kpmse.js" as="script"><link rel="prefetch" href="/assets/kubernetes.html-9K3IpMKA.js" as="script"><link rel="prefetch" href="/assets/linux.html-CWdVN4rG.js" as="script"><link rel="prefetch" href="/assets/shell.html-ar_iNWVw.js" as="script"><link rel="prefetch" href="/assets/index.html-BPVyPWjw.js" as="script"><link rel="prefetch" href="/assets/disable.html-DCOsJ8uC.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-CX03DRHv.js" as="script"><link rel="prefetch" href="/assets/layout.html-C0KWvLci.js" as="script"><link rel="prefetch" href="/assets/markdown.html-Bobfmpfr.js" as="script"><link rel="prefetch" href="/assets/page.html-I8bvqe9c.js" as="script"><link rel="prefetch" href="/assets/index.html-sU_XfhKk.js" as="script"><link rel="prefetch" href="/assets/index.html-DPRIG3Wh.js" as="script"><link rel="prefetch" href="/assets/baz.html-DulD6M0K.js" as="script"><link rel="prefetch" href="/assets/index.html-Caa6C4lc.js" as="script"><link rel="prefetch" href="/assets/ray.html-nS-s7Ts2.js" as="script"><link rel="prefetch" href="/assets/index.html-Bc4Mf5Ff.js" as="script"><link rel="prefetch" href="/assets/ray.html-CFzataVS.js" as="script"><link rel="prefetch" href="/assets/index.html-CD0zwYpO.js" as="script"><link rel="prefetch" href="/assets/baz.html-mzbz4Lys.js" as="script"><link rel="prefetch" href="/assets/404.html-BAZm0Zx9.js" as="script"><link rel="prefetch" href="/assets/index.html-D85wrhZI.js" as="script"><link rel="prefetch" href="/assets/index.html-BTTXuBME.js" as="script"><link rel="prefetch" href="/assets/index.html-DY01kIg5.js" as="script"><link rel="prefetch" href="/assets/index.html-D0bKTadQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CbWPxgX2.js" as="script"><link rel="prefetch" href="/assets/index.html-C2TDySu8.js" as="script"><link rel="prefetch" href="/assets/index.html-b_gITyJ_.js" as="script"><link rel="prefetch" href="/assets/giscus--_FS5kYt.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">文档演示</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="项目主页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>项目主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/zh/demo/" aria-label="主要功能与配置演示"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>主要功能与配置演示<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="指南"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>指南</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Bar</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/zh/guide/bar/baz.html" aria-label="Baz"><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>Baz<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/zh/guide/bar/" aria-label="..."><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span>...<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Foo</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/zh/guide/foo/ray.html" aria-label="Ray"><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>Ray<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/zh/guide/foo/" aria-label="..."><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span>...<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a href="https://theme-hope.vuejs.press/zh/" rel="noopener noreferrer" target="_blank" aria-label="V2 文档" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>V2 文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><div class="vp-nav-item"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="选择语言"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link active" href="/message-queue/kafka.html" aria-label="简体中文"><!---->简体中文<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/en/" aria-label="English"><!---->English<!----></a></li></ul></button></div></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/" aria-label="项目主页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>项目主页<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="route-link nav-link vp-sidebar-title" href="/demo/" aria-label="案例"><!---->案例<!----></a><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/markdown.html" aria-label="Markdown 展示"><span class="font-icon icon fa-fw fa-sm fab fa-markdown" style=""></span>Markdown 展示<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/layout.html" aria-label="布局"><span class="font-icon icon fa-fw fa-sm fas fa-object-group" style=""></span>布局<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/page.html" aria-label="页面配置"><span class="font-icon icon fa-fw fa-sm fas fa-file" style=""></span>页面配置<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/disable.html" aria-label="布局与功能禁用"><span class="font-icon icon fa-fw fa-sm fas fa-gears" style=""></span>布局与功能禁用<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/demo/encrypt.html" aria-label="密码加密的文章"><span class="font-icon icon fa-fw fa-sm fas fa-lock" style=""></span>密码加密的文章<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">文档</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/guide/" aria-label="指南"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>指南<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">Bar 功能</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">Foo 功能</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><a href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" rel="noopener noreferrer" target="_blank" aria-label="幻灯片" class="nav-link vp-sidebar-link vp-sidebar-page"><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span>幻灯片<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><span class="vp-sidebar-title">计算机基础2</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Java 基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">并发</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">JVM</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Message Queue</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">MQ通用</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Kafka</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/message-queue/kafka.html" aria-label="Kafka导航栏"><!---->Kafka导航栏<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">系统设计</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Kafka导航栏</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">Mr.Hope</a></span><span property="author" content="Mr.Hope"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-04-24T15:46:57.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 18 分钟</span><meta property="timeRequired" content="PT18M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#kafka文件的存储形式">kafka文件的存储形式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#文件清除策略">文件清除策略</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#kafka为什么快">kafka为什么快？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#如何保证kafka不丢失消息">⭐如何保证Kafka不丢失消息?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#kafka-如何保证消息的消费顺序">Kafka 如何保证消息的消费顺序？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#分区策略">分区策略</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#kafka消费组-分区分配策略及重平衡机制">Kafka消费组 分区分配策略及重平衡机制</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#zookeeper-存储">zookeeper 存储</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#高可用">高可用</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#备份机制">备份机制</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#isr-机制">ISR 机制</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ack-机制">ACK 机制</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#故障恢复机制">故障恢复机制</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#选举">选举</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="kafka导航栏" tabindex="-1"><a class="header-anchor" href="#kafka导航栏"><span>Kafka导航栏</span></a></h1><ul><li><p><strong>Topic</strong> 是一个消息的<!---->分类，只是一个逻辑概念，代表了一类消息。通常我们可以使用 topic 来区分实际业务，比如业务 A 使用一个 topic，业务 B 使用另外一个 topic 。</p></li><li><p><strong>Partition</strong> 是<!---->的概念，就是物理上进行分离，分布在不同的实体机器（broke）上。</p></li><li><p><strong>Replication</strong> ： 副本，是 Kafka <!---->，Kafka 同一 Partition 的数据可以在多 Broker 上存在多个副本，通常<!---->，当主副本所在 broker 崩溃或发生网络异常，Kafka 会在 Controller 的管理下会重新选择新的 Leader 副本对外提供读写服务。</p></li><li><p><strong>Record</strong> ： 实际写入 Kafka 中并可以被读取的消息记录。每个 record 包含了 key、value 和 timestamp。</p></li><li><p><strong>Offset</strong> ： offset 是消息在分区中的唯一标识，Kafka 通过它来<!---->，不过 offset 并不跨越分区，也就是说，Kafka 保证的是分区有序性而不是主题有序性。通俗的理解：<!---->。新版本保存在 Broker，老版本在zk中。</p></li><li><p><strong>广播消息</strong>：Kafka 通过 Consumer Group 来实现广播模式消息订阅，即不同 group 下的 consumer 可以重复消费消息，相互不影响，同一个 group 下的 consumer 构成一个整体。</p></li><li><p>消费者组</p></li></ul><p>❓kafka的 副本的作用 是什么</p><p>在kafka中，实现副本的目的就是冗余备份，<!---->，所有的读写请求都是由leader副本进行处理的。follower副本仅有一个功能，那就是从leader副本拉取消息，尽量让自己跟leader副本的内容一致。</p><p>生产者和消费者只与 leader 副本交互。可以理解为其他副本只是 leader 副本的拷贝，它们的存在只是为了<!---->。</p><p>那么为什么follower副本不对外提供服务？——这个问题本质上是优先保证数据的一致性。</p><p>❓Kafka 的多分区机制有什么好处</p><p>给特定 Topic 指定多个 Partition, 而各个 Partition 可以分布在不同的 Broker 上，<!---->。</p><h2 id="kafka文件的存储形式" tabindex="-1"><a class="header-anchor" href="#kafka文件的存储形式"><span>kafka文件的存储形式</span></a></h2><p>Kafka 消息是以 Topic 为单位进行归类，各个 Topic 之间是彼此独立的，互不影响。</p><p>每个 Topic 又可以分为一个或多个分区。每个分区各自存在一个记录消息数据的日志文件。</p><p>Kafka 每个分区日志在物理上实际按大小被分成多个 Segment；目的是为了防止log文件过大导致数据<strong>定位效率低下</strong>，采取<strong>分片</strong>和<strong>索引</strong>的机制。</p><figure><img src="http://images.xyzzs.top/image/image-20230221131242940.png_char_char" alt="image-20230221131242940" tabindex="0" loading="lazy"><figcaption>image-20230221131242940</figcaption></figure><p>一个 Segment 默认大小为 <code>1G</code>， 主要包含以下文件：</p><ul><li><code>.log</code>文件：实实在在存储数据的文件</li><li><code>.index</code>偏移量索引文件：快速定位； <ul><li><!---->。<code>log.index.interval.bytes</code>默认4KB。</li><li>保存的<code>offset</code>为相对的<code>offset</code>，确保<code>offset</code>值所占空间不会过大；绝对<code>offse</code>会越来越大。</li></ul></li><li><code>.timeindex</code>时间戳索引文件：用于<code>删除机制</code>。</li><li>其他文件</li></ul><blockquote><p>以当前segment的第一条消息的offset命名。</p></blockquote><blockquote><p><strong>稠密索引</strong>： 在密集索引中，数据库中的<strong>每个搜索键值都有一个索引记录</strong>。这样可以加快搜索速度，但需要更多空间来存储索引记录本身。索引记录包含搜索键值和指向磁盘上实际记录的指针。</p><p><strong>稀疏索引</strong>： 在稀疏索引中，<strong>不会为每个搜索关键字创建索引记录</strong>。此处的索引记录包含搜索键和指向磁盘上数据的实际指针。要搜索记录，我们首先按索引记录进行操作，然后到达数据的实际位置。如果我们要寻找的数据不是我们通过遵循索引直接到达的位置，那么系统将开始顺序搜索，直到找到所需的数据为止。</p></blockquote><h2 id="文件清除策略" tabindex="-1"><a class="header-anchor" href="#文件清除策略"><span>文件清除策略</span></a></h2><!---->，可以通过调整如下参数修改保存时间。<ul><li><code>log.retention.hours</code>：最低优先级小时，默认168小时（7天）。</li><li><code>log.retention.minutes</code>：分钟。</li><li><code>log.retention.ms</code>：最高优先级毫秒。</li><li><code>log.retention.check.interval.ms</code>：设置检查周期，默认 5 分钟。</li></ul><p>那么日志超过了设置的时间，怎么处理呢？</p><p>Kafka 中提供的日志清理策略有<!----> 两种。</p><ol><li><p>启用删除策略：<code>log.cleanup.policy</code> = delete</p><ul><li>基于时间:默认打开。以 segment 中所有记录中的最大时间戳作为该文件时间戳。</li><li>基于大小:默认关闭。超过设置的所有日志总大小，删除最早的 segment。<code>log.retention.bytes</code>，默认等于-1，表示无穷大。</li></ul></li><li><p>启用压缩策略：<code>log.cleanup.policy</code> = compact</p><p>对于相同key的 不同value值，只保留最后一个版本。</p></li></ol><h2 id="kafka为什么快" tabindex="-1"><a class="header-anchor" href="#kafka为什么快"><span>kafka为什么快？</span></a></h2><ol><li><p><mark>顺序写磁盘</mark>：以追加的形式到文件末端，节省了大量磁头寻址的过程</p></li><li><p><mark>零拷贝</mark>：在broker端不需要对数据进行任何，直接发往网卡，所有处理可放在生产端或者消费端进行；减少了系统调用，避免在 <code>用户态(User-space)</code> 与 <code>内核态(Kernel-space)</code> 之间来回拷贝数据。</p></li><li><p><mark>页缓存</mark>：</p><ul><li>producer 生产消息到 Broker 时，Broker 会使用 pwrite() 系统调用【对应到 Java NIO 的 FileChannel.write() API】按偏移量写入数据，数据都会先写入<code>page cache</code>。</li><li>consumer 消费消息时，Broker 使用 sendfile() 系统调用【对应 FileChannel.transferTo() API】，零拷贝地将数据从 page cache 传输到 broker 的 Socket buffer，再通过网络传输。</li></ul><blockquote><p>leader 与 follower 之间的同步，与上面 consumer 消费数据的过程是同理的。</p></blockquote><p><code>page cache</code>中的数据会随着内核中 flusher 线程的调度以及对 sync()/fsync() 的调用写回到磁盘，就算进程崩溃，也不用担心数据丢失。另外，如果 <!---->，并且会顺便预读出一些相邻的块放入 page cache，以方便下一次读取。</p><p>因此如果 Kafka <!---->，那么就能几乎只靠对 broker page cache 的读写完成整个生产 - 消费过程，磁盘访问非常少。</p></li><li><p><mark>网络模型</mark>：底层基于 Java NIO，采用和 Netty 一样的 Reactor 线程模型。</p></li><li><p><mark>批量传输与压缩消息</mark></p><p><code>Producer</code> 有两个重要的参数：和 <code>Producer</code> 的批量发送消息有关。</p><ul><li><code>batch.size</code>：16KB</li><li>``linger.ms`：默认0ms，表示没有延迟。</li></ul><p>主要是为了让传输消息的次数变得更少，压缩主要是为了降低网络传输的消耗，提高吞吐量。</p><p><code>Broker</code> 接收到压缩后的消息块之后（建议 <code>Broker</code> 的压缩算法和 <code>Producer</code> 一样），会依次将压缩后的消息块写入文件中（注意：这个时候消息块 <!---->），<code>Consumer</code> 同时会依次获取消息块，当消息块到达 <code>Consumer</code> 后，<code>Consumer</code> 才会对消息块进行解压缩（有压缩必然有解压缩）。</p></li><li><p><mark>分区并发</mark>：本身就是分布式集群，可以采用分区技术，并行度高</p><p>Kafka 的 Topic 可以分成多个 Partition，每个 Paritition 类似于一个队列，保证数据有序。同一个 Group 下的不同 Consumer 并发消费 Paritition，分区实际上是调优 Kafka 并行度的最小单元，因此，可以说， <!---->。</p><!---->：<ol><li>需要更多的资源</li><li>降低高可用性：分区越多，每个 Broker 上分配的分区也就越多，当一个发生 Broker 宕机，那么恢复时间将很长。</li></ol></li><li><p><mark>文件结构</mark>：</p><ul><li>读数据采用<!---->，可以快速定位要消费的数据</li><li>Kafka 充分利用二分法来查找对应 offset 的消息位置：</li></ul></li></ol><h2 id="如何保证kafka不丢失消息" tabindex="-1"><a class="header-anchor" href="#如何保证kafka不丢失消息"><span>⭐如何保证Kafka不丢失消息?</span></a></h2><p><mark>生产者丢失消息的情况</mark></p><p><code>Producer</code> 使用 <code>send()</code> 方法发送消息是异步的操作，我们可以通过 <code>get()</code>方法获取调用结果，但是这样也让它变为了同步操作，示例代码如下：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">SendResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sendResult <span class="token operator">=</span> kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>sendResult<span class="token punctuation">.</span><span class="token function">getRecordMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;生产者成功发送消息到&quot;</span> <span class="token operator">+</span> sendResult<span class="token punctuation">.</span><span class="token function">getProducerRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&gt; &quot;</span> <span class="token operator">+</span> sendRe
              sult<span class="token punctuation">.</span><span class="token function">getProducerRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是一般不推荐这么做！可以<!---->的形式，示例代码如下：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">ListenableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SendResult</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
future<span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>result <span class="token operator">-&gt;</span> logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;生产者成功发送消息到topic:{} partition:{}的消息&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getRecordMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getRecordMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ex <span class="token operator">-&gt;</span> logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;生产者发送消失败，原因：{}&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外，建议根据实际情况设置以下参数：</p><p>参数 <code>retries</code> 表示生产者生产消息的<!---->，可根据实际情况调整。</p><p>参数<code>retry.backoff.ms</code> 表示<!---->，单位是毫秒，如果配置的时间间隔太短，服务可能仍然处于不可用状态。</p><p>如果重试次数用光后，还是消息发送失败，那么kafka会将异常信息通过<a href="https://so.csdn.net/so/search?q=%E5%9B%9E%E8%B0%83&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">回调<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>的形式带给我们，这时，我们可以将没有发送成功的消息进行持久化，做后续的补偿处理。</p><p><mark>消费者丢失消息的情况</mark></p><p>当消费者拉取到了分区的某个消息之后，消费者默认会自动提交 <code>offset</code>。</p><p>我们手动关闭自动提交 <code>offset</code>，每次在真正消费完消息之后之后再自己手动提交 <code>offset</code> 。但是，细心的朋友一定会发现，这样会带来消息被重新消费的问题。比如你刚刚消费完消息之后，还没提交 <code>offset</code>，结果自己挂掉了，那么这个消息理论上就会被消费两次，所以手动提交消息需要做一些幂等性的措施。</p><ul><li>同步提交</li><li>异步提交</li></ul><p><mark>Broker 弄丢了消息</mark></p><!----><ol><li><p>设置 <code>acks</code> = all</p><ul><li>-1(all)：表示只有所有 ISR 列表的副本全部收到消息时，生产者才会接收到来自服务器的响应. 这种模式是最高级别的，也是最安全的，该模式的延迟会很高.</li><li>1：也是默认值，代表我们的消息被leader副本接收之后就算被成功发送。</li><li>0：立马响应返回，异步</li></ul><p>若配置为<code>all</code>，如果有一台 Follower 宕机，那么会永远无法ack</p></li><li><p>设置 <code>replication.factor</code> ：分区副本大于等于2，保证即使分区的<code>leader</code>挂掉，其他<code>follower</code>被选中为leader也会正常处理消息。</p></li><li><p>设置 <code>min.insync.replicas</code> ：ISR 里应答的最小副本数量大于等于2，原理同上，也需要大于 1 的副本数量来保证消息不丢失。</p><blockquote><p>确保 replication.factor &gt; min.insync.replicas</p><p>如果两者相等，那么只要有一个副本挂机，整个分区就无法正常工作了。我们不仅要改善消息的持久性，防止数据丢失，还要在不降低可用性的基础上完成。推荐设置成 replication.factor = min.insync.replicas + 1。</p></blockquote></li><li><p>设置 unclean.leader.election.enable = false</p><!----><p>发送的消息会被发送到 <code>Leader</code> 副本，然后 <code>Follower</code> 副本才能从 <code>Leader</code> 副本中拉取消息进行同步。多个 <code>Follower</code> 副本之间的消息同步情况不一样，当我们配置了 <code>unclean.leader.election.enable = false</code> 的话，当 <code>Leader</code> 副本发生故障时就不会从 <code>Follower</code> 副本中和 <code>Leader</code> 同步程度达不到要求的副本中选择出 <code>Leader</code> ，这样降低了消息丢失的可能性。</p><blockquote><p>Kafka 0.11.0.0 版本开始 unclean.leader.election.enable 参数的默认值由原来的 true 改为 false</p></blockquote></li></ol><blockquote><p>精确一次：幂等性和事务</p></blockquote><h2 id="kafka-如何保证消息的消费顺序" tabindex="-1"><a class="header-anchor" href="#kafka-如何保证消息的消费顺序"><span>Kafka 如何保证消息的消费顺序？</span></a></h2><ol><li>一个 Topic 只对应一个 Partition。</li><li>（推荐）发送消息的时候指定 key/Partition。</li></ol><p>如何保证生产端单分区有序呢？</p><ul><li><p>kafka在1.x版本之前保证数据单分区有序，条件如下:</p><p><code>max.in.flight.requests.perconnection</code>=1 (不需要考虑是否开启幂等性)</p></li><li><p>kafka在1.x及以后版本保证数据单分区有序，条件如下:</p><ol><li><p>未开启幂等性：max.in.fight.requests.perconnection黑要设置为1。</p></li><li><p>开启幂等性：max.in.flight.requests.per.connection需要设置小于等于5</p><p>原因说明：因为在kafkal,x以后，启用幂等后，kafka服务端会缓存producer发来的最近5个request的元数据，故无论如何，都可以保证最近5个request的数据都是有序的。</p></li></ol></li></ul><blockquote><p>单分区有序，可能会造成数据倾斜；想要实现多分区有序，需在消费端排序。</p></blockquote><h2 id="分区策略" tabindex="-1"><a class="header-anchor" href="#分区策略"><span>分区策略</span></a></h2><p>即生产者发往 Broker 时，采用何种策略</p><p>同一个 Topic 可以创建多个分区。理论上分区越多并发度越高，Kafka 会<strong>根据分区策略将分区尽可能均衡的分布在不同的 Broker 节点上，以避免消息倾斜</strong>，不同的 Broker 负载差异太大。分区也不是越多越好哦，毕竟太多邮政公司也管理不过来。</p><ol><li>若指定 partition，则按照 partition 发往指定的分区</li><li>若未指定 partition ，但选择了 key，则按照 key 的哈希值取模后发往指定分区</li><li>会随机选择一个分区，待batch满后或已完成， 再随机选一个（和上一次分区不同）——3.0版本</li></ol><blockquote><p>自定义分区器：实现Partitioner接口，重写partition()方法</p></blockquote><h2 id="kafka消费组-分区分配策略及重平衡机制" tabindex="-1"><a class="header-anchor" href="#kafka消费组-分区分配策略及重平衡机制"><span>Kafka消费组 分区分配策略及重平衡机制</span></a></h2><p>首先：一个消费者组中的消费者只能消费一个分区！</p><figure><img src="http://images.xyzzs.top/image/1677028966704-9b5a4f2e-abfe-45b5-9dca-575157a6c096.png_char" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>分区分配策略：<code>partition.assignment.strategy</code>，默认的赋值器是[ RangeAssignor , CooperativeStickyAssignor ]。</p><p>实现<code>org.apache.kafka.clients.consumer.ConsumerPartitionAssignor</code>接口允许插入一个自定义分配策略。</p><ul><li><p>Range</p><p>首先对<strong>同一个 topic</strong> 的分区按序号进行排序，并对消费者按照字母顺序进行排序；</p><p>然后通过 partition数 / consumer数来决定每个消费者应该消费几个分区。如果除不尽，前面的几个消费者将会多消费 1 个分区</p><blockquote><p>topic个数比较多时，容易产生数据倾斜</p></blockquote></li><li><p>RoundRobin：针对集群中<strong>所有 topic</strong> ，把所有 partition 和所有的 consumer 都列出来，然后按照 hashCode进行排序，最好通过轮询算法来分配 partition 给到各个消费者。</p></li><li><p>StickyAssignor：黏性，类似Range，有一定随机性</p></li><li><p>CooperativeStickyAssignor：合作者黏性</p></li></ul><p><strong>假如某个 Consumer Group 突然加入或者退出了一个 Consumer，会发生什么情况呢？</strong></p><p>会触发 <strong>重平衡</strong> ，它本质上是一种协议，规定了一个 Consumer Group 下的所有 Consumer 如何达成一致来分配订阅 Topic 的每个分区。</p><h2 id="zookeeper-存储" tabindex="-1"><a class="header-anchor" href="#zookeeper-存储"><span>zookeeper 存储</span></a></h2><p>ZooKeeper 主要为 Kafka 提供元数据的管理的功能。</p><figure><img src="http://images.xyzzs.top/image/1677032584417-2a5caeeb-d674-4f31-9760-2d728390a041.png_char" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ul><li>Kafka Controller 的 Leader 选举</li><li>Kafka 集群成员管理</li><li>Topic 配置管理</li><li>分区副本管理</li></ul><p>Zookeeper 主要为 Kafka 做了下面这些事情：</p><ol><li><strong>Broker 注册</strong> ：在 Zookeeper 上会有一个专门<strong>用来进行 Broker 服务器列表记录</strong>的节点。每个 Broker 在启动时，都会到 Zookeeper 上进行注册，即到/brokers/ids 下创建属于自己的节点。每个 Broker 就会将自己的 IP 地址和端口等信息记录到该节点中去</li><li><strong>Topic 注册</strong> ： 在 Kafka 中，同一个<strong>Topic 的消息会被分成多个分区</strong>并将其分布在多个 Broker 上，<strong>这些分区信息及与 Broker 的对应关系</strong>也都是由 Zookeeper 在维护。比如我创建了一个名字为 my-topic 的主题并且它有两个分区，对应到 zookeeper 中会创建这些文件夹：<code>/brokers/topics/my-topic/Partitions/0</code>、<code>/brokers/topics/my-topic/Partitions/1</code></li><li><strong>负载均衡</strong> ： Kafka 通过给特定 Topic 指定多个 Partition, 而各个 Partition 可以分布在不同的 Broker 上, 这样便能提供比较好的并发能力。 对于同一个 Topic 的不同 Partition，Kafka 会尽力将这些 Partition 分布到不同的 Broker 服务器上。当生产者产生消息后也会尽量投递到不同 Broker 的 Partition 里面。当 Consumer 消费的时候，Zookeeper 可以根据当前的 Partition 数量以及 Consumer 数量来实现动态负载均衡。</li><li>等等。。。。</li></ol><blockquote><p>2.8版本后，采用 Kraft模式，不再依赖 zk ，但此版本还可以兼容 zk。</p></blockquote><h2 id="高可用" tabindex="-1"><a class="header-anchor" href="#高可用"><span>高可用</span></a></h2><h3 id="备份机制" tabindex="-1"><a class="header-anchor" href="#备份机制"><span>备份机制</span></a></h3><p>Kafka 允许同一个 Partition 存在多个消息副本，每个 Partition 的副本通常由 1 个 Leader 及 0 个以上的 Follower 组成，生产者将消息直接发往对应 Partition 的 Leader，Follower 会周期地向 Leader 发送同步请求</p><!---->，因为一旦该 Broker 宕机，对应 Partition 的所有 Replica 都无法工作，这就达不到高可用的效果<p>所以 Kafka 会尽量将所有的 Partition 以及各 Partition 的副本均匀地分配到整个集群的各个 Broker 上</p><h3 id="isr-机制" tabindex="-1"><a class="header-anchor" href="#isr-机制"><span>ISR 机制</span></a></h3><p><mark>ISR 副本集合</mark></p><p>ISR 中的副本都是与 Leader 同步的副本，相反，不在 ISR 中的追随者副本就被认为是与 Leader 不同步的</p><p>这里的保持同步不是指与 Leader 数据保持完全一致，只需在<code>replica.lag.time.max.ms</code><!---->。Follower 周期性地向 Leader 发送 FetchRequest 请求，发送时间间隔配置在<code>replica.fetch.wait.max.ms</code>中，默认值为 500</p><p>各 Partition 的 Leader 负责维护 ISR 列表并将 ISR 的变更同步至 ZooKeeper，被移出 ISR 的 Follower 会继续向 Leader 发 FetchRequest 请求，试图再次跟上 Leader 重新进入 ISR</p><p><mark>Unclean 领导者选举</mark></p><p>当 Kafka 中<code>unclean.leader.election.enable</code>配置为 true(默认值为 false)。在 ISR 中所有副本均宕机的情况下，才被允许 ISR 外的副本被选为 Leader，此时会丢失部分已应答的数据</p><p>开启 Unclean 领导者选举可能会造成数据丢失，但好处是，它<!---->，因此提升了高可用性，反之，禁止 Unclean 领导者选举的好处在于维护了数据的一致性，避免了消息丢失，但牺牲了高可用性</p><h3 id="ack-机制" tabindex="-1"><a class="header-anchor" href="#ack-机制"><span>ACK 机制</span></a></h3><ul><li><strong>「acks=0」</strong></li></ul><p>生产者无需等待服务端的任何确认，消息被添加到生产者套接字缓冲区后就视为已发送，因此 acks=0 不能保证服务端已收到消息</p><ul><li><strong>「acks=1」</strong></li></ul><p>只要 <code>Partition Leader</code> 接收到消息而且写入本地磁盘了，就认为成功了，不管它其他的 Follower 有没有同步过去这条消息了</p><ul><li><strong>「acks=all (-1) 」</strong></li></ul><p>Leader 将等待 ISR 中的所有副本确认后再做出应答，因此只要 ISR 中任何一个副本还存活着，这条应答过的消息就不会丢失</p><p>acks=all 是可用性最高的选择，但等待 Follower 应答引入了额外的响应时间。Leader 需要等待 ISR 中所有副本做出应答，此时<!---->那台机器</p><p>Broker 有个配置项<code>min.insync.replicas</code>(默认值为 1)代表了正常写入生产者数据所需要的最少 ISR 个数</p><p>当 ISR 中的副本数量小于<code>min.insync.replicas</code>时，Leader 停止写入生产者生产的消息，并向生产者抛出 NotEnoughReplicas 异常，阻塞等待更多的 Follower 赶上并重新进入 ISR</p><p>被 Leader 应答的消息都至少有<code>min.insync.replicas</code>个副本，因此能够容忍<code>min.insync.replicas-1</code>个副本同时宕机</p><h3 id="故障恢复机制" tabindex="-1"><a class="header-anchor" href="#故障恢复机制"><span>故障恢复机制</span></a></h3><p>首先需要在集群所有 Broker 中选出一个 Controller，负责各 Partition 的 Leader 选举以及 Replica 的重新分配</p><p>当出现 Leader 故障后，Controller 会将 Leader/Follower 的变动通知到需为此作出响应的 Broker。</p><p>Kafka 使用 ZooKeeper 存储 Broker、Topic 等状态数据，Kafka 集群中的 Controller 和 Broker 会在 ZooKeeper 指定节点上注册 Watcher(事件监听器)，以便在特定事件触发时，由 ZooKeeper 将事件通知到对应 Broker</p><p><mark>Broker 故障恢复流程</mark></p><p><strong>「当 Broker 发生故障后，由 Controller 负责选举受影响 Partition 的新 Leader 并通知到相关 Broker」</strong></p><ul><li>当 Broker 出现故障与 ZooKeeper 断开连接后，该 Broker 在 ZooKeeper 对应的 znode 会自动被删除，ZooKeeper 会触发 Controller 注册在该节点的 Watcher；</li><li>Controller 从 ZooKeeper 的<code>/brokers/ids</code>节点上获取宕机 Broker 上的所有 Partition；</li><li>Controller 再从 ZooKeeper 的<code>/brokers/topics</code>获取所有 Partition 当前的 ISR；</li><li>对于宕机 Broker 是 Leader 的 Partition，Controller 从 ISR 中选择幸存的 Broker 作为新 Leader；</li><li>最后 Controller 通过 LeaderAndIsrRequest 请求向的 Broker 发送 LeaderAndISRRequest 请求。</li></ul><p><mark>Controller 故障恢复流程</mark></p><p>集群中的 Controller 也会出现故障，因此 Kafka 让所有 Broker 都在 ZooKeeper 的 Controller 节点上注册一个 Watcher</p><p>Controller 发生故障时对应的 Controller 临时节点会自动删除，此时注册在其上的 Watcher 会被触发，所有活着的 Broker 都会去竞选成为新的 Controller(即创建新的 Controller 节点，由 ZooKeeper 保证只会有一个创建成功)</p><p>竞选成功者即为新的 Controller。</p><h2 id="选举" tabindex="-1"><a class="header-anchor" href="#选举"><span>选举</span></a></h2><!----><figure><img src="http://images.xyzzs.top/image/1677033107884-909b1a15-04d7-4fff-9740-517fec12bd8c.png_char" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>宕机后恢复，会打乱 ISR 顺序</p><p>压测结果</p></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/message-queue/kafka.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: zzss5224@163.com">jossezs</span><!--]--><!--]--></div></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2025 Mr.Hope </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CoZ3ixxr.js" defer></script>
  </body>
</html>
